<ta-loader
  [isLoading]="this.requestState.isLoading()"
  *ngLet="this.documents$ | async as documents"
>
  <ta-error
    [message]="this.requestState.getErrorMessage()"
    [code]="this.requestState.getErrorStatus()"
  >
    <ta-empty
      [isEmpty]="!documents || documents.length === 0"
      [text]="this.emptyMessage"
      [showMessage]="!!this.emptyMessage"
    >
      <div class="list flex-column g-space-sm">
        @for (doc of documents; track doc) {
        <div>
          <ng-container
            *ngTemplateOutlet="
              this.actions !== 'select' ? defaultTemplate : selectTemplate;
              context: { doc: doc }
            "
          ></ng-container>
        </div>
        }
      </div>
    </ta-empty>
  </ta-error>
</ta-loader>

<ng-template #defaultTemplate let-doc="doc">
  <div class="flex-row g-space-xs justify-content-between">
    <div class="align-center">
      <ta-font-icon name="doc" size="xs"></ta-font-icon>
      <div>
        <ta-link [underline]="false" (action)="this.openDocument(doc)">{{
          doc.name
        }}</ta-link>
        <div class="extra flex-row g-space-md">
          <ta-time-ago [date]="doc.uploadedDate"></ta-time-ago>
          <ta-megaoctet [octet]="doc.size"></ta-megaoctet>
        </div>
      </div>
    </div>
    <div class="cta align-content-center">
      @if (this.actions === 'select') {
      <input
        [disabled]="this.readonly"
        type="checkbox"
        [checked]="this.isChecked(doc)"
        (click)="this.check(doc)"
      />
      } @else if (this.actions === 'delete') {
      <ta-button-tool
        (action)="this.removeDocument(doc)"
        icon="delete"
        [size]="'sm'"
        [readonly]="this.readonly"
      ></ta-button-tool>
      }
    </div>
  </div>
</ng-template>

<ng-template #selectTemplate let-doc="doc">
  <div
    class="card-document-upload flex-row g-space-xs justify-content-between"
    [class.selected]="this.isChecked(doc)"
    (click)="this.check(doc)"
  >
    <div class="display flex-column align-items-start">
      <ta-link
        [bold]="true"
        [underline]="false"
        (click)="$event.stopPropagation()"
        (action)="this.openDocument(doc)"
      >
        {{ doc.name }}
      </ta-link>
      <div class="flex-row g-space-md">
        <div class="flex-row align-items-center">
          <ta-font-icon name="doc" size="xs"></ta-font-icon>
          <ta-text>
            {{
              "communication.documents.file-type." +
                this.FileType[doc.fileType].toLocaleLowerCase() | translate
            }}
          </ta-text>
        </div>
        <ta-megaoctet [icon]="true" [octet]="doc.size"></ta-megaoctet>
      </div>
    </div>
    <div class="button align-content-center">
      @if (this.actions === 'select') {
      <input type="checkbox" [checked]="this.isChecked(doc)" />
      } @else if (this.actions === 'delete') {
      <ta-button-tool
        (action)="this.removeDocument(doc)"
        icon="delete"
        [size]="'sm'"
      ></ta-button-tool>
      }
    </div>
  </div>
</ng-template>
