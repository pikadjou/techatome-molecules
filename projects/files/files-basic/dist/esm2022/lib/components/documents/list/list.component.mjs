import { NgIf, NgFor, AsyncPipe } from '@angular/common';
import { FontIconComponent } from '@ta/icons';
import { Component, EventEmitter, Input, Output, inject } from '@angular/core';
import { TranslateModule } from '@ngx-translate/core';
import { CamDocumentsService, FileType } from '@ta/services';
import { ButtonToolComponent, EmptyComponent, ErrorComponent, LinkComponent, LoaderComponent, MegaoctetComponent, TextComponent, TimeAgoComponent } from '@ta/ui';
import { TaBaseComponent, downloadFile } from '@ta/utils';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class DocumentsListComponent extends TaBaseComponent {
    constructor() {
        super(...arguments);
        this.emptyMessage = '';
        this.actions = '';
        this.defaultSelected = [];
        this.readonly = false;
        this.remove = new EventEmitter();
        this.checkedFilesChanged = new EventEmitter();
        this._documentsService = inject(CamDocumentsService);
        this._checkedFiles = [];
        this.FileType = FileType;
    }
    get documents$() {
        return this._documentsService.getDocuments$(this.documentsIds);
    }
    ngOnInit() {
        this._fetch();
    }
    ngOnChanges(changes) {
        // this._fetch();
    }
    openDocument(doc) {
        downloadFile(doc.url);
    }
    removeDocument(doc) {
        this.remove.emit(doc.id);
    }
    isChecked(doc) {
        return this._checkedFiles.find(x => x.id === doc.id);
    }
    check(doc) {
        if (this.isChecked(doc)) {
            this._checkedFiles = this._checkedFiles.filter(x => x.id !== doc.id);
        }
        else {
            this._checkedFiles.push({ id: doc.id, name: doc.name, url: doc.url });
        }
        this.checkedFilesChanged.emit(this._checkedFiles);
    }
    _fetch() {
        this.requestState.asked();
        this._documentsService.fetchDocuments$(this.documentsIds).subscribe({
            next: documents => {
                this._checkedFiles = documents.filter(doc => this.defaultSelected.includes(doc.id));
            },
            complete: () => this.requestState.completed(),
            error: (error) => {
                this.requestState.onError(error.status, error.statusText);
            },
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DocumentsListComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: DocumentsListComponent, isStandalone: true, selector: "ta-documents-list", inputs: { documentsIds: "documentsIds", emptyMessage: "emptyMessage", actions: "actions", defaultSelected: "defaultSelected", readonly: "readonly" }, outputs: { remove: "remove", checkedFilesChanged: "checkedFilesChanged" }, usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<ta-loader [isLoading]=\"this.requestState.isLoading()\" *ngLet=\"this.documents$ | async as documents\">\n  <ta-error [message]=\"this.requestState.getErrorMessage()\" [code]=\"this.requestState.getErrorStatus()\">\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage\"\n      [showMessage]=\"!!this.emptyMessage\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n          <div>\n            <ng-container\n              *ngTemplateOutlet=\"this.actions !== 'select' ? defaultTemplate : selectTemplate; context: { doc: doc }\"\n            ></ng-container>\n          </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{ doc.name }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions === 'select') {\n        <input [disabled]=\"this.readonly\" type=\"checkbox\" [checked]=\"this.isChecked(doc)\" (click)=\"this.check(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool\n          (action)=\"this.removeDocument(doc)\"\n          icon=\"delete\"\n          [size]=\"'sm'\"\n          [readonly]=\"this.readonly\"\n        ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link [bold]=\"true\" [underline]=\"false\" (click)=\"$event.stopPropagation()\" (action)=\"this.openDocument(doc)\">\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{ 'communication.documents.file-type.' + this.FileType[doc.fileType].toLocaleLowerCase() | translate }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions === 'select') {\n        <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool (action)=\"this.removeDocument(doc)\" icon=\"delete\" [size]=\"'sm'\"></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);line-height:var(--ta-font-body-sm-default-line);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: ButtonToolComponent, selector: "ta-button-tool", inputs: ["state", "type", "size", "icon", "stopPropagationActivation", "readonly"], outputs: ["action"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ErrorComponent, selector: "ta-error", inputs: ["message", "code"] }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: LinkComponent, selector: "ta-link", inputs: ["state", "underline", "bold", "size", "icon"], outputs: ["action"] }, { kind: "component", type: LoaderComponent, selector: "ta-loader", inputs: ["isLoading", "skeleton"] }, { kind: "component", type: MegaoctetComponent, selector: "ta-megaoctet", inputs: ["octet", "icon"] }, { kind: "component", type: TextComponent, selector: "ta-text", inputs: ["size", "isBold", "color"] }, { kind: "component", type: TimeAgoComponent, selector: "ta-time-ago", inputs: ["date", "withHours"] }, { kind: "ngmodule", type: TranslateModule }, { kind: "pipe", type: i1.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DocumentsListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-documents-list', standalone: true, imports: [NgIf, NgFor, AsyncPipe, ButtonToolComponent, EmptyComponent, ErrorComponent, FontIconComponent, LinkComponent, LoaderComponent, MegaoctetComponent, TextComponent, TimeAgoComponent, TranslateModule], template: "<ta-loader [isLoading]=\"this.requestState.isLoading()\" *ngLet=\"this.documents$ | async as documents\">\n  <ta-error [message]=\"this.requestState.getErrorMessage()\" [code]=\"this.requestState.getErrorStatus()\">\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage\"\n      [showMessage]=\"!!this.emptyMessage\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n          <div>\n            <ng-container\n              *ngTemplateOutlet=\"this.actions !== 'select' ? defaultTemplate : selectTemplate; context: { doc: doc }\"\n            ></ng-container>\n          </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{ doc.name }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions === 'select') {\n        <input [disabled]=\"this.readonly\" type=\"checkbox\" [checked]=\"this.isChecked(doc)\" (click)=\"this.check(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool\n          (action)=\"this.removeDocument(doc)\"\n          icon=\"delete\"\n          [size]=\"'sm'\"\n          [readonly]=\"this.readonly\"\n        ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link [bold]=\"true\" [underline]=\"false\" (click)=\"$event.stopPropagation()\" (action)=\"this.openDocument(doc)\">\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{ 'communication.documents.file-type.' + this.FileType[doc.fileType].toLocaleLowerCase() | translate }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions === 'select') {\n        <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool (action)=\"this.removeDocument(doc)\" icon=\"delete\" [size]=\"'sm'\"></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);line-height:var(--ta-font-body-sm-default-line);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"] }]
        }], propDecorators: { documentsIds: [{
                type: Input
            }], emptyMessage: [{
                type: Input
            }], actions: [{
                type: Input
            }], defaultSelected: [{
                type: Input
            }], readonly: [{
                type: Input
            }], remove: [{
                type: Output
            }], checkedFilesChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFOUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqSCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdEQsT0FBTyxFQUFFLG1CQUFtQixFQUFlLFFBQVEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsY0FBYyxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLGtCQUFrQixFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNsSyxPQUFPLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxNQUFNLFdBQVcsQ0FBQzs7O0FBUzFELE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxlQUFlO0lBUDNEOztRQVlFLGlCQUFZLEdBQVcsRUFBRSxDQUFDO1FBRzFCLFlBQU8sR0FBNkIsRUFBRSxDQUFDO1FBR3ZDLG9CQUFlLEdBQWEsRUFBRSxDQUFDO1FBRy9CLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFHMUIsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFHcEMsd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQXNCLENBQUM7UUFFNUMsc0JBQWlCLEdBQUcsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFFekQsa0JBQWEsR0FBdUIsRUFBRSxDQUFDO1FBQ3hDLGFBQVEsR0FBRyxRQUFRLENBQUM7S0ErQzVCO0lBN0NDLElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxpQkFBaUI7SUFDbkIsQ0FBQztJQUVNLFlBQVksQ0FBQyxHQUFnQjtRQUNsQyxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7SUFFTSxjQUFjLENBQUMsR0FBZ0I7UUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFTSxTQUFTLENBQUMsR0FBZ0I7UUFDL0IsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFTSxLQUFLLENBQUMsR0FBZ0I7UUFDM0IsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDeEUsQ0FBQztRQUNELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFTyxNQUFNO1FBQ1osSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDbEUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxFQUFFO2dCQUNoQixJQUFJLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0RixDQUFDO1lBQ0QsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFO1lBQzdDLEtBQUssRUFBRSxDQUFDLEtBQXdCLEVBQUUsRUFBRTtnQkFDbEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDNUQsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7K0dBdkVVLHNCQUFzQjttR0FBdEIsc0JBQXNCLDBWQ2xCbkMsZ2dHQTRFQSxtb0JENUR5QixTQUFTLDhDQUFFLG1CQUFtQixvS0FBRSxjQUFjLHdJQUFFLGNBQWMsa0ZBQUUsaUJBQWlCLG1GQUFFLGFBQWEsaUlBQUUsZUFBZSx5RkFBRSxrQkFBa0Isb0ZBQUUsYUFBYSx5RkFBRSxnQkFBZ0Isc0ZBQUUsZUFBZTs7NEZBRW5NLHNCQUFzQjtrQkFQbEMsU0FBUzsrQkFDQSxtQkFBbUIsY0FHZixJQUFJLFdBQ1AsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxtQkFBbUIsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGlCQUFpQixFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsa0JBQWtCLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLGVBQWUsQ0FBQzs4QkFJL00sWUFBWTtzQkFEWCxLQUFLO2dCQUlOLFlBQVk7c0JBRFgsS0FBSztnQkFJTixPQUFPO3NCQUROLEtBQUs7Z0JBSU4sZUFBZTtzQkFEZCxLQUFLO2dCQUlOLFFBQVE7c0JBRFAsS0FBSztnQkFJTixNQUFNO3NCQURMLE1BQU07Z0JBSVAsbUJBQW1CO3NCQURsQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmdJZiwgTmdGb3IsIEFzeW5jUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gJ0B0YS9pY29ucyc7XG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgaW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcblxuaW1wb3J0IHsgSW5wdXRVcGxvYWRWYWx1ZSB9IGZyb20gJ0B0YS9mb3JtLW1vZGVsJztcbmltcG9ydCB7IENhbURvY3VtZW50c1NlcnZpY2UsIERvY3VtZW50RHRvLCBGaWxlVHlwZSB9IGZyb20gJ0B0YS9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBCdXR0b25Ub29sQ29tcG9uZW50LCBFbXB0eUNvbXBvbmVudCwgRXJyb3JDb21wb25lbnQsIExpbmtDb21wb25lbnQsIExvYWRlckNvbXBvbmVudCwgTWVnYW9jdGV0Q29tcG9uZW50LCBUZXh0Q29tcG9uZW50LCBUaW1lQWdvQ29tcG9uZW50IH0gZnJvbSAnQHRhL3VpJztcbmltcG9ydCB7IFRhQmFzZUNvbXBvbmVudCwgZG93bmxvYWRGaWxlIH0gZnJvbSAnQHRhL3V0aWxzJztcblxuQENvbXBvbmVudCh7XG5zZWxlY3RvcjogJ3RhLWRvY3VtZW50cy1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpc3QuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXN0LmNvbXBvbmVudC5zY3NzJ10sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtOZ0lmLCBOZ0ZvciwgQXN5bmNQaXBlLCBCdXR0b25Ub29sQ29tcG9uZW50LCBFbXB0eUNvbXBvbmVudCwgRXJyb3JDb21wb25lbnQsIEZvbnRJY29uQ29tcG9uZW50LCBMaW5rQ29tcG9uZW50LCBMb2FkZXJDb21wb25lbnQsIE1lZ2FvY3RldENvbXBvbmVudCwgVGV4dENvbXBvbmVudCwgVGltZUFnb0NvbXBvbmVudCwgVHJhbnNsYXRlTW9kdWxlXSxcbn0pXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRzTGlzdENvbXBvbmVudCBleHRlbmRzIFRhQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KClcbiAgZG9jdW1lbnRzSWRzITogc3RyaW5nW107XG5cbiAgQElucHV0KClcbiAgZW1wdHlNZXNzYWdlOiBzdHJpbmcgPSAnJztcblxuICBASW5wdXQoKVxuICBhY3Rpb25zOiAnZGVsZXRlJyB8ICdzZWxlY3QnIHwgJycgPSAnJztcblxuICBASW5wdXQoKVxuICBkZWZhdWx0U2VsZWN0ZWQ6IHN0cmluZ1tdID0gW107XG5cbiAgQElucHV0KClcbiAgcmVhZG9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBAT3V0cHV0KClcbiAgcmVtb3ZlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgQE91dHB1dCgpXG4gIGNoZWNrZWRGaWxlc0NoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPElucHV0VXBsb2FkVmFsdWVbXT4oKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9kb2N1bWVudHNTZXJ2aWNlID0gaW5qZWN0KENhbURvY3VtZW50c1NlcnZpY2UpO1xuXG4gIHByaXZhdGUgX2NoZWNrZWRGaWxlczogSW5wdXRVcGxvYWRWYWx1ZVtdID0gW107XG4gIHB1YmxpYyBGaWxlVHlwZSA9IEZpbGVUeXBlO1xuXG4gIGdldCBkb2N1bWVudHMkKCkge1xuICAgIHJldHVybiB0aGlzLl9kb2N1bWVudHNTZXJ2aWNlLmdldERvY3VtZW50cyQodGhpcy5kb2N1bWVudHNJZHMpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5fZmV0Y2goKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvLyB0aGlzLl9mZXRjaCgpO1xuICB9XG5cbiAgcHVibGljIG9wZW5Eb2N1bWVudChkb2M6IERvY3VtZW50RHRvKSB7XG4gICAgZG93bmxvYWRGaWxlKGRvYy51cmwpO1xuICB9XG5cbiAgcHVibGljIHJlbW92ZURvY3VtZW50KGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICB0aGlzLnJlbW92ZS5lbWl0KGRvYy5pZCk7XG4gIH1cblxuICBwdWJsaWMgaXNDaGVja2VkKGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICByZXR1cm4gdGhpcy5fY2hlY2tlZEZpbGVzLmZpbmQoeCA9PiB4LmlkID09PSBkb2MuaWQpO1xuICB9XG5cbiAgcHVibGljIGNoZWNrKGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICBpZiAodGhpcy5pc0NoZWNrZWQoZG9jKSkge1xuICAgICAgdGhpcy5fY2hlY2tlZEZpbGVzID0gdGhpcy5fY2hlY2tlZEZpbGVzLmZpbHRlcih4ID0+IHguaWQgIT09IGRvYy5pZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NoZWNrZWRGaWxlcy5wdXNoKHsgaWQ6IGRvYy5pZCwgbmFtZTogZG9jLm5hbWUsIHVybDogZG9jLnVybCB9KTtcbiAgICB9XG4gICAgdGhpcy5jaGVja2VkRmlsZXNDaGFuZ2VkLmVtaXQodGhpcy5fY2hlY2tlZEZpbGVzKTtcbiAgfVxuXG4gIHByaXZhdGUgX2ZldGNoKCkge1xuICAgIHRoaXMucmVxdWVzdFN0YXRlLmFza2VkKCk7XG4gICAgdGhpcy5fZG9jdW1lbnRzU2VydmljZS5mZXRjaERvY3VtZW50cyQodGhpcy5kb2N1bWVudHNJZHMpLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiBkb2N1bWVudHMgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja2VkRmlsZXMgPSBkb2N1bWVudHMuZmlsdGVyKGRvYyA9PiB0aGlzLmRlZmF1bHRTZWxlY3RlZC5pbmNsdWRlcyhkb2MuaWQpKTtcbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZTogKCkgPT4gdGhpcy5yZXF1ZXN0U3RhdGUuY29tcGxldGVkKCksXG4gICAgICBlcnJvcjogKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgICB0aGlzLnJlcXVlc3RTdGF0ZS5vbkVycm9yKGVycm9yLnN0YXR1cywgZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59XG4iLCI8dGEtbG9hZGVyIFtpc0xvYWRpbmddPVwidGhpcy5yZXF1ZXN0U3RhdGUuaXNMb2FkaW5nKClcIiAqbmdMZXQ9XCJ0aGlzLmRvY3VtZW50cyQgfCBhc3luYyBhcyBkb2N1bWVudHNcIj5cbiAgPHRhLWVycm9yIFttZXNzYWdlXT1cInRoaXMucmVxdWVzdFN0YXRlLmdldEVycm9yTWVzc2FnZSgpXCIgW2NvZGVdPVwidGhpcy5yZXF1ZXN0U3RhdGUuZ2V0RXJyb3JTdGF0dXMoKVwiPlxuICAgIDx0YS1lbXB0eVxuICAgICAgW2lzRW1wdHldPVwiIWRvY3VtZW50cyB8fCBkb2N1bWVudHMubGVuZ3RoID09PSAwXCJcbiAgICAgIFt0ZXh0XT1cInRoaXMuZW1wdHlNZXNzYWdlXCJcbiAgICAgIFtzaG93TWVzc2FnZV09XCIhIXRoaXMuZW1wdHlNZXNzYWdlXCJcbiAgICA+XG4gICAgICA8ZGl2IGNsYXNzPVwibGlzdCBmbGV4LWNvbHVtbiBnLXNwYWNlLXNtXCI+XG4gICAgICAgIEBmb3IgKGRvYyBvZiBkb2N1bWVudHM7IHRyYWNrIGRvYykge1xuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwidGhpcy5hY3Rpb25zICE9PSAnc2VsZWN0JyA/IGRlZmF1bHRUZW1wbGF0ZSA6IHNlbGVjdFRlbXBsYXRlOyBjb250ZXh0OiB7IGRvYzogZG9jIH1cIlxuICAgICAgICAgICAgPjwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICB9XG4gICAgICA8L2Rpdj5cbiAgICA8L3RhLWVtcHR5PlxuICA8L3RhLWVycm9yPlxuPC90YS1sb2FkZXI+XG5cbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdFRlbXBsYXRlIGxldC1kb2M9XCJkb2NcIj5cbiAgPGRpdiBjbGFzcz1cImZsZXgtcm93IGctc3BhY2UteHMganVzdGlmeS1jb250ZW50LWJldHdlZW5cIj5cbiAgICA8ZGl2IGNsYXNzPVwiYWxpZ24tY2VudGVyXCI+XG4gICAgICA8dGEtZm9udC1pY29uIG5hbWU9XCJkb2NcIiBzaXplPVwieHNcIj48L3RhLWZvbnQtaWNvbj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDx0YS1saW5rIFt1bmRlcmxpbmVdPVwiZmFsc2VcIiAoYWN0aW9uKT1cInRoaXMub3BlbkRvY3VtZW50KGRvYylcIj57eyBkb2MubmFtZSB9fTwvdGEtbGluaz5cbiAgICAgICAgPGRpdiBjbGFzcz1cImV4dHJhIGZsZXgtcm93IGctc3BhY2UtbWRcIj5cbiAgICAgICAgICA8dGEtdGltZS1hZ28gW2RhdGVdPVwiZG9jLnVwbG9hZGVkRGF0ZVwiPjwvdGEtdGltZS1hZ28+XG4gICAgICAgICAgPHRhLW1lZ2FvY3RldCBbb2N0ZXRdPVwiZG9jLnNpemVcIj48L3RhLW1lZ2FvY3RldD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiY3RhIGFsaWduLWNvbnRlbnQtY2VudGVyXCI+XG4gICAgICBAaWYgKHRoaXMuYWN0aW9ucyA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgPGlucHV0IFtkaXNhYmxlZF09XCJ0aGlzLnJlYWRvbmx5XCIgdHlwZT1cImNoZWNrYm94XCIgW2NoZWNrZWRdPVwidGhpcy5pc0NoZWNrZWQoZG9jKVwiIChjbGljayk9XCJ0aGlzLmNoZWNrKGRvYylcIiAvPlxuICAgICAgfSBAZWxzZSBpZiAodGhpcy5hY3Rpb25zID09PSAnZGVsZXRlJykge1xuICAgICAgICA8dGEtYnV0dG9uLXRvb2xcbiAgICAgICAgICAoYWN0aW9uKT1cInRoaXMucmVtb3ZlRG9jdW1lbnQoZG9jKVwiXG4gICAgICAgICAgaWNvbj1cImRlbGV0ZVwiXG4gICAgICAgICAgW3NpemVdPVwiJ3NtJ1wiXG4gICAgICAgICAgW3JlYWRvbmx5XT1cInRoaXMucmVhZG9ubHlcIlxuICAgICAgICA+PC90YS1idXR0b24tdG9vbD5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3NlbGVjdFRlbXBsYXRlIGxldC1kb2M9XCJkb2NcIj5cbiAgPGRpdlxuICAgIGNsYXNzPVwiY2FyZC1kb2N1bWVudC11cGxvYWQgZmxleC1yb3cgZy1zcGFjZS14cyBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiXG4gICAgW2NsYXNzLnNlbGVjdGVkXT1cInRoaXMuaXNDaGVja2VkKGRvYylcIlxuICAgIChjbGljayk9XCJ0aGlzLmNoZWNrKGRvYylcIlxuICA+XG4gICAgPGRpdiBjbGFzcz1cImRpc3BsYXkgZmxleC1jb2x1bW4gYWxpZ24taXRlbXMtc3RhcnRcIj5cbiAgICAgIDx0YS1saW5rIFtib2xkXT1cInRydWVcIiBbdW5kZXJsaW5lXT1cImZhbHNlXCIgKGNsaWNrKT1cIiRldmVudC5zdG9wUHJvcGFnYXRpb24oKVwiIChhY3Rpb24pPVwidGhpcy5vcGVuRG9jdW1lbnQoZG9jKVwiPlxuICAgICAgICB7eyBkb2MubmFtZSB9fVxuICAgICAgPC90YS1saW5rPlxuICAgICAgPGRpdiBjbGFzcz1cImZsZXgtcm93IGctc3BhY2UtbWRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImZsZXgtcm93IGFsaWduLWl0ZW1zLWNlbnRlclwiPlxuICAgICAgICAgIDx0YS1mb250LWljb24gbmFtZT1cImRvY1wiIHNpemU9XCJ4c1wiPjwvdGEtZm9udC1pY29uPlxuICAgICAgICAgIDx0YS10ZXh0PlxuICAgICAgICAgICAge3sgJ2NvbW11bmljYXRpb24uZG9jdW1lbnRzLmZpbGUtdHlwZS4nICsgdGhpcy5GaWxlVHlwZVtkb2MuZmlsZVR5cGVdLnRvTG9jYWxlTG93ZXJDYXNlKCkgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3RhLXRleHQ+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8dGEtbWVnYW9jdGV0IFtpY29uXT1cInRydWVcIiBbb2N0ZXRdPVwiZG9jLnNpemVcIj48L3RhLW1lZ2FvY3RldD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJidXR0b24gYWxpZ24tY29udGVudC1jZW50ZXJcIj5cbiAgICAgIEBpZiAodGhpcy5hY3Rpb25zID09PSAnc2VsZWN0Jykge1xuICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgW2NoZWNrZWRdPVwidGhpcy5pc0NoZWNrZWQoZG9jKVwiIC8+XG4gICAgICB9IEBlbHNlIGlmICh0aGlzLmFjdGlvbnMgPT09ICdkZWxldGUnKSB7XG4gICAgICAgIDx0YS1idXR0b24tdG9vbCAoYWN0aW9uKT1cInRoaXMucmVtb3ZlRG9jdW1lbnQoZG9jKVwiIGljb249XCJkZWxldGVcIiBbc2l6ZV09XCInc20nXCI+PC90YS1idXR0b24tdG9vbD5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuIl19