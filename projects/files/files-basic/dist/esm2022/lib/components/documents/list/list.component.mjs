import { AsyncPipe, NgFor, NgIf } from '@angular/common';
import { Component, EventEmitter, Input, Output, inject } from '@angular/core';
import { TranslateModule } from '@ngx-translate/core';
import { FontIconComponent } from '@ta/icons';
import { FileType, TaDocumentsService } from '@ta/services';
import { ButtonToolComponent, EmptyComponent, ErrorComponent, LinkComponent, LoaderComponent, MegaoctetComponent, TextComponent, TimeAgoComponent, } from '@ta/ui';
import { TaBaseComponent, downloadFile } from '@ta/utils';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class DocumentsListComponent extends TaBaseComponent {
    constructor() {
        super(...arguments);
        this.emptyMessage = '';
        this.actions = '';
        this.defaultSelected = [];
        this.readonly = false;
        this.remove = new EventEmitter();
        this.checkedFilesChanged = new EventEmitter();
        this._documentsService = inject(TaDocumentsService);
        this._checkedFiles = [];
        this.FileType = FileType;
    }
    get documents$() {
        return this._documentsService.getDocuments$(this.documentsIds);
    }
    ngOnInit() {
        this._fetch();
    }
    ngOnChanges(changes) {
        // this._fetch();
    }
    openDocument(doc) {
        downloadFile(doc.url);
    }
    removeDocument(doc) {
        this.remove.emit(doc.id);
    }
    isChecked(doc) {
        return this._checkedFiles.find(x => x.id === doc.id);
    }
    check(doc) {
        if (this.isChecked(doc)) {
            this._checkedFiles = this._checkedFiles.filter(x => x.id !== doc.id);
        }
        else {
            this._checkedFiles.push({ id: doc.id, name: doc.description, url: doc.url });
        }
        this.checkedFilesChanged.emit(this._checkedFiles);
    }
    _fetch() {
        this.requestState.asked();
        this._documentsService.fetchDocuments$(this.documentsIds).subscribe({
            next: documents => {
                this._checkedFiles = documents.filter(doc => this.defaultSelected.includes(doc.id));
            },
            complete: () => this.requestState.completed(),
            error: (error) => {
                this.requestState.onError(error.status, error.statusText);
            },
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DocumentsListComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: DocumentsListComponent, isStandalone: true, selector: "ta-documents-list", inputs: { documentsIds: "documentsIds", emptyMessage: "emptyMessage", actions: "actions", defaultSelected: "defaultSelected", readonly: "readonly" }, outputs: { remove: "remove", checkedFilesChanged: "checkedFilesChanged" }, usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<ta-loader [isLoading]=\"this.requestState.isLoading()\" *ngLet=\"this.documents$ | async as documents\">\n  <ta-error [message]=\"this.requestState.getErrorMessage()\" [code]=\"this.requestState.getErrorStatus()\">\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage\"\n      [showMessage]=\"!!this.emptyMessage\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n          <div>\n            <ng-container\n              *ngTemplateOutlet=\"this.actions !== 'select' ? defaultTemplate : selectTemplate; context: { doc: doc }\"\n            ></ng-container>\n          </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{ doc.name }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions === 'select') {\n        <input [disabled]=\"this.readonly\" type=\"checkbox\" [checked]=\"this.isChecked(doc)\" (click)=\"this.check(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool\n          (action)=\"this.removeDocument(doc)\"\n          icon=\"delete\"\n          [size]=\"'sm'\"\n          [readonly]=\"this.readonly\"\n        ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link [bold]=\"true\" [underline]=\"false\" (click)=\"$event.stopPropagation()\" (action)=\"this.openDocument(doc)\">\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{ 'communication.documents.file-type.' + this.FileType[doc.fileType].toLocaleLowerCase() | translate }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions === 'select') {\n        <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool (action)=\"this.removeDocument(doc)\" icon=\"delete\" [size]=\"'sm'\"></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);line-height:var(--ta-font-body-sm-default-line);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: ButtonToolComponent, selector: "ta-button-tool", inputs: ["state", "type", "size", "icon", "stopPropagationActivation", "readonly"], outputs: ["action"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ErrorComponent, selector: "ta-error", inputs: ["message", "code"] }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: LinkComponent, selector: "ta-link", inputs: ["state", "underline", "bold", "size", "icon"], outputs: ["action"] }, { kind: "component", type: LoaderComponent, selector: "ta-loader", inputs: ["isLoading", "skeleton", "size", "text"] }, { kind: "component", type: MegaoctetComponent, selector: "ta-megaoctet", inputs: ["octet", "icon"] }, { kind: "component", type: TextComponent, selector: "ta-text", inputs: ["size", "isBold", "color"] }, { kind: "component", type: TimeAgoComponent, selector: "ta-time-ago", inputs: ["date", "withHours"] }, { kind: "ngmodule", type: TranslateModule }, { kind: "pipe", type: i1.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DocumentsListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-documents-list', standalone: true, imports: [
                        NgIf,
                        NgFor,
                        AsyncPipe,
                        ButtonToolComponent,
                        EmptyComponent,
                        ErrorComponent,
                        FontIconComponent,
                        LinkComponent,
                        LoaderComponent,
                        MegaoctetComponent,
                        TextComponent,
                        TimeAgoComponent,
                        TranslateModule,
                    ], template: "<ta-loader [isLoading]=\"this.requestState.isLoading()\" *ngLet=\"this.documents$ | async as documents\">\n  <ta-error [message]=\"this.requestState.getErrorMessage()\" [code]=\"this.requestState.getErrorStatus()\">\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage\"\n      [showMessage]=\"!!this.emptyMessage\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n          <div>\n            <ng-container\n              *ngTemplateOutlet=\"this.actions !== 'select' ? defaultTemplate : selectTemplate; context: { doc: doc }\"\n            ></ng-container>\n          </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{ doc.name }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions === 'select') {\n        <input [disabled]=\"this.readonly\" type=\"checkbox\" [checked]=\"this.isChecked(doc)\" (click)=\"this.check(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool\n          (action)=\"this.removeDocument(doc)\"\n          icon=\"delete\"\n          [size]=\"'sm'\"\n          [readonly]=\"this.readonly\"\n        ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link [bold]=\"true\" [underline]=\"false\" (click)=\"$event.stopPropagation()\" (action)=\"this.openDocument(doc)\">\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{ 'communication.documents.file-type.' + this.FileType[doc.fileType].toLocaleLowerCase() | translate }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions === 'select') {\n        <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions === 'delete') {\n        <ta-button-tool (action)=\"this.removeDocument(doc)\" icon=\"delete\" [size]=\"'sm'\"></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);line-height:var(--ta-font-body-sm-default-line);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"] }]
        }], propDecorators: { documentsIds: [{
                type: Input
            }], emptyMessage: [{
                type: Input
            }], actions: [{
                type: Input
            }], defaultSelected: [{
                type: Input
            }], readonly: [{
                type: Input
            }], remove: [{
                type: Output
            }], checkedFilesChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBaUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWpILE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUd0RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUMsT0FBTyxFQUFlLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN6RSxPQUFPLEVBQ0wsbUJBQW1CLEVBQ25CLGNBQWMsRUFDZCxjQUFjLEVBQ2QsYUFBYSxFQUNiLGVBQWUsRUFDZixrQkFBa0IsRUFDbEIsYUFBYSxFQUNiLGdCQUFnQixHQUNqQixNQUFNLFFBQVEsQ0FBQztBQUNoQixPQUFPLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxNQUFNLFdBQVcsQ0FBQzs7O0FBdUIxRCxNQUFNLE9BQU8sc0JBQXVCLFNBQVEsZUFBZTtJQXJCM0Q7O1FBMEJFLGlCQUFZLEdBQVcsRUFBRSxDQUFDO1FBRzFCLFlBQU8sR0FBNkIsRUFBRSxDQUFDO1FBR3ZDLG9CQUFlLEdBQWEsRUFBRSxDQUFDO1FBRy9CLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFHMUIsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFHcEMsd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQXNCLENBQUM7UUFFNUMsc0JBQWlCLEdBQUcsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFeEQsa0JBQWEsR0FBdUIsRUFBRSxDQUFDO1FBQ3hDLGFBQVEsR0FBRyxRQUFRLENBQUM7S0ErQzVCO0lBN0NDLElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxpQkFBaUI7SUFDbkIsQ0FBQztJQUVNLFlBQVksQ0FBQyxHQUFnQjtRQUNsQyxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7SUFFTSxjQUFjLENBQUMsR0FBZ0I7UUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFTSxTQUFTLENBQUMsR0FBZ0I7UUFDL0IsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFTSxLQUFLLENBQUMsR0FBZ0I7UUFDM0IsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0UsQ0FBQztRQUNELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFTyxNQUFNO1FBQ1osSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDbEUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxFQUFFO2dCQUNoQixJQUFJLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0RixDQUFDO1lBQ0QsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFO1lBQzdDLEtBQUssRUFBRSxDQUFDLEtBQXdCLEVBQUUsRUFBRTtnQkFDbEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDNUQsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7K0dBdkVVLHNCQUFzQjttR0FBdEIsc0JBQXNCLDBWQzFDbkMsZ2dHQTRFQSxtb0JEL0NJLFNBQVMsOENBQ1QsbUJBQW1CLG9LQUNuQixjQUFjLHdJQUNkLGNBQWMsa0ZBQ2QsaUJBQWlCLG1GQUNqQixhQUFhLGlJQUNiLGVBQWUseUdBQ2Ysa0JBQWtCLG9GQUNsQixhQUFhLHlGQUNiLGdCQUFnQixzRkFDaEIsZUFBZTs7NEZBR04sc0JBQXNCO2tCQXJCbEMsU0FBUzsrQkFDRSxtQkFBbUIsY0FHakIsSUFBSSxXQUNQO3dCQUNQLElBQUk7d0JBQ0osS0FBSzt3QkFDTCxTQUFTO3dCQUNULG1CQUFtQjt3QkFDbkIsY0FBYzt3QkFDZCxjQUFjO3dCQUNkLGlCQUFpQjt3QkFDakIsYUFBYTt3QkFDYixlQUFlO3dCQUNmLGtCQUFrQjt3QkFDbEIsYUFBYTt3QkFDYixnQkFBZ0I7d0JBQ2hCLGVBQWU7cUJBQ2hCOzhCQUlELFlBQVk7c0JBRFgsS0FBSztnQkFJTixZQUFZO3NCQURYLEtBQUs7Z0JBSU4sT0FBTztzQkFETixLQUFLO2dCQUlOLGVBQWU7c0JBRGQsS0FBSztnQkFJTixRQUFRO3NCQURQLEtBQUs7Z0JBSU4sTUFBTTtzQkFETCxNQUFNO2dCQUlQLG1CQUFtQjtzQkFEbEIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jUGlwZSwgTmdGb3IsIE5nSWYgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIGluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcblxuaW1wb3J0IHsgSW5wdXRVcGxvYWRWYWx1ZSB9IGZyb20gJ0B0YS9mb3JtLW1vZGVsJztcbmltcG9ydCB7IEZvbnRJY29uQ29tcG9uZW50IH0gZnJvbSAnQHRhL2ljb25zJztcbmltcG9ydCB7IERvY3VtZW50RHRvLCBGaWxlVHlwZSwgVGFEb2N1bWVudHNTZXJ2aWNlIH0gZnJvbSAnQHRhL3NlcnZpY2VzJztcbmltcG9ydCB7XG4gIEJ1dHRvblRvb2xDb21wb25lbnQsXG4gIEVtcHR5Q29tcG9uZW50LFxuICBFcnJvckNvbXBvbmVudCxcbiAgTGlua0NvbXBvbmVudCxcbiAgTG9hZGVyQ29tcG9uZW50LFxuICBNZWdhb2N0ZXRDb21wb25lbnQsXG4gIFRleHRDb21wb25lbnQsXG4gIFRpbWVBZ29Db21wb25lbnQsXG59IGZyb20gJ0B0YS91aSc7XG5pbXBvcnQgeyBUYUJhc2VDb21wb25lbnQsIGRvd25sb2FkRmlsZSB9IGZyb20gJ0B0YS91dGlscyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhLWRvY3VtZW50cy1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpc3QuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXN0LmNvbXBvbmVudC5zY3NzJ10sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBOZ0lmLFxuICAgIE5nRm9yLFxuICAgIEFzeW5jUGlwZSxcbiAgICBCdXR0b25Ub29sQ29tcG9uZW50LFxuICAgIEVtcHR5Q29tcG9uZW50LFxuICAgIEVycm9yQ29tcG9uZW50LFxuICAgIEZvbnRJY29uQ29tcG9uZW50LFxuICAgIExpbmtDb21wb25lbnQsXG4gICAgTG9hZGVyQ29tcG9uZW50LFxuICAgIE1lZ2FvY3RldENvbXBvbmVudCxcbiAgICBUZXh0Q29tcG9uZW50LFxuICAgIFRpbWVBZ29Db21wb25lbnQsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBEb2N1bWVudHNMaXN0Q29tcG9uZW50IGV4dGVuZHMgVGFCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBASW5wdXQoKVxuICBkb2N1bWVudHNJZHMhOiBzdHJpbmdbXTtcblxuICBASW5wdXQoKVxuICBlbXB0eU1lc3NhZ2U6IHN0cmluZyA9ICcnO1xuXG4gIEBJbnB1dCgpXG4gIGFjdGlvbnM6ICdkZWxldGUnIHwgJ3NlbGVjdCcgfCAnJyA9ICcnO1xuXG4gIEBJbnB1dCgpXG4gIGRlZmF1bHRTZWxlY3RlZDogc3RyaW5nW10gPSBbXTtcblxuICBASW5wdXQoKVxuICByZWFkb25seTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBPdXRwdXQoKVxuICByZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICBAT3V0cHV0KClcbiAgY2hlY2tlZEZpbGVzQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SW5wdXRVcGxvYWRWYWx1ZVtdPigpO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2RvY3VtZW50c1NlcnZpY2UgPSBpbmplY3QoVGFEb2N1bWVudHNTZXJ2aWNlKTtcblxuICBwcml2YXRlIF9jaGVja2VkRmlsZXM6IElucHV0VXBsb2FkVmFsdWVbXSA9IFtdO1xuICBwdWJsaWMgRmlsZVR5cGUgPSBGaWxlVHlwZTtcblxuICBnZXQgZG9jdW1lbnRzJCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnRzU2VydmljZS5nZXREb2N1bWVudHMkKHRoaXMuZG9jdW1lbnRzSWRzKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuX2ZldGNoKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgLy8gdGhpcy5fZmV0Y2goKTtcbiAgfVxuXG4gIHB1YmxpYyBvcGVuRG9jdW1lbnQoZG9jOiBEb2N1bWVudER0bykge1xuICAgIGRvd25sb2FkRmlsZShkb2MudXJsKTtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVEb2N1bWVudChkb2M6IERvY3VtZW50RHRvKSB7XG4gICAgdGhpcy5yZW1vdmUuZW1pdChkb2MuaWQpO1xuICB9XG5cbiAgcHVibGljIGlzQ2hlY2tlZChkb2M6IERvY3VtZW50RHRvKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NoZWNrZWRGaWxlcy5maW5kKHggPT4geC5pZCA9PT0gZG9jLmlkKTtcbiAgfVxuXG4gIHB1YmxpYyBjaGVjayhkb2M6IERvY3VtZW50RHRvKSB7XG4gICAgaWYgKHRoaXMuaXNDaGVja2VkKGRvYykpIHtcbiAgICAgIHRoaXMuX2NoZWNrZWRGaWxlcyA9IHRoaXMuX2NoZWNrZWRGaWxlcy5maWx0ZXIoeCA9PiB4LmlkICE9PSBkb2MuaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9jaGVja2VkRmlsZXMucHVzaCh7IGlkOiBkb2MuaWQsIG5hbWU6IGRvYy5kZXNjcmlwdGlvbiwgdXJsOiBkb2MudXJsIH0pO1xuICAgIH1cbiAgICB0aGlzLmNoZWNrZWRGaWxlc0NoYW5nZWQuZW1pdCh0aGlzLl9jaGVja2VkRmlsZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZmV0Y2goKSB7XG4gICAgdGhpcy5yZXF1ZXN0U3RhdGUuYXNrZWQoKTtcbiAgICB0aGlzLl9kb2N1bWVudHNTZXJ2aWNlLmZldGNoRG9jdW1lbnRzJCh0aGlzLmRvY3VtZW50c0lkcykuc3Vic2NyaWJlKHtcbiAgICAgIG5leHQ6IGRvY3VtZW50cyA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrZWRGaWxlcyA9IGRvY3VtZW50cy5maWx0ZXIoZG9jID0+IHRoaXMuZGVmYXVsdFNlbGVjdGVkLmluY2x1ZGVzKGRvYy5pZCkpO1xuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiAoKSA9PiB0aGlzLnJlcXVlc3RTdGF0ZS5jb21wbGV0ZWQoKSxcbiAgICAgIGVycm9yOiAoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHRoaXMucmVxdWVzdFN0YXRlLm9uRXJyb3IoZXJyb3Iuc3RhdHVzLCBlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn1cbiIsIjx0YS1sb2FkZXIgW2lzTG9hZGluZ109XCJ0aGlzLnJlcXVlc3RTdGF0ZS5pc0xvYWRpbmcoKVwiICpuZ0xldD1cInRoaXMuZG9jdW1lbnRzJCB8IGFzeW5jIGFzIGRvY3VtZW50c1wiPlxuICA8dGEtZXJyb3IgW21lc3NhZ2VdPVwidGhpcy5yZXF1ZXN0U3RhdGUuZ2V0RXJyb3JNZXNzYWdlKClcIiBbY29kZV09XCJ0aGlzLnJlcXVlc3RTdGF0ZS5nZXRFcnJvclN0YXR1cygpXCI+XG4gICAgPHRhLWVtcHR5XG4gICAgICBbaXNFbXB0eV09XCIhZG9jdW1lbnRzIHx8IGRvY3VtZW50cy5sZW5ndGggPT09IDBcIlxuICAgICAgW3RleHRdPVwidGhpcy5lbXB0eU1lc3NhZ2VcIlxuICAgICAgW3Nob3dNZXNzYWdlXT1cIiEhdGhpcy5lbXB0eU1lc3NhZ2VcIlxuICAgID5cbiAgICAgIDxkaXYgY2xhc3M9XCJsaXN0IGZsZXgtY29sdW1uIGctc3BhY2Utc21cIj5cbiAgICAgICAgQGZvciAoZG9jIG9mIGRvY3VtZW50czsgdHJhY2sgZG9jKSB7XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJ0aGlzLmFjdGlvbnMgIT09ICdzZWxlY3QnID8gZGVmYXVsdFRlbXBsYXRlIDogc2VsZWN0VGVtcGxhdGU7IGNvbnRleHQ6IHsgZG9jOiBkb2MgfVwiXG4gICAgICAgICAgICA+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIH1cbiAgICAgIDwvZGl2PlxuICAgIDwvdGEtZW1wdHk+XG4gIDwvdGEtZXJyb3I+XG48L3RhLWxvYWRlcj5cblxuPG5nLXRlbXBsYXRlICNkZWZhdWx0VGVtcGxhdGUgbGV0LWRvYz1cImRvY1wiPlxuICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgZy1zcGFjZS14cyBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiPlxuICAgIDxkaXYgY2xhc3M9XCJhbGlnbi1jZW50ZXJcIj5cbiAgICAgIDx0YS1mb250LWljb24gbmFtZT1cImRvY1wiIHNpemU9XCJ4c1wiPjwvdGEtZm9udC1pY29uPlxuICAgICAgPGRpdj5cbiAgICAgICAgPHRhLWxpbmsgW3VuZGVybGluZV09XCJmYWxzZVwiIChhY3Rpb24pPVwidGhpcy5vcGVuRG9jdW1lbnQoZG9jKVwiPnt7IGRvYy5uYW1lIH19PC90YS1saW5rPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZXh0cmEgZmxleC1yb3cgZy1zcGFjZS1tZFwiPlxuICAgICAgICAgIDx0YS10aW1lLWFnbyBbZGF0ZV09XCJkb2MudXBsb2FkZWREYXRlXCI+PC90YS10aW1lLWFnbz5cbiAgICAgICAgICA8dGEtbWVnYW9jdGV0IFtvY3RldF09XCJkb2Muc2l6ZVwiPjwvdGEtbWVnYW9jdGV0PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjdGEgYWxpZ24tY29udGVudC1jZW50ZXJcIj5cbiAgICAgIEBpZiAodGhpcy5hY3Rpb25zID09PSAnc2VsZWN0Jykge1xuICAgICAgICA8aW5wdXQgW2Rpc2FibGVkXT1cInRoaXMucmVhZG9ubHlcIiB0eXBlPVwiY2hlY2tib3hcIiBbY2hlY2tlZF09XCJ0aGlzLmlzQ2hlY2tlZChkb2MpXCIgKGNsaWNrKT1cInRoaXMuY2hlY2soZG9jKVwiIC8+XG4gICAgICB9IEBlbHNlIGlmICh0aGlzLmFjdGlvbnMgPT09ICdkZWxldGUnKSB7XG4gICAgICAgIDx0YS1idXR0b24tdG9vbFxuICAgICAgICAgIChhY3Rpb24pPVwidGhpcy5yZW1vdmVEb2N1bWVudChkb2MpXCJcbiAgICAgICAgICBpY29uPVwiZGVsZXRlXCJcbiAgICAgICAgICBbc2l6ZV09XCInc20nXCJcbiAgICAgICAgICBbcmVhZG9ubHldPVwidGhpcy5yZWFkb25seVwiXG4gICAgICAgID48L3RhLWJ1dHRvbi10b29sPlxuICAgICAgfVxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjc2VsZWN0VGVtcGxhdGUgbGV0LWRvYz1cImRvY1wiPlxuICA8ZGl2XG4gICAgY2xhc3M9XCJjYXJkLWRvY3VtZW50LXVwbG9hZCBmbGV4LXJvdyBnLXNwYWNlLXhzIGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCJcbiAgICBbY2xhc3Muc2VsZWN0ZWRdPVwidGhpcy5pc0NoZWNrZWQoZG9jKVwiXG4gICAgKGNsaWNrKT1cInRoaXMuY2hlY2soZG9jKVwiXG4gID5cbiAgICA8ZGl2IGNsYXNzPVwiZGlzcGxheSBmbGV4LWNvbHVtbiBhbGlnbi1pdGVtcy1zdGFydFwiPlxuICAgICAgPHRhLWxpbmsgW2JvbGRdPVwidHJ1ZVwiIFt1bmRlcmxpbmVdPVwiZmFsc2VcIiAoY2xpY2spPVwiJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXCIgKGFjdGlvbik9XCJ0aGlzLm9wZW5Eb2N1bWVudChkb2MpXCI+XG4gICAgICAgIHt7IGRvYy5uYW1lIH19XG4gICAgICA8L3RhLWxpbms+XG4gICAgICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgZy1zcGFjZS1tZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgPHRhLWZvbnQtaWNvbiBuYW1lPVwiZG9jXCIgc2l6ZT1cInhzXCI+PC90YS1mb250LWljb24+XG4gICAgICAgICAgPHRhLXRleHQ+XG4gICAgICAgICAgICB7eyAnY29tbXVuaWNhdGlvbi5kb2N1bWVudHMuZmlsZS10eXBlLicgKyB0aGlzLkZpbGVUeXBlW2RvYy5maWxlVHlwZV0udG9Mb2NhbGVMb3dlckNhc2UoKSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgIDwvdGEtdGV4dD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDx0YS1tZWdhb2N0ZXQgW2ljb25dPVwidHJ1ZVwiIFtvY3RldF09XCJkb2Muc2l6ZVwiPjwvdGEtbWVnYW9jdGV0PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImJ1dHRvbiBhbGlnbi1jb250ZW50LWNlbnRlclwiPlxuICAgICAgQGlmICh0aGlzLmFjdGlvbnMgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBbY2hlY2tlZF09XCJ0aGlzLmlzQ2hlY2tlZChkb2MpXCIgLz5cbiAgICAgIH0gQGVsc2UgaWYgKHRoaXMuYWN0aW9ucyA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgPHRhLWJ1dHRvbi10b29sIChhY3Rpb24pPVwidGhpcy5yZW1vdmVEb2N1bWVudChkb2MpXCIgaWNvbj1cImRlbGV0ZVwiIFtzaXplXT1cIidzbSdcIj48L3RhLWJ1dHRvbi10b29sPlxuICAgICAgfVxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=