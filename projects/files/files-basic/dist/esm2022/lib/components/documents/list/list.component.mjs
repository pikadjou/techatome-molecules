import { AsyncPipe, NgFor, NgIf } from "@angular/common";
import { Component, EventEmitter, Input, Output, inject, } from "@angular/core";
import { TranslateModule } from "@ngx-translate/core";
import { FontIconComponent } from "@ta/icons";
import { FileType, TaDocumentsService } from "@ta/services";
import { ButtonToolComponent, EmptyComponent, ErrorComponent, LinkComponent, LoaderComponent, MegaoctetComponent, TextComponent, TimeAgoComponent, } from "@ta/ui";
import { TaBaseComponent, downloadFile } from "@ta/utils";
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class DocumentsListComponent extends TaBaseComponent {
    constructor() {
        super(...arguments);
        this.emptyMessage = "";
        this.actions = "";
        this.defaultSelected = [];
        this.readonly = false;
        this.remove = new EventEmitter();
        this.checkedFilesChanged = new EventEmitter();
        this._documentsService = inject(TaDocumentsService);
        this._checkedFiles = [];
        this.FileType = FileType;
    }
    get documents$() {
        return this._documentsService.getDocuments$(this.documentsIds);
    }
    ngOnInit() {
        this._fetch();
    }
    ngOnChanges(changes) {
        // this._fetch();
    }
    openDocument(doc) {
        downloadFile(doc.url);
    }
    removeDocument(doc) {
        this.remove.emit(doc.id);
    }
    isChecked(doc) {
        return this._checkedFiles.find((x) => x.id === doc.id);
    }
    check(doc) {
        if (this.isChecked(doc)) {
            this._checkedFiles = this._checkedFiles.filter((x) => x.id !== doc.id);
        }
        else {
            this._checkedFiles.push({
                id: doc.id,
                name: doc.description,
                url: doc.url,
            });
        }
        this.checkedFilesChanged.emit(this._checkedFiles);
    }
    _fetch() {
        this.requestState.asked();
        this._documentsService.fetchDocuments$(this.documentsIds).subscribe({
            next: (documents) => {
                this._checkedFiles = documents.filter((doc) => this.defaultSelected.includes(doc.id));
            },
            complete: () => this.requestState.completed(),
            error: (error) => {
                this.requestState.onError(error.status, error.statusText);
            },
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DocumentsListComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: DocumentsListComponent, isStandalone: true, selector: "ta-documents-list", inputs: { documentsIds: "documentsIds", emptyMessage: "emptyMessage", actions: "actions", defaultSelected: "defaultSelected", readonly: "readonly" }, outputs: { remove: "remove", checkedFilesChanged: "checkedFilesChanged" }, usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<ta-loader\n  [isLoading]=\"this.requestState.isLoading()\"\n  *ngLet=\"this.documents$ | async as documents\"\n>\n  <ta-error\n    [message]=\"this.requestState.getErrorMessage()\"\n    [code]=\"this.requestState.getErrorStatus()\"\n  >\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage\"\n      [showMessage]=\"!!this.emptyMessage\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n        <div>\n          <ng-container\n            *ngTemplateOutlet=\"\n              this.actions !== 'select' ? defaultTemplate : selectTemplate;\n              context: { doc: doc }\n            \"\n          ></ng-container>\n        </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{\n          doc.name\n        }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions === 'select') {\n      <input\n        [disabled]=\"this.readonly\"\n        type=\"checkbox\"\n        [checked]=\"this.isChecked(doc)\"\n        (click)=\"this.check(doc)\"\n      />\n      } @else if (this.actions === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n        [readonly]=\"this.readonly\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link\n        [bold]=\"true\"\n        [underline]=\"false\"\n        (click)=\"$event.stopPropagation()\"\n        (action)=\"this.openDocument(doc)\"\n      >\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{\n              \"communication.documents.file-type.\" +\n                this.FileType[doc.fileType].toLocaleLowerCase() | translate\n            }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions === 'select') {\n      <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);line-height:var(--ta-font-body-sm-default-line);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: ButtonToolComponent, selector: "ta-button-tool", inputs: ["state", "type", "size", "icon", "stopPropagationActivation", "readonly"], outputs: ["action"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ErrorComponent, selector: "ta-error", inputs: ["message", "code"] }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: LinkComponent, selector: "ta-link", inputs: ["state", "underline", "bold", "size", "icon"], outputs: ["action"] }, { kind: "component", type: LoaderComponent, selector: "ta-loader", inputs: ["isLoading", "skeleton", "size", "text"] }, { kind: "component", type: MegaoctetComponent, selector: "ta-megaoctet", inputs: ["octet", "icon"] }, { kind: "component", type: TextComponent, selector: "ta-text", inputs: ["size", "isBold", "color"] }, { kind: "component", type: TimeAgoComponent, selector: "ta-time-ago", inputs: ["date", "withHours"] }, { kind: "ngmodule", type: TranslateModule }, { kind: "pipe", type: i1.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DocumentsListComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-documents-list", standalone: true, imports: [
                        NgIf,
                        NgFor,
                        AsyncPipe,
                        ButtonToolComponent,
                        EmptyComponent,
                        ErrorComponent,
                        FontIconComponent,
                        LinkComponent,
                        LoaderComponent,
                        MegaoctetComponent,
                        TextComponent,
                        TimeAgoComponent,
                        TranslateModule,
                    ], template: "<ta-loader\n  [isLoading]=\"this.requestState.isLoading()\"\n  *ngLet=\"this.documents$ | async as documents\"\n>\n  <ta-error\n    [message]=\"this.requestState.getErrorMessage()\"\n    [code]=\"this.requestState.getErrorStatus()\"\n  >\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage\"\n      [showMessage]=\"!!this.emptyMessage\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n        <div>\n          <ng-container\n            *ngTemplateOutlet=\"\n              this.actions !== 'select' ? defaultTemplate : selectTemplate;\n              context: { doc: doc }\n            \"\n          ></ng-container>\n        </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{\n          doc.name\n        }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions === 'select') {\n      <input\n        [disabled]=\"this.readonly\"\n        type=\"checkbox\"\n        [checked]=\"this.isChecked(doc)\"\n        (click)=\"this.check(doc)\"\n      />\n      } @else if (this.actions === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n        [readonly]=\"this.readonly\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link\n        [bold]=\"true\"\n        [underline]=\"false\"\n        (click)=\"$event.stopPropagation()\"\n        (action)=\"this.openDocument(doc)\"\n      >\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{\n              \"communication.documents.file-type.\" +\n                this.FileType[doc.fileType].toLocaleLowerCase() | translate\n            }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions === 'select') {\n      <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);line-height:var(--ta-font-body-sm-default-line);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"] }]
        }], propDecorators: { documentsIds: [{
                type: Input
            }], emptyMessage: [{
                type: Input
            }], actions: [{
                type: Input
            }], defaultSelected: [{
                type: Input
            }], readonly: [{
                type: Input
            }], remove: [{
                type: Output
            }], checkedFilesChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV6RCxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUVOLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBZSxRQUFRLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekUsT0FBTyxFQUNMLG1CQUFtQixFQUNuQixjQUFjLEVBQ2QsY0FBYyxFQUNkLGFBQWEsRUFDYixlQUFlLEVBQ2Ysa0JBQWtCLEVBQ2xCLGFBQWEsRUFDYixnQkFBZ0IsR0FDakIsTUFBTSxRQUFRLENBQUM7QUFDaEIsT0FBTyxFQUFFLGVBQWUsRUFBRSxZQUFZLEVBQUUsTUFBTSxXQUFXLENBQUM7OztBQXVCMUQsTUFBTSxPQUFPLHNCQUNYLFNBQVEsZUFBZTtJQXRCekI7O1FBNkJFLGlCQUFZLEdBQVcsRUFBRSxDQUFDO1FBRzFCLFlBQU8sR0FBNkIsRUFBRSxDQUFDO1FBR3ZDLG9CQUFlLEdBQWEsRUFBRSxDQUFDO1FBRy9CLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFHMUIsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFHcEMsd0JBQW1CLEdBQUcsSUFBSSxZ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QW1CLGNBR2pCLElBQUksV0FDUDt3QkFDUCxJQUFJO3dCQUNKLEtBQUs7d0JBQ0wsU0FBUzt3QkFDVCxtQkFBbUI7d0JBQ25CLGNBQWM7d0JBQ2QsY0FBYzt3QkFDZCxpQkFBaUI7d0JBQ2pCLGFBQWE7d0JBQ2IsZUFBZTt3QkFDZixrQkFBa0I7d0JBQ2xCLGFBQWE7d0JBQ2IsZ0JBQWdCO3dCQUNoQixlQUFlO3FCQUNoQjs4QkFPRCxZQUFZO3NCQURYLEtBQUs7Z0JBSU4sWUFBWTtzQkFEWCxLQUFLO2dCQUlOLE9BQU87c0JBRE4sS0FBSztnQkFJTixlQUFlO3NCQURkLEtBQUs7Z0JBSU4sUUFBUTtzQkFEUCxLQUFLO2dCQUlOLE1BQU07c0JBREwsTUFBTTtnQkFJUCxtQkFBbUI7c0JBRGxCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY1BpcGUsIE5nRm9yLCBOZ0lmIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgaW5qZWN0LFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tIFwiQG5neC10cmFuc2xhdGUvY29yZVwiO1xuXG5pbXBvcnQgeyBJbnB1dFVwbG9hZFZhbHVlIH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gXCJAdGEvaWNvbnNcIjtcbmltcG9ydCB7IERvY3VtZW50RHRvLCBGaWxlVHlwZSwgVGFEb2N1bWVudHNTZXJ2aWNlIH0gZnJvbSBcIkB0YS9zZXJ2aWNlc1wiO1xuaW1wb3J0IHtcbiAgQnV0dG9uVG9vbENvbXBvbmVudCxcbiAgRW1wdHlDb21wb25lbnQsXG4gIEVycm9yQ29tcG9uZW50LFxuICBMaW5rQ29tcG9uZW50LFxuICBMb2FkZXJDb21wb25lbnQsXG4gIE1lZ2FvY3RldENvbXBvbmVudCxcbiAgVGV4dENvbXBvbmVudCxcbiAgVGltZUFnb0NvbXBvbmVudCxcbn0gZnJvbSBcIkB0YS91aVwiO1xuaW1wb3J0IHsgVGFCYXNlQ29tcG9uZW50LCBkb3dubG9hZEZpbGUgfSBmcm9tIFwiQHRhL3V0aWxzXCI7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0YS1kb2N1bWVudHMtbGlzdFwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL2xpc3QuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL2xpc3QuY29tcG9uZW50LnNjc3NcIl0sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBOZ0lmLFxuICAgIE5nRm9yLFxuICAgIEFzeW5jUGlwZSxcbiAgICBCdXR0b25Ub29sQ29tcG9uZW50LFxuICAgIEVtcHR5Q29tcG9uZW50LFxuICAgIEVycm9yQ29tcG9uZW50LFxuICAgIEZvbnRJY29uQ29tcG9uZW50LFxuICAgIExpbmtDb21wb25lbnQsXG4gICAgTG9hZGVyQ29tcG9uZW50LFxuICAgIE1lZ2FvY3RldENvbXBvbmVudCxcbiAgICBUZXh0Q29tcG9uZW50LFxuICAgIFRpbWVBZ29Db21wb25lbnQsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBEb2N1bWVudHNMaXN0Q29tcG9uZW50XG4gIGV4dGVuZHMgVGFCYXNlQ29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXNcbntcbiAgQElucHV0KClcbiAgZG9jdW1lbnRzSWRzITogc3RyaW5nW107XG5cbiAgQElucHV0KClcbiAgZW1wdHlNZXNzYWdlOiBzdHJpbmcgPSBcIlwiO1xuXG4gIEBJbnB1dCgpXG4gIGFjdGlvbnM6IFwiZGVsZXRlXCIgfCBcInNlbGVjdFwiIHwgXCJcIiA9IFwiXCI7XG5cbiAgQElucHV0KClcbiAgZGVmYXVsdFNlbGVjdGVkOiBzdHJpbmdbXSA9IFtdO1xuXG4gIEBJbnB1dCgpXG4gIHJlYWRvbmx5OiBib29sZWFuID0gZmFsc2U7XG5cbiAgQE91dHB1dCgpXG4gIHJlbW92ZSA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuXG4gIEBPdXRwdXQoKVxuICBjaGVja2VkRmlsZXNDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxJbnB1dFVwbG9hZFZhbHVlW10+KCk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfZG9jdW1lbnRzU2VydmljZSA9IGluamVjdChUYURvY3VtZW50c1NlcnZpY2UpO1xuXG4gIHByaXZhdGUgX2NoZWNrZWRGaWxlczogSW5wdXRVcGxvYWRWYWx1ZVtdID0gW107XG4gIHB1YmxpYyBGaWxlVHlwZSA9IEZpbGVUeXBlO1xuXG4gIGdldCBkb2N1bWVudHMkKCkge1xuICAgIHJldHVybiB0aGlzLl9kb2N1bWVudHNTZXJ2aWNlLmdldERvY3VtZW50cyQodGhpcy5kb2N1bWVudHNJZHMpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5fZmV0Y2goKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvLyB0aGlzLl9mZXRjaCgpO1xuICB9XG5cbiAgcHVibGljIG9wZW5Eb2N1bWVudChkb2M6IERvY3VtZW50RHRvKSB7XG4gICAgZG93bmxvYWRGaWxlKGRvYy51cmwpO1xuICB9XG5cbiAgcHVibGljIHJlbW92ZURvY3VtZW50KGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICB0aGlzLnJlbW92ZS5lbWl0KGRvYy5pZCk7XG4gIH1cblxuICBwdWJsaWMgaXNDaGVja2VkKGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICByZXR1cm4gdGhpcy5fY2hlY2tlZEZpbGVzLmZpbmQoKHgpID0+IHguaWQgPT09IGRvYy5pZCk7XG4gIH1cblxuICBwdWJsaWMgY2hlY2soZG9jOiBEb2N1bWVudER0bykge1xuICAgIGlmICh0aGlzLmlzQ2hlY2tlZChkb2MpKSB7XG4gICAgICB0aGlzLl9jaGVja2VkRmlsZXMgPSB0aGlzLl9jaGVja2VkRmlsZXMuZmlsdGVyKCh4KSA9PiB4LmlkICE9PSBkb2MuaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9jaGVja2VkRmlsZXMucHVzaCh7XG4gICAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAgIG5hbWU6IGRvYy5kZXNjcmlwdGlvbixcbiAgICAgICAgdXJsOiBkb2MudXJsLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuY2hlY2tlZEZpbGVzQ2hhbmdlZC5lbWl0KHRoaXMuX2NoZWNrZWRGaWxlcyk7XG4gIH1cblxuICBwcml2YXRlIF9mZXRjaCgpIHtcbiAgICB0aGlzLnJlcXVlc3RTdGF0ZS5hc2tlZCgpO1xuICAgIHRoaXMuX2RvY3VtZW50c1NlcnZpY2UuZmV0Y2hEb2N1bWVudHMkKHRoaXMuZG9jdW1lbnRzSWRzKS5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKGRvY3VtZW50cykgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja2VkRmlsZXMgPSBkb2N1bWVudHMuZmlsdGVyKChkb2MpID0+XG4gICAgICAgICAgdGhpcy5kZWZhdWx0U2VsZWN0ZWQuaW5jbHVkZXMoZG9jLmlkKVxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiAoKSA9PiB0aGlzLnJlcXVlc3RTdGF0ZS5jb21wbGV0ZWQoKSxcbiAgICAgIGVycm9yOiAoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHRoaXMucmVxdWVzdFN0YXRlLm9uRXJyb3IoZXJyb3Iuc3RhdHVzLCBlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn1cbiIsIjx0YS1sb2FkZXJcbiAgW2lzTG9hZGluZ109XCJ0aGlzLnJlcXVlc3RTdGF0ZS5pc0xvYWRpbmcoKVwiXG4gICpuZ0xldD1cInRoaXMuZG9jdW1lbnRzJCB8IGFzeW5jIGFzIGRvY3VtZW50c1wiXG4+XG4gIDx0YS1lcnJvclxuICAgIFttZXNzYWdlXT1cInRoaXMucmVxdWVzdFN0YXRlLmdldEVycm9yTWVzc2FnZSgpXCJcbiAgICBbY29kZV09XCJ0aGlzLnJlcXVlc3RTdGF0ZS5nZXRFcnJvclN0YXR1cygpXCJcbiAgPlxuICAgIDx0YS1lbXB0eVxuICAgICAgW2lzRW1wdHldPVwiIWRvY3VtZW50cyB8fCBkb2N1bWVudHMubGVuZ3RoID09PSAwXCJcbiAgICAgIFt0ZXh0XT1cInRoaXMuZW1wdHlNZXNzYWdlXCJcbiAgICAgIFtzaG93TWVzc2FnZV09XCIhIXRoaXMuZW1wdHlNZXNzYWdlXCJcbiAgICA+XG4gICAgICA8ZGl2IGNsYXNzPVwibGlzdCBmbGV4LWNvbHVtbiBnLXNwYWNlLXNtXCI+XG4gICAgICAgIEBmb3IgKGRvYyBvZiBkb2N1bWVudHM7IHRyYWNrIGRvYykge1xuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwiXG4gICAgICAgICAgICAgIHRoaXMuYWN0aW9ucyAhPT0gJ3NlbGVjdCcgPyBkZWZhdWx0VGVtcGxhdGUgOiBzZWxlY3RUZW1wbGF0ZTtcbiAgICAgICAgICAgICAgY29udGV4dDogeyBkb2M6IGRvYyB9XG4gICAgICAgICAgICBcIlxuICAgICAgICAgID48L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIH1cbiAgICAgIDwvZGl2PlxuICAgIDwvdGEtZW1wdHk+XG4gIDwvdGEtZXJyb3I+XG48L3RhLWxvYWRlcj5cblxuPG5nLXRlbXBsYXRlICNkZWZhdWx0VGVtcGxhdGUgbGV0LWRvYz1cImRvY1wiPlxuICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgZy1zcGFjZS14cyBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiPlxuICAgIDxkaXYgY2xhc3M9XCJhbGlnbi1jZW50ZXJcIj5cbiAgICAgIDx0YS1mb250LWljb24gbmFtZT1cImRvY1wiIHNpemU9XCJ4c1wiPjwvdGEtZm9udC1pY29uPlxuICAgICAgPGRpdj5cbiAgICAgICAgPHRhLWxpbmsgW3VuZGVybGluZV09XCJmYWxzZVwiIChhY3Rpb24pPVwidGhpcy5vcGVuRG9jdW1lbnQoZG9jKVwiPnt7XG4gICAgICAgICAgZG9jLm5hbWVcbiAgICAgICAgfX08L3RhLWxpbms+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJleHRyYSBmbGV4LXJvdyBnLXNwYWNlLW1kXCI+XG4gICAgICAgICAgPHRhLXRpbWUtYWdvIFtkYXRlXT1cImRvYy51cGxvYWRlZERhdGVcIj48L3RhLXRpbWUtYWdvPlxuICAgICAgICAgIDx0YS1tZWdhb2N0ZXQgW29jdGV0XT1cImRvYy5zaXplXCI+PC90YS1tZWdhb2N0ZXQ+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImN0YSBhbGlnbi1jb250ZW50LWNlbnRlclwiPlxuICAgICAgQGlmICh0aGlzLmFjdGlvbnMgPT09ICdzZWxlY3QnKSB7XG4gICAgICA8aW5wdXRcbiAgICAgICAgW2Rpc2FibGVkXT1cInRoaXMucmVhZG9ubHlcIlxuICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICBbY2hlY2tlZF09XCJ0aGlzLmlzQ2hlY2tlZChkb2MpXCJcbiAgICAgICAgKGNsaWNrKT1cInRoaXMuY2hlY2soZG9jKVwiXG4gICAgICAvPlxuICAgICAgfSBAZWxzZSBpZiAodGhpcy5hY3Rpb25zID09PSAnZGVsZXRlJykge1xuICAgICAgPHRhLWJ1dHRvbi10b29sXG4gICAgICAgIChhY3Rpb24pPVwidGhpcy5yZW1vdmVEb2N1bWVudChkb2MpXCJcbiAgICAgICAgaWNvbj1cImRlbGV0ZVwiXG4gICAgICAgIFtzaXplXT1cIidzbSdcIlxuICAgICAgICBbcmVhZG9ubHldPVwidGhpcy5yZWFkb25seVwiXG4gICAgICA+PC90YS1idXR0b24tdG9vbD5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3NlbGVjdFRlbXBsYXRlIGxldC1kb2M9XCJkb2NcIj5cbiAgPGRpdlxuICAgIGNsYXNzPVwiY2FyZC1kb2N1bWVudC11cGxvYWQgZmxleC1yb3cgZy1zcGFjZS14cyBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiXG4gICAgW2NsYXNzLnNlbGVjdGVkXT1cInRoaXMuaXNDaGVja2VkKGRvYylcIlxuICAgIChjbGljayk9XCJ0aGlzLmNoZWNrKGRvYylcIlxuICA+XG4gICAgPGRpdiBjbGFzcz1cImRpc3BsYXkgZmxleC1jb2x1bW4gYWxpZ24taXRlbXMtc3RhcnRcIj5cbiAgICAgIDx0YS1saW5rXG4gICAgICAgIFtib2xkXT1cInRydWVcIlxuICAgICAgICBbdW5kZXJsaW5lXT1cImZhbHNlXCJcbiAgICAgICAgKGNsaWNrKT1cIiRldmVudC5zdG9wUHJvcGFnYXRpb24oKVwiXG4gICAgICAgIChhY3Rpb24pPVwidGhpcy5vcGVuRG9jdW1lbnQoZG9jKVwiXG4gICAgICA+XG4gICAgICAgIHt7IGRvYy5uYW1lIH19XG4gICAgICA8L3RhLWxpbms+XG4gICAgICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgZy1zcGFjZS1tZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgPHRhLWZvbnQtaWNvbiBuYW1lPVwiZG9jXCIgc2l6ZT1cInhzXCI+PC90YS1mb250LWljb24+XG4gICAgICAgICAgPHRhLXRleHQ+XG4gICAgICAgICAgICB7e1xuICAgICAgICAgICAgICBcImNvbW11bmljYXRpb24uZG9jdW1lbnRzLmZpbGUtdHlwZS5cIiArXG4gICAgICAgICAgICAgICAgdGhpcy5GaWxlVHlwZVtkb2MuZmlsZVR5cGVdLnRvTG9jYWxlTG93ZXJDYXNlKCkgfCB0cmFuc2xhdGVcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPC90YS10ZXh0PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPHRhLW1lZ2FvY3RldCBbaWNvbl09XCJ0cnVlXCIgW29jdGV0XT1cImRvYy5zaXplXCI+PC90YS1tZWdhb2N0ZXQ+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIGFsaWduLWNvbnRlbnQtY2VudGVyXCI+XG4gICAgICBAaWYgKHRoaXMuYWN0aW9ucyA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBbY2hlY2tlZF09XCJ0aGlzLmlzQ2hlY2tlZChkb2MpXCIgLz5cbiAgICAgIH0gQGVsc2UgaWYgKHRoaXMuYWN0aW9ucyA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgIDx0YS1idXR0b24tdG9vbFxuICAgICAgICAoYWN0aW9uKT1cInRoaXMucmVtb3ZlRG9jdW1lbnQoZG9jKVwiXG4gICAgICAgIGljb249XCJkZWxldGVcIlxuICAgICAgICBbc2l6ZV09XCInc20nXCJcbiAgICAgID48L3RhLWJ1dHRvbi10b29sPlxuICAgICAgfVxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=