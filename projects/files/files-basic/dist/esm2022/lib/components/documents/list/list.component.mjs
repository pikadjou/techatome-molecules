import { AsyncPipe, NgFor, NgIf } from "@angular/common";
import { Component, EventEmitter, Output, inject, input, } from "@angular/core";
import { TranslateModule } from "@ngx-translate/core";
import { FontIconComponent } from "@ta/icons";
import { FileType, TaDocumentsService } from "@ta/services";
import { ButtonToolComponent, EmptyComponent, ErrorComponent, LinkComponent, LoaderComponent, MegaoctetComponent, TextComponent, TimeAgoComponent, } from "@ta/ui";
import { TaBaseComponent, downloadFile } from "@ta/utils";
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class DocumentsListComponent extends TaBaseComponent {
    constructor() {
        super(...arguments);
        this.documentsIds = input.required();
        this.emptyMessage = input("");
        this.actions = input("");
        this.defaultSelected = input([]);
        this.readonly = input(false);
        this.remove = new EventEmitter();
        this.checkedFilesChanged = new EventEmitter();
        this._documentsService = inject(TaDocumentsService);
        this._checkedFiles = [];
        this.FileType = FileType;
    }
    get documents$() {
        return this._documentsService.getDocuments$(this.documentsIds());
    }
    ngOnInit() {
        this._fetch();
    }
    ngOnChanges(changes) {
        // this._fetch();
    }
    openDocument(doc) {
        downloadFile(doc.url);
    }
    removeDocument(doc) {
        this.remove.emit(doc.id);
    }
    isChecked(doc) {
        return this._checkedFiles.find((x) => x.id === doc.id);
    }
    check(doc) {
        if (this.isChecked(doc)) {
            this._checkedFiles = this._checkedFiles.filter((x) => x.id !== doc.id);
        }
        else {
            this._checkedFiles.push({
                id: doc.id,
                name: doc.description,
                url: doc.url,
            });
        }
        this.checkedFilesChanged.emit(this._checkedFiles);
    }
    _fetch() {
        this.requestState.asked();
        this._documentsService.fetchDocuments$(this.documentsIds()).subscribe({
            next: (documents) => {
                this._checkedFiles = documents.filter((doc) => this.defaultSelected().includes(doc.id));
            },
            complete: () => this.requestState.completed(),
            error: (error) => {
                this.requestState.onError(error.status, error.statusText);
            },
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DocumentsListComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: DocumentsListComponent, isStandalone: true, selector: "ta-documents-list", inputs: { documentsIds: { classPropertyName: "documentsIds", publicName: "documentsIds", isSignal: true, isRequired: true, transformFunction: null }, emptyMessage: { classPropertyName: "emptyMessage", publicName: "emptyMessage", isSignal: true, isRequired: false, transformFunction: null }, actions: { classPropertyName: "actions", publicName: "actions", isSignal: true, isRequired: false, transformFunction: null }, defaultSelected: { classPropertyName: "defaultSelected", publicName: "defaultSelected", isSignal: true, isRequired: false, transformFunction: null }, readonly: { classPropertyName: "readonly", publicName: "readonly", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { remove: "remove", checkedFilesChanged: "checkedFilesChanged" }, usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<ta-loader\n  [isLoading]=\"this.requestState.isLoading()\"\n  *ngLet=\"this.documents$ | async as documents\"\n>\n  <ta-error\n    [message]=\"this.requestState.getErrorMessage()\"\n    [code]=\"this.requestState.getErrorStatus()\"\n  >\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage()\"\n      [showMessage]=\"!!this.emptyMessage()\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n        <div>\n          <ng-container\n            *ngTemplateOutlet=\"\n              this.actions() !== 'select' ? defaultTemplate : selectTemplate;\n              context: { doc: doc }\n            \"\n          ></ng-container>\n        </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{\n          doc.name\n        }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions() === 'select') {\n      <input\n        [disabled]=\"this.readonly()\"\n        type=\"checkbox\"\n        [checked]=\"this.isChecked(doc)\"\n        (click)=\"this.check(doc)\"\n      />\n      } @else if (this.actions() === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n        [readonly]=\"this.readonly()\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link\n        [bold]=\"true\"\n        [underline]=\"false\"\n        (click)=\"$event.stopPropagation()\"\n        (action)=\"this.openDocument(doc)\"\n      >\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{\n              \"communication.documents.file-type.\" +\n                this.FileType[doc.fileType].toLocaleLowerCase() | translate\n            }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions() === 'select') {\n      <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions() === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: ButtonToolComponent, selector: "ta-button-tool", inputs: ["state", "type", "size", "icon", "stopPropagationActivation", "readonly"], outputs: ["action"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ErrorComponent, selector: "ta-error", inputs: ["message", "code"] }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: LinkComponent, selector: "ta-link", inputs: ["state", "underline", "bold", "size", "icon"], outputs: ["action"] }, { kind: "component", type: LoaderComponent, selector: "ta-loader", inputs: ["isLoading", "skeleton", "size", "text"] }, { kind: "component", type: MegaoctetComponent, selector: "ta-megaoctet", inputs: ["octet", "icon"] }, { kind: "component", type: TextComponent, selector: "ta-text", inputs: ["size", "isBold", "color"] }, { kind: "component", type: TimeAgoComponent, selector: "ta-time-ago", inputs: ["date", "withHours"] }, { kind: "ngmodule", type: TranslateModule }, { kind: "pipe", type: i1.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DocumentsListComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-documents-list", standalone: true, imports: [
                        NgIf,
                        NgFor,
                        AsyncPipe,
                        ButtonToolComponent,
                        EmptyComponent,
                        ErrorComponent,
                        FontIconComponent,
                        LinkComponent,
                        LoaderComponent,
                        MegaoctetComponent,
                        TextComponent,
                        TimeAgoComponent,
                        TranslateModule,
                    ], template: "<ta-loader\n  [isLoading]=\"this.requestState.isLoading()\"\n  *ngLet=\"this.documents$ | async as documents\"\n>\n  <ta-error\n    [message]=\"this.requestState.getErrorMessage()\"\n    [code]=\"this.requestState.getErrorStatus()\"\n  >\n    <ta-empty\n      [isEmpty]=\"!documents || documents.length === 0\"\n      [text]=\"this.emptyMessage()\"\n      [showMessage]=\"!!this.emptyMessage()\"\n    >\n      <div class=\"list flex-column g-space-sm\">\n        @for (doc of documents; track doc) {\n        <div>\n          <ng-container\n            *ngTemplateOutlet=\"\n              this.actions() !== 'select' ? defaultTemplate : selectTemplate;\n              context: { doc: doc }\n            \"\n          ></ng-container>\n        </div>\n        }\n      </div>\n    </ta-empty>\n  </ta-error>\n</ta-loader>\n\n<ng-template #defaultTemplate let-doc=\"doc\">\n  <div class=\"flex-row g-space-xs justify-content-between\">\n    <div class=\"align-center\">\n      <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n      <div>\n        <ta-link [underline]=\"false\" (action)=\"this.openDocument(doc)\">{{\n          doc.name\n        }}</ta-link>\n        <div class=\"extra flex-row g-space-md\">\n          <ta-time-ago [date]=\"doc.uploadedDate\"></ta-time-ago>\n          <ta-megaoctet [octet]=\"doc.size\"></ta-megaoctet>\n        </div>\n      </div>\n    </div>\n    <div class=\"cta align-content-center\">\n      @if (this.actions() === 'select') {\n      <input\n        [disabled]=\"this.readonly()\"\n        type=\"checkbox\"\n        [checked]=\"this.isChecked(doc)\"\n        (click)=\"this.check(doc)\"\n      />\n      } @else if (this.actions() === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n        [readonly]=\"this.readonly()\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #selectTemplate let-doc=\"doc\">\n  <div\n    class=\"card-document-upload flex-row g-space-xs justify-content-between\"\n    [class.selected]=\"this.isChecked(doc)\"\n    (click)=\"this.check(doc)\"\n  >\n    <div class=\"display flex-column align-items-start\">\n      <ta-link\n        [bold]=\"true\"\n        [underline]=\"false\"\n        (click)=\"$event.stopPropagation()\"\n        (action)=\"this.openDocument(doc)\"\n      >\n        {{ doc.name }}\n      </ta-link>\n      <div class=\"flex-row g-space-md\">\n        <div class=\"flex-row align-items-center\">\n          <ta-font-icon name=\"doc\" size=\"xs\"></ta-font-icon>\n          <ta-text>\n            {{\n              \"communication.documents.file-type.\" +\n                this.FileType[doc.fileType].toLocaleLowerCase() | translate\n            }}\n          </ta-text>\n        </div>\n        <ta-megaoctet [icon]=\"true\" [octet]=\"doc.size\"></ta-megaoctet>\n      </div>\n    </div>\n    <div class=\"button align-content-center\">\n      @if (this.actions() === 'select') {\n      <input type=\"checkbox\" [checked]=\"this.isChecked(doc)\" />\n      } @else if (this.actions() === 'delete') {\n      <ta-button-tool\n        (action)=\"this.removeDocument(doc)\"\n        icon=\"delete\"\n        [size]=\"'sm'\"\n      ></ta-button-tool>\n      }\n    </div>\n  </div>\n</ng-template>\n", styles: ["ta-font-icon{color:var(--ta-icon-brand-primary)}.extra{font-size:var(--ta-font-body-sm-default-size);font-weight:var(--ta-font-body-sm-default-weight);color:var(--ta-text-tertiary)}input{width:20px;height:20px}.button{padding:var(--ta-space-sm)}.card-document-upload{padding:var(--ta-space-md);margin-right:var(--ta-space-sm)}.card-document-upload.selected{border:1px solid var(--ta-border-brand);border-radius:var(--ta-radius-rounded);background-color:var(--ta-surface-brand-tertiary)}.card-document-upload .display{gap:var(--ta-space-sm)}\n"] }]
        }], propDecorators: { remove: [{
                type: Output
            }], checkedFilesChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZG9jdW1lbnRzL2xpc3QvbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV6RCxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFHWixNQUFNLEVBRU4sTUFBTSxFQUNOLEtBQUssR0FDTixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBZSxRQUFRLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekUsT0FBTyxFQUNMLG1CQUFtQixFQUNuQixjQUFjLEVBQ2QsY0FBYyxFQUNkLGFBQWEsRUFDYixlQUFlLEVBQ2Ysa0JBQWtCLEVBQ2xCLGFBQWEsRUFDYixnQkFBZ0IsR0FDakIsTUFBTSxRQUFRLENBQUM7QUFDaEIsT0FBTyxFQUFFLGVBQWUsRUFBRSxZQUFZLEVBQUUsTUFBTSxXQUFXLENBQUM7OztBQXVCMUQsTUFBTSxPQUFPLHNCQUNYLFNBQVEsZUFBZTtJQXRCekI7O1FBeUJFLGlCQUFZLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBWSxDQUFDO1FBRTFDLGlCQUFZLEdBQUcsS0FBSyxDQUFTLEVBQUUsQ0FBQyxDQUFDO1FBRWpDLFlBQU8sR0FBRyxLQUFLLENBQTJCLEVBQUUsQ0FBQyxDQUFDO1FBRTlDLG9CQUFlLEdBQUcsS0FBSyxDQUFXLEVBQUUsQ0FBQyxDQUFD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ZCxpQkFBaUIsbUZBQ2pCLGFBQWEsaUlBQ2IsZUFBZSx5R0FDZixrQkFBa0Isb0ZBQ2xCLGFBQWEseUZBQ2IsZ0JBQWdCLHNGQUNoQixlQUFlOzs0RkFHTixzQkFBc0I7a0JBckJsQyxTQUFTOytCQUNFLG1CQUFtQixjQUdqQixJQUFJLFdBQ1A7d0JBQ1AsSUFBSTt3QkFDSixLQUFLO3dCQUNMLFNBQVM7d0JBQ1QsbUJBQW1CO3dCQUNuQixjQUFjO3dCQUNkLGNBQWM7d0JBQ2QsaUJBQWlCO3dCQUNqQixhQUFhO3dCQUNiLGVBQWU7d0JBQ2Ysa0JBQWtCO3dCQUNsQixhQUFhO3dCQUNiLGdCQUFnQjt3QkFDaEIsZUFBZTtxQkFDaEI7OEJBaUJELE1BQU07c0JBREwsTUFBTTtnQkFJUCxtQkFBbUI7c0JBRGxCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY1BpcGUsIE5nRm9yLCBOZ0lmIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBpbmplY3QsXG4gIGlucHV0LFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tIFwiQG5neC10cmFuc2xhdGUvY29yZVwiO1xuXG5pbXBvcnQgeyBJbnB1dFVwbG9hZFZhbHVlIH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gXCJAdGEvaWNvbnNcIjtcbmltcG9ydCB7IERvY3VtZW50RHRvLCBGaWxlVHlwZSwgVGFEb2N1bWVudHNTZXJ2aWNlIH0gZnJvbSBcIkB0YS9zZXJ2aWNlc1wiO1xuaW1wb3J0IHtcbiAgQnV0dG9uVG9vbENvbXBvbmVudCxcbiAgRW1wdHlDb21wb25lbnQsXG4gIEVycm9yQ29tcG9uZW50LFxuICBMaW5rQ29tcG9uZW50LFxuICBMb2FkZXJDb21wb25lbnQsXG4gIE1lZ2FvY3RldENvbXBvbmVudCxcbiAgVGV4dENvbXBvbmVudCxcbiAgVGltZUFnb0NvbXBvbmVudCxcbn0gZnJvbSBcIkB0YS91aVwiO1xuaW1wb3J0IHsgVGFCYXNlQ29tcG9uZW50LCBkb3dubG9hZEZpbGUgfSBmcm9tIFwiQHRhL3V0aWxzXCI7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0YS1kb2N1bWVudHMtbGlzdFwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL2xpc3QuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL2xpc3QuY29tcG9uZW50LnNjc3NcIl0sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBOZ0lmLFxuICAgIE5nRm9yLFxuICAgIEFzeW5jUGlwZSxcbiAgICBCdXR0b25Ub29sQ29tcG9uZW50LFxuICAgIEVtcHR5Q29tcG9uZW50LFxuICAgIEVycm9yQ29tcG9uZW50LFxuICAgIEZvbnRJY29uQ29tcG9uZW50LFxuICAgIExpbmtDb21wb25lbnQsXG4gICAgTG9hZGVyQ29tcG9uZW50LFxuICAgIE1lZ2FvY3RldENvbXBvbmVudCxcbiAgICBUZXh0Q29tcG9uZW50LFxuICAgIFRpbWVBZ29Db21wb25lbnQsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBEb2N1bWVudHNMaXN0Q29tcG9uZW50XG4gIGV4dGVuZHMgVGFCYXNlQ29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXNcbntcbiAgZG9jdW1lbnRzSWRzID0gaW5wdXQucmVxdWlyZWQ8c3RyaW5nW10+KCk7XG5cbiAgZW1wdHlNZXNzYWdlID0gaW5wdXQ8c3RyaW5nPihcIlwiKTtcblxuICBhY3Rpb25zID0gaW5wdXQ8XCJkZWxldGVcIiB8IFwic2VsZWN0XCIgfCBcIlwiPihcIlwiKTtcblxuICBkZWZhdWx0U2VsZWN0ZWQgPSBpbnB1dDxzdHJpbmdbXT4oW10pO1xuXG4gIHJlYWRvbmx5ID0gaW5wdXQ8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIEBPdXRwdXQoKVxuICByZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICBAT3V0cHV0KClcbiAgY2hlY2tlZEZpbGVzQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SW5wdXRVcGxvYWRWYWx1ZVtdPigpO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2RvY3VtZW50c1NlcnZpY2UgPSBpbmplY3QoVGFEb2N1bWVudHNTZXJ2aWNlKTtcblxuICBwcml2YXRlIF9jaGVja2VkRmlsZXM6IElucHV0VXBsb2FkVmFsdWVbXSA9IFtdO1xuICBwdWJsaWMgRmlsZVR5cGUgPSBGaWxlVHlwZTtcblxuICBnZXQgZG9jdW1lbnRzJCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnRzU2VydmljZS5nZXREb2N1bWVudHMkKHRoaXMuZG9jdW1lbnRzSWRzKCkpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5fZmV0Y2goKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvLyB0aGlzLl9mZXRjaCgpO1xuICB9XG5cbiAgcHVibGljIG9wZW5Eb2N1bWVudChkb2M6IERvY3VtZW50RHRvKSB7XG4gICAgZG93bmxvYWRGaWxlKGRvYy51cmwpO1xuICB9XG5cbiAgcHVibGljIHJlbW92ZURvY3VtZW50KGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICB0aGlzLnJlbW92ZS5lbWl0KGRvYy5pZCk7XG4gIH1cblxuICBwdWJsaWMgaXNDaGVja2VkKGRvYzogRG9jdW1lbnREdG8pIHtcbiAgICByZXR1cm4gdGhpcy5fY2hlY2tlZEZpbGVzLmZpbmQoKHgpID0+IHguaWQgPT09IGRvYy5pZCk7XG4gIH1cblxuICBwdWJsaWMgY2hlY2soZG9jOiBEb2N1bWVudER0bykge1xuICAgIGlmICh0aGlzLmlzQ2hlY2tlZChkb2MpKSB7XG4gICAgICB0aGlzLl9jaGVja2VkRmlsZXMgPSB0aGlzLl9jaGVja2VkRmlsZXMuZmlsdGVyKCh4KSA9PiB4LmlkICE9PSBkb2MuaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9jaGVja2VkRmlsZXMucHVzaCh7XG4gICAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAgIG5hbWU6IGRvYy5kZXNjcmlwdGlvbixcbiAgICAgICAgdXJsOiBkb2MudXJsLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuY2hlY2tlZEZpbGVzQ2hhbmdlZC5lbWl0KHRoaXMuX2NoZWNrZWRGaWxlcyk7XG4gIH1cblxuICBwcml2YXRlIF9mZXRjaCgpIHtcbiAgICB0aGlzLnJlcXVlc3RTdGF0ZS5hc2tlZCgpO1xuICAgIHRoaXMuX2RvY3VtZW50c1NlcnZpY2UuZmV0Y2hEb2N1bWVudHMkKHRoaXMuZG9jdW1lbnRzSWRzKCkpLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoZG9jdW1lbnRzKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrZWRGaWxlcyA9IGRvY3VtZW50cy5maWx0ZXIoKGRvYykgPT5cbiAgICAgICAgICB0aGlzLmRlZmF1bHRTZWxlY3RlZCgpLmluY2x1ZGVzKGRvYy5pZClcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZTogKCkgPT4gdGhpcy5yZXF1ZXN0U3RhdGUuY29tcGxldGVkKCksXG4gICAgICBlcnJvcjogKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgICB0aGlzLnJlcXVlc3RTdGF0ZS5vbkVycm9yKGVycm9yLnN0YXR1cywgZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59XG4iLCI8dGEtbG9hZGVyXG4gIFtpc0xvYWRpbmddPVwidGhpcy5yZXF1ZXN0U3RhdGUuaXNMb2FkaW5nKClcIlxuICAqbmdMZXQ9XCJ0aGlzLmRvY3VtZW50cyQgfCBhc3luYyBhcyBkb2N1bWVudHNcIlxuPlxuICA8dGEtZXJyb3JcbiAgICBbbWVzc2FnZV09XCJ0aGlzLnJlcXVlc3RTdGF0ZS5nZXRFcnJvck1lc3NhZ2UoKVwiXG4gICAgW2NvZGVdPVwidGhpcy5yZXF1ZXN0U3RhdGUuZ2V0RXJyb3JTdGF0dXMoKVwiXG4gID5cbiAgICA8dGEtZW1wdHlcbiAgICAgIFtpc0VtcHR5XT1cIiFkb2N1bWVudHMgfHwgZG9jdW1lbnRzLmxlbmd0aCA9PT0gMFwiXG4gICAgICBbdGV4dF09XCJ0aGlzLmVtcHR5TWVzc2FnZSgpXCJcbiAgICAgIFtzaG93TWVzc2FnZV09XCIhIXRoaXMuZW1wdHlNZXNzYWdlKClcIlxuICAgID5cbiAgICAgIDxkaXYgY2xhc3M9XCJsaXN0IGZsZXgtY29sdW1uIGctc3BhY2Utc21cIj5cbiAgICAgICAgQGZvciAoZG9jIG9mIGRvY3VtZW50czsgdHJhY2sgZG9jKSB7XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJcbiAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zKCkgIT09ICdzZWxlY3QnID8gZGVmYXVsdFRlbXBsYXRlIDogc2VsZWN0VGVtcGxhdGU7XG4gICAgICAgICAgICAgIGNvbnRleHQ6IHsgZG9jOiBkb2MgfVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICA+PC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICB9XG4gICAgICA8L2Rpdj5cbiAgICA8L3RhLWVtcHR5PlxuICA8L3RhLWVycm9yPlxuPC90YS1sb2FkZXI+XG5cbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdFRlbXBsYXRlIGxldC1kb2M9XCJkb2NcIj5cbiAgPGRpdiBjbGFzcz1cImZsZXgtcm93IGctc3BhY2UteHMganVzdGlmeS1jb250ZW50LWJldHdlZW5cIj5cbiAgICA8ZGl2IGNsYXNzPVwiYWxpZ24tY2VudGVyXCI+XG4gICAgICA8dGEtZm9udC1pY29uIG5hbWU9XCJkb2NcIiBzaXplPVwieHNcIj48L3RhLWZvbnQtaWNvbj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDx0YS1saW5rIFt1bmRlcmxpbmVdPVwiZmFsc2VcIiAoYWN0aW9uKT1cInRoaXMub3BlbkRvY3VtZW50KGRvYylcIj57e1xuICAgICAgICAgIGRvYy5uYW1lXG4gICAgICAgIH19PC90YS1saW5rPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZXh0cmEgZmxleC1yb3cgZy1zcGFjZS1tZFwiPlxuICAgICAgICAgIDx0YS10aW1lLWFnbyBbZGF0ZV09XCJkb2MudXBsb2FkZWREYXRlXCI+PC90YS10aW1lLWFnbz5cbiAgICAgICAgICA8dGEtbWVnYW9jdGV0IFtvY3RldF09XCJkb2Muc2l6ZVwiPjwvdGEtbWVnYW9jdGV0PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjdGEgYWxpZ24tY29udGVudC1jZW50ZXJcIj5cbiAgICAgIEBpZiAodGhpcy5hY3Rpb25zKCkgPT09ICdzZWxlY3QnKSB7XG4gICAgICA8aW5wdXRcbiAgICAgICAgW2Rpc2FibGVkXT1cInRoaXMucmVhZG9ubHkoKVwiXG4gICAgICAgIHR5cGU9XCJjaGVja2JveFwiXG4gICAgICAgIFtjaGVja2VkXT1cInRoaXMuaXNDaGVja2VkKGRvYylcIlxuICAgICAgICAoY2xpY2spPVwidGhpcy5jaGVjayhkb2MpXCJcbiAgICAgIC8+XG4gICAgICB9IEBlbHNlIGlmICh0aGlzLmFjdGlvbnMoKSA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgIDx0YS1idXR0b24tdG9vbFxuICAgICAgICAoYWN0aW9uKT1cInRoaXMucmVtb3ZlRG9jdW1lbnQoZG9jKVwiXG4gICAgICAgIGljb249XCJkZWxldGVcIlxuICAgICAgICBbc2l6ZV09XCInc20nXCJcbiAgICAgICAgW3JlYWRvbmx5XT1cInRoaXMucmVhZG9ubHkoKVwiXG4gICAgICA+PC90YS1idXR0b24tdG9vbD5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3NlbGVjdFRlbXBsYXRlIGxldC1kb2M9XCJkb2NcIj5cbiAgPGRpdlxuICAgIGNsYXNzPVwiY2FyZC1kb2N1bWVudC11cGxvYWQgZmxleC1yb3cgZy1zcGFjZS14cyBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiXG4gICAgW2NsYXNzLnNlbGVjdGVkXT1cInRoaXMuaXNDaGVja2VkKGRvYylcIlxuICAgIChjbGljayk9XCJ0aGlzLmNoZWNrKGRvYylcIlxuICA+XG4gICAgPGRpdiBjbGFzcz1cImRpc3BsYXkgZmxleC1jb2x1bW4gYWxpZ24taXRlbXMtc3RhcnRcIj5cbiAgICAgIDx0YS1saW5rXG4gICAgICAgIFtib2xkXT1cInRydWVcIlxuICAgICAgICBbdW5kZXJsaW5lXT1cImZhbHNlXCJcbiAgICAgICAgKGNsaWNrKT1cIiRldmVudC5zdG9wUHJvcGFnYXRpb24oKVwiXG4gICAgICAgIChhY3Rpb24pPVwidGhpcy5vcGVuRG9jdW1lbnQoZG9jKVwiXG4gICAgICA+XG4gICAgICAgIHt7IGRvYy5uYW1lIH19XG4gICAgICA8L3RhLWxpbms+XG4gICAgICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgZy1zcGFjZS1tZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1yb3cgYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgPHRhLWZvbnQtaWNvbiBuYW1lPVwiZG9jXCIgc2l6ZT1cInhzXCI+PC90YS1mb250LWljb24+XG4gICAgICAgICAgPHRhLXRleHQ+XG4gICAgICAgICAgICB7e1xuICAgICAgICAgICAgICBcImNvbW11bmljYXRpb24uZG9jdW1lbnRzLmZpbGUtdHlwZS5cIiArXG4gICAgICAgICAgICAgICAgdGhpcy5GaWxlVHlwZVtkb2MuZmlsZVR5cGVdLnRvTG9jYWxlTG93ZXJDYXNlKCkgfCB0cmFuc2xhdGVcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPC90YS10ZXh0PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPHRhLW1lZ2FvY3RldCBbaWNvbl09XCJ0cnVlXCIgW29jdGV0XT1cImRvYy5zaXplXCI+PC90YS1tZWdhb2N0ZXQ+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIGFsaWduLWNvbnRlbnQtY2VudGVyXCI+XG4gICAgICBAaWYgKHRoaXMuYWN0aW9ucygpID09PSAnc2VsZWN0Jykge1xuICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIFtjaGVja2VkXT1cInRoaXMuaXNDaGVja2VkKGRvYylcIiAvPlxuICAgICAgfSBAZWxzZSBpZiAodGhpcy5hY3Rpb25zKCkgPT09ICdkZWxldGUnKSB7XG4gICAgICA8dGEtYnV0dG9uLXRvb2xcbiAgICAgICAgKGFjdGlvbik9XCJ0aGlzLnJlbW92ZURvY3VtZW50KGRvYylcIlxuICAgICAgICBpY29uPVwiZGVsZXRlXCJcbiAgICAgICAgW3NpemVdPVwiJ3NtJ1wiXG4gICAgICA+PC90YS1idXR0b24tdG9vbD5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuIl19