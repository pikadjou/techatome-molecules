import { NgFor, NgIf, NgTemplateOutlet } from "@angular/common";
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild, } from "@angular/core";
import { Validators } from "@angular/forms";
import { MatMenu, MatMenuTrigger } from "@angular/material/menu";
import { LocalStorage } from "storage-manager-js";
import { SearchFieldComponent } from "@ta/form-input";
import { InputTextBox } from "@ta/form-model";
import { FontIconComponent } from "@ta/icons";
import { ContactInformationComponent, EmptyComponent, ListContainerComponent, ListElementComponent, ListTagComponent, ListTitleComponent, } from "@ta/ui";
import * as i0 from "@angular/core";
export class SearchHistoryDisplayerComponent {
    constructor() {
        this.placeholder = "";
        this.isDropDown = false;
        this.valueCompleted = new EventEmitter();
        this.searchField = null;
        this.searchTrigger = null;
        this.input = new InputTextBox({
            validators: [Validators.minLength(3)],
        });
    }
    get searchFieldWidth() {
        return this.searchField?.nativeElement.offsetWidth;
    }
    get listRecentSearches() {
        if (this.searchHistory?.type) {
            const storedSearches = this._getFromLocalStorage(this.searchHistory?.type);
            const searches = storedSearches.map((obj) => obj.research);
            return searches;
        }
        return null;
    }
    searchCompleted(search) {
        if (this.searchHistory?.type) {
            this._saveInLocalStorage(search);
        }
        this.input.value = "";
        this.searchTrigger?.closeMenu();
        this.valueCompleted.emit(search);
        return;
    }
    _getFromLocalStorage(type) {
        return JSON.parse(LocalStorage.get("search-" + type) || "[]");
    }
    _saveInLocalStorage(searchValue) {
        if (this.searchHistory?.type) {
            let storedSearches = this._getFromLocalStorage(this.searchHistory?.type);
            const search = storedSearches.find((s) => s.research === searchValue);
            if (search) {
                search.storageTime = new Date();
            }
            else {
                storedSearches.push({
                    research: searchValue,
                    storageTime: new Date(),
                });
            }
            this.orderAndSelect(storedSearches);
            LocalStorage.set("search-" + this.searchHistory?.type || "", JSON.stringify(storedSearches.slice(0, 5)));
        }
    }
    orderAndSelect(items) {
        items.sort((a, b) => {
            const dateA = new Date(a.storageTime);
            const dateB = new Date(b.storageTime);
            return dateB.getTime() - dateA.getTime();
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: SearchHistoryDisplayerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: SearchHistoryDisplayerComponent, isStandalone: true, selector: "ta-search-history-displayer", inputs: { searchHistory: "searchHistory", placeholder: "placeholder", isDropDown: "isDropDown" }, outputs: { valueCompleted: "valueCompleted" }, viewQueries: [{ propertyName: "searchField", first: true, predicate: ["searchField"], descendants: true, read: ElementRef }, { propertyName: "searchTrigger", first: true, predicate: ["searchField"], descendants: true, read: MatMenuTrigger }], ngImport: i0, template: "<ng-template #menuTemplate>\n  <div class=\"p-space-md\">\n    <ta-contact-information\n      icon=\"history\"\n      value=\"core.historical-research.last-searches\"\n    >\n      <ta-empty\n        [isEmpty]=\"!this.listRecentSearches?.length && !this.isDropDown\"\n      >\n        <ta-list-container class=\"list-container\">\n          @for (search of this.listRecentSearches; track search) {\n          <ta-list-element (click)=\"this.searchCompleted(search)\">\n            <ta-list-title>\n              {{ search }}\n            </ta-list-title>\n            <ta-list-tag>\n              <ta-font-icon name=\"arrow-big-right\" type=\"sm\"></ta-font-icon>\n            </ta-list-tag>\n          </ta-list-element>\n          }\n        </ta-list-container>\n      </ta-empty>\n    </ta-contact-information>\n  </div>\n</ng-template>\n\n<ta-search-field\n  #searchField\n  [isOpen]=\"true\"\n  [placeholder]=\"this.placeholder\"\n  [input]=\"this.input\"\n  (valueCompleted)=\"this.searchCompleted($event)\"\n  [matMenuTriggerFor]=\"\n    this.searchHistory?.type && this.isDropDown === true ? menu : null\n  \"\n></ta-search-field>\n\n<mat-menu #menu=\"matMenu\">\n  <div class=\"\" [style.width.px]=\"this.searchFieldWidth\">\n    @if (menuTemplate) {\n    <ng-container\n      *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n    ></ng-container>\n    }\n  </div>\n</mat-menu>\n\n@if (menuTemplate && this.searchHistory?.type && this.isDropDown === false) {\n<ng-container\n  *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n></ng-container>\n}\n", styles: [""], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: ContactInformationComponent, selector: "ta-contact-information", inputs: ["value", "icon", "localIcon"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ListContainerComponent, selector: "ta-list-container" }, { kind: "component", type: ListElementComponent, selector: "ta-list-element", inputs: ["withSeparator", "flexColumn"], outputs: ["action"] }, { kind: "component", type: ListTitleComponent, selector: "ta-list-title" }, { kind: "component", type: ListTagComponent, selector: "ta-list-tag" }, { kind: "component", type: SearchFieldComponent, selector: "ta-search-field", inputs: ["isOpen", "placeholder", "space", "type"], outputs: ["valueCompleted"] }, { kind: "component", type: MatMenu, selector: "mat-menu", inputs: ["backdropClass", "aria-label", "aria-labelledby", "aria-describedby", "xPosition", "yPosition", "overlapTrigger", "hasBackdrop", "class", "classList"], outputs: ["closed", "close"], exportAs: ["matMenu"] }, { kind: "directive", type: MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", inputs: ["mat-menu-trigger-for", "matMenuTriggerFor", "matMenuTriggerData", "matMenuTriggerRestoreFocus"], outputs: ["menuOpened", "onMenuOpen", "menuClosed", "onMenuClose"], exportAs: ["matMenuTrigger"] }, { kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: SearchHistoryDisplayerComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-search-history-displayer", standalone: true, imports: [
                        NgIf,
                        NgFor,
                        FontIconComponent,
                        ContactInformationComponent,
                        EmptyComponent,
                        ListContainerComponent,
                        ListElementComponent,
                        ListTitleComponent,
                        ListTagComponent,
                        SearchFieldComponent,
                        MatMenu,
                        MatMenuTrigger,
                        NgTemplateOutlet,
                    ], template: "<ng-template #menuTemplate>\n  <div class=\"p-space-md\">\n    <ta-contact-information\n      icon=\"history\"\n      value=\"core.historical-research.last-searches\"\n    >\n      <ta-empty\n        [isEmpty]=\"!this.listRecentSearches?.length && !this.isDropDown\"\n      >\n        <ta-list-container class=\"list-container\">\n          @for (search of this.listRecentSearches; track search) {\n          <ta-list-element (click)=\"this.searchCompleted(search)\">\n            <ta-list-title>\n              {{ search }}\n            </ta-list-title>\n            <ta-list-tag>\n              <ta-font-icon name=\"arrow-big-right\" type=\"sm\"></ta-font-icon>\n            </ta-list-tag>\n          </ta-list-element>\n          }\n        </ta-list-container>\n      </ta-empty>\n    </ta-contact-information>\n  </div>\n</ng-template>\n\n<ta-search-field\n  #searchField\n  [isOpen]=\"true\"\n  [placeholder]=\"this.placeholder\"\n  [input]=\"this.input\"\n  (valueCompleted)=\"this.searchCompleted($event)\"\n  [matMenuTriggerFor]=\"\n    this.searchHistory?.type && this.isDropDown === true ? menu : null\n  \"\n></ta-search-field>\n\n<mat-menu #menu=\"matMenu\">\n  <div class=\"\" [style.width.px]=\"this.searchFieldWidth\">\n    @if (menuTemplate) {\n    <ng-container\n      *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n    ></ng-container>\n    }\n  </div>\n</mat-menu>\n\n@if (menuTemplate && this.searchHistory?.type && this.isDropDown === false) {\n<ng-container\n  *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n></ng-container>\n}\n" }]
        }], propDecorators: { searchHistory: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], isDropDown: [{
                type: Input
            }], valueCompleted: [{
                type: Output
            }], searchField: [{
                type: ViewChild,
                args: ["searchField", { read: ElementRef }]
            }], searchTrigger: [{
                type: ViewChild,
                args: ["searchField", { read: MatMenuTrigger }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWhpc3RvcnktZGlzcGxheWVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9oaXN0b3JpY2FsLXJlc2VhcmNoL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci9zZWFyY2gtaGlzdG9yeS1kaXNwbGF5ZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2hpc3RvcmljYWwtcmVzZWFyY2gvc2VhcmNoLWhpc3RvcnktZGlzcGxheWVyL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hFLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVqRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUM5QyxPQUFPLEVBQ0wsMkJBQTJCLEVBQzNCLGNBQWMsRUFDZCxzQkFBc0IsRUFDdEIsb0JBQW9CLEVBQ3BCLGdCQUFnQixFQUNoQixrQkFBa0IsR0FDbkIsTUFBTSxRQUFRLENBQUM7O0FBdUJoQixNQUFN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Z0lmLCBOZ1RlbXBsYXRlT3V0bGV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIFZpZXdDaGlsZCxcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFZhbGlkYXRvcnMgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IE1hdE1lbnUsIE1hdE1lbnVUcmlnZ2VyIH0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL21lbnVcIjtcblxuaW1wb3J0IHsgTG9jYWxTdG9yYWdlIH0gZnJvbSBcInN0b3JhZ2UtbWFuYWdlci1qc1wiO1xuXG5pbXBvcnQgeyBTZWFyY2hGaWVsZENvbXBvbmVudCB9IGZyb20gXCJAdGEvZm9ybS1pbnB1dFwiO1xuaW1wb3J0IHsgSW5wdXRUZXh0Qm94IH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gXCJAdGEvaWNvbnNcIjtcbmltcG9ydCB7XG4gIENvbnRhY3RJbmZvcm1hdGlvbkNvbXBvbmVudCxcbiAgRW1wdHlDb21wb25lbnQsXG4gIExpc3RDb250YWluZXJDb21wb25lbnQsXG4gIExpc3RFbGVtZW50Q29tcG9uZW50LFxuICBMaXN0VGFnQ29tcG9uZW50LFxuICBMaXN0VGl0bGVDb21wb25lbnQsXG59IGZyb20gXCJAdGEvdWlcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRhLXNlYXJjaC1oaXN0b3J5LWRpc3BsYXllclwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci5jb21wb25lbnQuaHRtbFwiLFxuICBzdHlsZVVybHM6IFtcIi4vc2VhcmNoLWhpc3RvcnktZGlzcGxheWVyLmNvbXBvbmVudC5zY3NzXCJdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgTmdJZixcbiAgICBOZ0ZvcixcbiAgICBGb250SWNvbkNvbXBvbmVudCxcbiAgICBDb250YWN0SW5mb3JtYXRpb25Db21wb25lbnQsXG4gICAgRW1wdHlDb21wb25lbnQsXG4gICAgTGlzdENvbnRhaW5lckNvbXBvbmVudCxcbiAgICBMaXN0RWxlbWVudENvbXBvbmVudCxcbiAgICBMaXN0VGl0bGVDb21wb25lbnQsXG4gICAgTGlzdFRhZ0NvbXBvbmVudCxcbiAgICBTZWFyY2hGaWVsZENvbXBvbmVudCxcbiAgICBNYXRNZW51LFxuICAgIE1hdE1lbnVUcmlnZ2VyLFxuICAgIE5nVGVtcGxhdGVPdXRsZXQsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaEhpc3RvcnlEaXNwbGF5ZXJDb21wb25lbnQge1xuICBASW5wdXQoKVxuICBzZWFyY2hIaXN0b3J5Pzoge1xuICAgIHR5cGU6IHN0cmluZztcbiAgfTtcblxuICBASW5wdXQoKVxuICBwbGFjZWhvbGRlcjogc3RyaW5nID0gXCJcIjtcblxuICBASW5wdXQoKVxuICBpc0Ryb3BEb3duOiBib29sZWFuID0gZmFsc2U7XG5cbiAgQE91dHB1dCgpXG4gIHZhbHVlQ29tcGxldGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBWaWV3Q2hpbGQoXCJzZWFyY2hGaWVsZFwiLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgc2VhcmNoRmllbGQ6IEVsZW1lbnRSZWYgfCBudWxsID0gbnVsbDtcbiAgQFZpZXdDaGlsZChcInNlYXJjaEZpZWxkXCIsIHsgcmVhZDogTWF0TWVudVRyaWdnZXIgfSlcbiAgc2VhcmNoVHJpZ2dlcjogTWF0TWVudVRyaWdnZXIgfCBudWxsID0gbnVsbDtcblxuICBnZXQgc2VhcmNoRmllbGRXaWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hGaWVsZD8ubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgfVxuICBnZXQgbGlzdFJlY2VudFNlYXJjaGVzKCkge1xuICAgIGlmICh0aGlzLnNlYXJjaEhpc3Rvcnk/LnR5cGUpIHtcbiAgICAgIGNvbnN0IHN0b3JlZFNlYXJjaGVzOiB7IHJlc2VhcmNoOiBzdHJpbmcgfVtdID0gdGhpcy5fZ2V0RnJvbUxvY2FsU3RvcmFnZShcbiAgICAgICAgdGhpcy5zZWFyY2hIaXN0b3J5Py50eXBlXG4gICAgICApO1xuICAgICAgY29uc3Qgc2VhcmNoZXM6IHN0cmluZ1tdID0gc3RvcmVkU2VhcmNoZXMubWFwKChvYmopID0+IG9iai5yZXNlYXJjaCk7XG4gICAgICByZXR1cm4gc2VhcmNoZXM7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHVibGljIGlucHV0ID0gbmV3IElucHV0VGV4dEJveCh7XG4gICAgdmFsaWRhdG9yczogW1ZhbGlkYXRvcnMubWluTGVuZ3RoKDMpXSxcbiAgfSk7XG5cbiAgcHVibGljIHNlYXJjaENvbXBsZXRlZChzZWFyY2g6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnNlYXJjaEhpc3Rvcnk/LnR5cGUpIHtcbiAgICAgIHRoaXMuX3NhdmVJbkxvY2FsU3RvcmFnZShzZWFyY2gpO1xuICAgIH1cbiAgICB0aGlzLmlucHV0LnZhbHVlID0gXCJcIjtcbiAgICB0aGlzLnNlYXJjaFRyaWdnZXI/LmNsb3NlTWVudSgpO1xuICAgIHRoaXMudmFsdWVDb21wbGV0ZWQuZW1pdChzZWFyY2gpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHByaXZhdGUgX2dldEZyb21Mb2NhbFN0b3JhZ2UodHlwZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoTG9jYWxTdG9yYWdlLmdldChcInNlYXJjaC1cIiArIHR5cGUpIHx8IFwiW11cIik7XG4gIH1cblxuICBwcml2YXRlIF9zYXZlSW5Mb2NhbFN0b3JhZ2Uoc2VhcmNoVmFsdWU6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnNlYXJjaEhpc3Rvcnk/LnR5cGUpIHtcbiAgICAgIGxldCBzdG9yZWRTZWFyY2hlczogeyByZXNlYXJjaDogc3RyaW5nOyBzdG9yYWdlVGltZTogRGF0ZSB9W10gPVxuICAgICAgICB0aGlzLl9nZXRGcm9tTG9jYWxTdG9yYWdlKHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZSk7XG4gICAgICBjb25zdCBzZWFyY2ggPSBzdG9yZWRTZWFyY2hlcy5maW5kKChzKSA9PiBzLnJlc2VhcmNoID09PSBzZWFyY2hWYWx1ZSk7XG4gICAgICBpZiAoc2VhcmNoKSB7XG4gICAgICAgIHNlYXJjaC5zdG9yYWdlVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdG9yZWRTZWFyY2hlcy5wdXNoKHtcbiAgICAgICAgICByZXNlYXJjaDogc2VhcmNoVmFsdWUsXG4gICAgICAgICAgc3RvcmFnZVRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5vcmRlckFuZFNlbGVjdChzdG9yZWRTZWFyY2hlcyk7XG4gICAgICBMb2NhbFN0b3JhZ2Uuc2V0KFxuICAgICAgICBcInNlYXJjaC1cIiArIHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZSB8fCBcIlwiLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShzdG9yZWRTZWFyY2hlcy5zbGljZSgwLCA1KSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvcmRlckFuZFNlbGVjdChpdGVtczogeyBzdG9yYWdlVGltZTogRGF0ZSB9W10pIHtcbiAgICBpdGVtcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBjb25zdCBkYXRlQSA9IG5ldyBEYXRlKGEuc3RvcmFnZVRpbWUpO1xuICAgICAgY29uc3QgZGF0ZUIgPSBuZXcgRGF0ZShiLnN0b3JhZ2VUaW1lKTtcbiAgICAgIHJldHVybiBkYXRlQi5nZXRUaW1lKCkgLSBkYXRlQS5nZXRUaW1lKCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsIjxuZy10ZW1wbGF0ZSAjbWVudVRlbXBsYXRlPlxuICA8ZGl2IGNsYXNzPVwicC1zcGFjZS1tZFwiPlxuICAgIDx0YS1jb250YWN0LWluZm9ybWF0aW9uXG4gICAgICBpY29uPVwiaGlzdG9yeVwiXG4gICAgICB2YWx1ZT1cImNvcmUuaGlzdG9yaWNhbC1yZXNlYXJjaC5sYXN0LXNlYXJjaGVzXCJcbiAgICA+XG4gICAgICA8dGEtZW1wdHlcbiAgICAgICAgW2lzRW1wdHldPVwiIXRoaXMubGlzdFJlY2VudFNlYXJjaGVzPy5sZW5ndGggJiYgIXRoaXMuaXNEcm9wRG93blwiXG4gICAgICA+XG4gICAgICAgIDx0YS1saXN0LWNvbnRhaW5lciBjbGFzcz1cImxpc3QtY29udGFpbmVyXCI+XG4gICAgICAgICAgQGZvciAoc2VhcmNoIG9mIHRoaXMubGlzdFJlY2VudFNlYXJjaGVzOyB0cmFjayBzZWFyY2gpIHtcbiAgICAgICAgICA8dGEtbGlzdC1lbGVtZW50IChjbGljayk9XCJ0aGlzLnNlYXJjaENvbXBsZXRlZChzZWFyY2gpXCI+XG4gICAgICAgICAgICA8dGEtbGlzdC10aXRsZT5cbiAgICAgICAgICAgICAge3sgc2VhcmNoIH19XG4gICAgICAgICAgICA8L3RhLWxpc3QtdGl0bGU+XG4gICAgICAgICAgICA8dGEtbGlzdC10YWc+XG4gICAgICAgICAgICAgIDx0YS1mb250LWljb24gbmFtZT1cImFycm93LWJpZy1yaWdodFwiIHR5cGU9XCJzbVwiPjwvdGEtZm9udC1pY29uPlxuICAgICAgICAgICAgPC90YS1saXN0LXRhZz5cbiAgICAgICAgICA8L3RhLWxpc3QtZWxlbWVudD5cbiAgICAgICAgICB9XG4gICAgICAgIDwvdGEtbGlzdC1jb250YWluZXI+XG4gICAgICA8L3RhLWVtcHR5PlxuICAgIDwvdGEtY29udGFjdC1pbmZvcm1hdGlvbj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuXG48dGEtc2VhcmNoLWZpZWxkXG4gICNzZWFyY2hGaWVsZFxuICBbaXNPcGVuXT1cInRydWVcIlxuICBbcGxhY2Vob2xkZXJdPVwidGhpcy5wbGFjZWhvbGRlclwiXG4gIFtpbnB1dF09XCJ0aGlzLmlucHV0XCJcbiAgKHZhbHVlQ29tcGxldGVkKT1cInRoaXMuc2VhcmNoQ29tcGxldGVkKCRldmVudClcIlxuICBbbWF0TWVudVRyaWdnZXJGb3JdPVwiXG4gICAgdGhpcy5zZWFyY2hIaXN0b3J5Py50eXBlICYmIHRoaXMuaXNEcm9wRG93biA9PT0gdHJ1ZSA/IG1lbnUgOiBudWxsXG4gIFwiXG4+PC90YS1zZWFyY2gtZmllbGQ+XG5cbjxtYXQtbWVudSAjbWVudT1cIm1hdE1lbnVcIj5cbiAgPGRpdiBjbGFzcz1cIlwiIFtzdHlsZS53aWR0aC5weF09XCJ0aGlzLnNlYXJjaEZpZWxkV2lkdGhcIj5cbiAgICBAaWYgKG1lbnVUZW1wbGF0ZSkge1xuICAgIDxuZy1jb250YWluZXJcbiAgICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwibWVudVRlbXBsYXRlOyBjb250ZXh0OiB7IGVsZW1lbnQ6IG1lbnUgfVwiXG4gICAgPjwvbmctY29udGFpbmVyPlxuICAgIH1cbiAgPC9kaXY+XG48L21hdC1tZW51PlxuXG5AaWYgKG1lbnVUZW1wbGF0ZSAmJiB0aGlzLnNlYXJjaEhpc3Rvcnk/LnR5cGUgJiYgdGhpcy5pc0Ryb3BEb3duID09PSBmYWxzZSkge1xuPG5nLWNvbnRhaW5lclxuICAqbmdUZW1wbGF0ZU91dGxldD1cIm1lbnVUZW1wbGF0ZTsgY29udGV4dDogeyBlbGVtZW50OiBtZW51IH1cIlxuPjwvbmctY29udGFpbmVyPlxufVxuIl19