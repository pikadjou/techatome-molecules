import { NgFor, NgIf, NgTemplateOutlet } from '@angular/common';
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { Validators } from '@angular/forms';
import { MatMenu, MatMenuTrigger } from '@angular/material/menu';
import { LocalStorage } from 'storage-manager-js';
import { SearchFieldComponent } from '@ta/form-input';
import { InputTextBox } from '@ta/form-model';
import { FontIconComponent } from '@ta/icons';
import { ContactInformationComponent, EmptyComponent, ListContainerComponent, ListElementComponent, ListTagComponent, ListTitleComponent, } from '@ta/ui';
import * as i0 from "@angular/core";
export class SearchHistoryDisplayerComponent {
    constructor() {
        this.placeholder = '';
        this.isDropDown = false;
        this.valueCompleted = new EventEmitter();
        this.searchField = null;
        this.searchTrigger = null;
        this.input = new InputTextBox({
            validators: [Validators.minLength(3)],
        });
    }
    get searchFieldWidth() {
        return this.searchField?.nativeElement.offsetWidth;
    }
    get listRecentSearches() {
        if (this.searchHistory?.type) {
            const storedSearches = this._getFromLocalStorage(this.searchHistory?.type);
            const searches = storedSearches.map(obj => obj.research);
            return searches;
        }
        return null;
    }
    searchCompleted(search) {
        if (this.searchHistory?.type) {
            this._saveInLocalStorage(search);
        }
        this.input.value = '';
        this.searchTrigger?.closeMenu();
        this.valueCompleted.emit(search);
        return;
    }
    _getFromLocalStorage(type) {
        return JSON.parse(LocalStorage.get('search-' + type) || '[]');
    }
    _saveInLocalStorage(searchValue) {
        if (this.searchHistory?.type) {
            let storedSearches = this._getFromLocalStorage(this.searchHistory?.type);
            const search = storedSearches.find(s => s.research === searchValue);
            if (search) {
                search.storageTime = new Date();
            }
            else {
                storedSearches.push({
                    research: searchValue,
                    storageTime: new Date(),
                });
            }
            this.orderAndSelect(storedSearches);
            LocalStorage.set('search-' + this.searchHistory?.type || '', JSON.stringify(storedSearches.slice(0, 5)));
        }
    }
    orderAndSelect(items) {
        items.sort((a, b) => {
            const dateA = new Date(a.storageTime);
            const dateB = new Date(b.storageTime);
            return dateB.getTime() - dateA.getTime();
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: SearchHistoryDisplayerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: SearchHistoryDisplayerComponent, isStandalone: true, selector: "ta-search-history-displayer", inputs: { searchHistory: "searchHistory", placeholder: "placeholder", isDropDown: "isDropDown" }, outputs: { valueCompleted: "valueCompleted" }, viewQueries: [{ propertyName: "searchField", first: true, predicate: ["searchField"], descendants: true, read: ElementRef }, { propertyName: "searchTrigger", first: true, predicate: ["searchField"], descendants: true, read: MatMenuTrigger }], ngImport: i0, template: "<ng-template #menuTemplate>\n  <div class=\"p-space-md\">\n    <ta-contact-information icon=\"history\" value=\"core.historical-research.last-searches\">\n      <ta-empty [isEmpty]=\"!this.listRecentSearches?.length && !this.isDropDown\">\n        <ta-list-container class=\"list-container\">\n          @for (search of this.listRecentSearches; track search) {\n            <ta-list-element (click)=\"this.searchCompleted(search)\">\n              <ta-list-title>\n                {{ search }}\n              </ta-list-title>\n              <ta-list-tag>\n                <ta-font-icon name=\"arrow-big-right\" type=\"sm\"></ta-font-icon>\n              </ta-list-tag>\n            </ta-list-element>\n          }\n        </ta-list-container>\n      </ta-empty>\n    </ta-contact-information>\n  </div>\n</ng-template>\n\n<ta-search-field\n  #searchField\n  [isOpen]=\"true\"\n  [placeholder]=\"this.placeholder\"\n  [input]=\"this.input\"\n  (valueCompleted)=\"this.searchCompleted($event)\"\n  [matMenuTriggerFor]=\"this.searchHistory?.type && this.isDropDown === true ? menu : null\"\n></ta-search-field>\n\n<mat-menu #menu=\"matMenu\">\n  <div class=\"\" [style.width.px]=\"this.searchFieldWidth\">\n    @if (menuTemplate) {\n      <ng-container *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"></ng-container>\n    }\n  </div>\n</mat-menu>\n\n@if (menuTemplate && this.searchHistory?.type && this.isDropDown === false) {\n  <ng-container *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"></ng-container>\n}\n\n\n", styles: [""], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: ContactInformationComponent, selector: "ta-contact-information", inputs: ["value", "icon", "localIcon"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ListContainerComponent, selector: "ta-list-container" }, { kind: "component", type: ListElementComponent, selector: "ta-list-element", inputs: ["withSeparator", "flexColumn"], outputs: ["action"] }, { kind: "component", type: ListTitleComponent, selector: "ta-list-title" }, { kind: "component", type: ListTagComponent, selector: "ta-list-tag" }, { kind: "component", type: SearchFieldComponent, selector: "ta-search-field", inputs: ["isOpen", "placeholder", "space", "type"], outputs: ["valueCompleted"] }, { kind: "component", type: MatMenu, selector: "mat-menu", inputs: ["backdropClass", "aria-label", "aria-labelledby", "aria-describedby", "xPosition", "yPosition", "overlapTrigger", "hasBackdrop", "class", "classList"], outputs: ["closed", "close"], exportAs: ["matMenu"] }, { kind: "directive", type: MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", inputs: ["mat-menu-trigger-for", "matMenuTriggerFor", "matMenuTriggerData", "matMenuTriggerRestoreFocus"], outputs: ["menuOpened", "onMenuOpen", "menuClosed", "onMenuClose"], exportAs: ["matMenuTrigger"] }, { kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: SearchHistoryDisplayerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-search-history-displayer', standalone: true, imports: [
                        NgIf,
                        NgFor,
                        FontIconComponent,
                        ContactInformationComponent,
                        EmptyComponent,
                        ListContainerComponent,
                        ListElementComponent,
                        ListTitleComponent,
                        ListTagComponent,
                        SearchFieldComponent,
                        MatMenu,
                        MatMenuTrigger,
                        NgTemplateOutlet,
                    ], template: "<ng-template #menuTemplate>\n  <div class=\"p-space-md\">\n    <ta-contact-information icon=\"history\" value=\"core.historical-research.last-searches\">\n      <ta-empty [isEmpty]=\"!this.listRecentSearches?.length && !this.isDropDown\">\n        <ta-list-container class=\"list-container\">\n          @for (search of this.listRecentSearches; track search) {\n            <ta-list-element (click)=\"this.searchCompleted(search)\">\n              <ta-list-title>\n                {{ search }}\n              </ta-list-title>\n              <ta-list-tag>\n                <ta-font-icon name=\"arrow-big-right\" type=\"sm\"></ta-font-icon>\n              </ta-list-tag>\n            </ta-list-element>\n          }\n        </ta-list-container>\n      </ta-empty>\n    </ta-contact-information>\n  </div>\n</ng-template>\n\n<ta-search-field\n  #searchField\n  [isOpen]=\"true\"\n  [placeholder]=\"this.placeholder\"\n  [input]=\"this.input\"\n  (valueCompleted)=\"this.searchCompleted($event)\"\n  [matMenuTriggerFor]=\"this.searchHistory?.type && this.isDropDown === true ? menu : null\"\n></ta-search-field>\n\n<mat-menu #menu=\"matMenu\">\n  <div class=\"\" [style.width.px]=\"this.searchFieldWidth\">\n    @if (menuTemplate) {\n      <ng-container *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"></ng-container>\n    }\n  </div>\n</mat-menu>\n\n@if (menuTemplate && this.searchHistory?.type && this.isDropDown === false) {\n  <ng-container *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"></ng-container>\n}\n\n\n" }]
        }], propDecorators: { searchHistory: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], isDropDown: [{
                type: Input
            }], valueCompleted: [{
                type: Output
            }], searchField: [{
                type: ViewChild,
                args: ['searchField', { read: ElementRef }]
            }], searchTrigger: [{
                type: ViewChild,
                args: ['searchField', { read: MatMenuTrigger }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWhpc3RvcnktZGlzcGxheWVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9oaXN0b3JpY2FsLXJlc2VhcmNoL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci9zZWFyY2gtaGlzdG9yeS1kaXNwbGF5ZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2hpc3RvcmljYWwtcmVzZWFyY2gvc2VhcmNoLWhpc3RvcnktZGlzcGxheWVyL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVqRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUM5QyxPQUFPLEVBQ0wsMkJBQTJCLEVBQzNCLGNBQWMsRUFDZCxzQkFBc0IsRUFDdEIsb0JBQW9CLEVBQ3BCLGdCQUFnQixFQUNoQixrQkFBa0IsR0FDbkIsTUFBTSxRQUFRLENBQUM7O0FBdUJoQixNQUFN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YXRlT3V0bGV0IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRNZW51LCBNYXRNZW51VHJpZ2dlciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL21lbnUnO1xuXG5pbXBvcnQgeyBMb2NhbFN0b3JhZ2UgfSBmcm9tICdzdG9yYWdlLW1hbmFnZXItanMnO1xuXG5pbXBvcnQgeyBTZWFyY2hGaWVsZENvbXBvbmVudCB9IGZyb20gJ0B0YS9mb3JtLWlucHV0JztcbmltcG9ydCB7IElucHV0VGV4dEJveCB9IGZyb20gJ0B0YS9mb3JtLW1vZGVsJztcbmltcG9ydCB7IEZvbnRJY29uQ29tcG9uZW50IH0gZnJvbSAnQHRhL2ljb25zJztcbmltcG9ydCB7XG4gIENvbnRhY3RJbmZvcm1hdGlvbkNvbXBvbmVudCxcbiAgRW1wdHlDb21wb25lbnQsXG4gIExpc3RDb250YWluZXJDb21wb25lbnQsXG4gIExpc3RFbGVtZW50Q29tcG9uZW50LFxuICBMaXN0VGFnQ29tcG9uZW50LFxuICBMaXN0VGl0bGVDb21wb25lbnQsXG59IGZyb20gJ0B0YS91aSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhLXNlYXJjaC1oaXN0b3J5LWRpc3BsYXllcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9zZWFyY2gtaGlzdG9yeS1kaXNwbGF5ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9zZWFyY2gtaGlzdG9yeS1kaXNwbGF5ZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIE5nSWYsXG4gICAgTmdGb3IsXG4gICAgRm9udEljb25Db21wb25lbnQsXG4gICAgQ29udGFjdEluZm9ybWF0aW9uQ29tcG9uZW50LFxuICAgIEVtcHR5Q29tcG9uZW50LFxuICAgIExpc3RDb250YWluZXJDb21wb25lbnQsXG4gICAgTGlzdEVsZW1lbnRDb21wb25lbnQsXG4gICAgTGlzdFRpdGxlQ29tcG9uZW50LFxuICAgIExpc3RUYWdDb21wb25lbnQsXG4gICAgU2VhcmNoRmllbGRDb21wb25lbnQsXG4gICAgTWF0TWVudSxcbiAgICBNYXRNZW51VHJpZ2dlcixcbiAgICBOZ1RlbXBsYXRlT3V0bGV0LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBTZWFyY2hIaXN0b3J5RGlzcGxheWVyQ29tcG9uZW50IHtcbiAgQElucHV0KClcbiAgc2VhcmNoSGlzdG9yeT86IHtcbiAgICB0eXBlOiBzdHJpbmc7XG4gIH07XG5cbiAgQElucHV0KClcbiAgcGxhY2Vob2xkZXI6IHN0cmluZyA9ICcnO1xuXG4gIEBJbnB1dCgpXG4gIGlzRHJvcERvd246IGJvb2xlYW4gPSBmYWxzZTtcblxuICBAT3V0cHV0KClcbiAgdmFsdWVDb21wbGV0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQFZpZXdDaGlsZCgnc2VhcmNoRmllbGQnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgc2VhcmNoRmllbGQ6IEVsZW1lbnRSZWYgfCBudWxsID0gbnVsbDtcbiAgQFZpZXdDaGlsZCgnc2VhcmNoRmllbGQnLCB7IHJlYWQ6IE1hdE1lbnVUcmlnZ2VyIH0pXG4gIHNlYXJjaFRyaWdnZXI6IE1hdE1lbnVUcmlnZ2VyIHwgbnVsbCA9IG51bGw7XG5cbiAgZ2V0IHNlYXJjaEZpZWxkV2lkdGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoRmllbGQ/Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gIH1cbiAgZ2V0IGxpc3RSZWNlbnRTZWFyY2hlcygpIHtcbiAgICBpZiAodGhpcy5zZWFyY2hIaXN0b3J5Py50eXBlKSB7XG4gICAgICBjb25zdCBzdG9yZWRTZWFyY2hlczogeyByZXNlYXJjaDogc3RyaW5nIH1bXSA9IHRoaXMuX2dldEZyb21Mb2NhbFN0b3JhZ2UodGhpcy5zZWFyY2hIaXN0b3J5Py50eXBlKTtcbiAgICAgIGNvbnN0IHNlYXJjaGVzOiBzdHJpbmdbXSA9IHN0b3JlZFNlYXJjaGVzLm1hcChvYmogPT4gb2JqLnJlc2VhcmNoKTtcbiAgICAgIHJldHVybiBzZWFyY2hlcztcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwdWJsaWMgaW5wdXQgPSBuZXcgSW5wdXRUZXh0Qm94KHtcbiAgICB2YWxpZGF0b3JzOiBbVmFsaWRhdG9ycy5taW5MZW5ndGgoMyldLFxuICB9KTtcblxuICBwdWJsaWMgc2VhcmNoQ29tcGxldGVkKHNlYXJjaDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZSkge1xuICAgICAgdGhpcy5fc2F2ZUluTG9jYWxTdG9yYWdlKHNlYXJjaCk7XG4gICAgfVxuICAgIHRoaXMuaW5wdXQudmFsdWUgPSAnJztcbiAgICB0aGlzLnNlYXJjaFRyaWdnZXI/LmNsb3NlTWVudSgpO1xuICAgIHRoaXMudmFsdWVDb21wbGV0ZWQuZW1pdChzZWFyY2gpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHByaXZhdGUgX2dldEZyb21Mb2NhbFN0b3JhZ2UodHlwZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoTG9jYWxTdG9yYWdlLmdldCgnc2VhcmNoLScgKyB0eXBlKSB8fCAnW10nKTtcbiAgfVxuXG4gIHByaXZhdGUgX3NhdmVJbkxvY2FsU3RvcmFnZShzZWFyY2hWYWx1ZTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZSkge1xuICAgICAgbGV0IHN0b3JlZFNlYXJjaGVzOiB7IHJlc2VhcmNoOiBzdHJpbmc7IHN0b3JhZ2VUaW1lOiBEYXRlIH1bXSA9IHRoaXMuX2dldEZyb21Mb2NhbFN0b3JhZ2UoXG4gICAgICAgIHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHNlYXJjaCA9IHN0b3JlZFNlYXJjaGVzLmZpbmQocyA9PiBzLnJlc2VhcmNoID09PSBzZWFyY2hWYWx1ZSk7XG4gICAgICBpZiAoc2VhcmNoKSB7XG4gICAgICAgIHNlYXJjaC5zdG9yYWdlVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdG9yZWRTZWFyY2hlcy5wdXNoKHtcbiAgICAgICAgICByZXNlYXJjaDogc2VhcmNoVmFsdWUsXG4gICAgICAgICAgc3RvcmFnZVRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5vcmRlckFuZFNlbGVjdChzdG9yZWRTZWFyY2hlcyk7XG4gICAgICBMb2NhbFN0b3JhZ2Uuc2V0KCdzZWFyY2gtJyArIHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZSB8fCAnJywgSlNPTi5zdHJpbmdpZnkoc3RvcmVkU2VhcmNoZXMuc2xpY2UoMCwgNSkpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9yZGVyQW5kU2VsZWN0KGl0ZW1zOiB7IHN0b3JhZ2VUaW1lOiBEYXRlIH1bXSkge1xuICAgIGl0ZW1zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IGRhdGVBID0gbmV3IERhdGUoYS5zdG9yYWdlVGltZSk7XG4gICAgICBjb25zdCBkYXRlQiA9IG5ldyBEYXRlKGIuc3RvcmFnZVRpbWUpO1xuICAgICAgcmV0dXJuIGRhdGVCLmdldFRpbWUoKSAtIGRhdGVBLmdldFRpbWUoKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiPG5nLXRlbXBsYXRlICNtZW51VGVtcGxhdGU+XG4gIDxkaXYgY2xhc3M9XCJwLXNwYWNlLW1kXCI+XG4gICAgPHRhLWNvbnRhY3QtaW5mb3JtYXRpb24gaWNvbj1cImhpc3RvcnlcIiB2YWx1ZT1cImNvcmUuaGlzdG9yaWNhbC1yZXNlYXJjaC5sYXN0LXNlYXJjaGVzXCI+XG4gICAgICA8dGEtZW1wdHkgW2lzRW1wdHldPVwiIXRoaXMubGlzdFJlY2VudFNlYXJjaGVzPy5sZW5ndGggJiYgIXRoaXMuaXNEcm9wRG93blwiPlxuICAgICAgICA8dGEtbGlzdC1jb250YWluZXIgY2xhc3M9XCJsaXN0LWNvbnRhaW5lclwiPlxuICAgICAgICAgIEBmb3IgKHNlYXJjaCBvZiB0aGlzLmxpc3RSZWNlbnRTZWFyY2hlczsgdHJhY2sgc2VhcmNoKSB7XG4gICAgICAgICAgICA8dGEtbGlzdC1lbGVtZW50IChjbGljayk9XCJ0aGlzLnNlYXJjaENvbXBsZXRlZChzZWFyY2gpXCI+XG4gICAgICAgICAgICAgIDx0YS1saXN0LXRpdGxlPlxuICAgICAgICAgICAgICAgIHt7IHNlYXJjaCB9fVxuICAgICAgICAgICAgICA8L3RhLWxpc3QtdGl0bGU+XG4gICAgICAgICAgICAgIDx0YS1saXN0LXRhZz5cbiAgICAgICAgICAgICAgICA8dGEtZm9udC1pY29uIG5hbWU9XCJhcnJvdy1iaWctcmlnaHRcIiB0eXBlPVwic21cIj48L3RhLWZvbnQtaWNvbj5cbiAgICAgICAgICAgICAgPC90YS1saXN0LXRhZz5cbiAgICAgICAgICAgIDwvdGEtbGlzdC1lbGVtZW50PlxuICAgICAgICAgIH1cbiAgICAgICAgPC90YS1saXN0LWNvbnRhaW5lcj5cbiAgICAgIDwvdGEtZW1wdHk+XG4gICAgPC90YS1jb250YWN0LWluZm9ybWF0aW9uPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjx0YS1zZWFyY2gtZmllbGRcbiAgI3NlYXJjaEZpZWxkXG4gIFtpc09wZW5dPVwidHJ1ZVwiXG4gIFtwbGFjZWhvbGRlcl09XCJ0aGlzLnBsYWNlaG9sZGVyXCJcbiAgW2lucHV0XT1cInRoaXMuaW5wdXRcIlxuICAodmFsdWVDb21wbGV0ZWQpPVwidGhpcy5zZWFyY2hDb21wbGV0ZWQoJGV2ZW50KVwiXG4gIFttYXRNZW51VHJpZ2dlckZvcl09XCJ0aGlzLnNlYXJjaEhpc3Rvcnk/LnR5cGUgJiYgdGhpcy5pc0Ryb3BEb3duID09PSB0cnVlID8gbWVudSA6IG51bGxcIlxuPjwvdGEtc2VhcmNoLWZpZWxkPlxuXG48bWF0LW1lbnUgI21lbnU9XCJtYXRNZW51XCI+XG4gIDxkaXYgY2xhc3M9XCJcIiBbc3R5bGUud2lkdGgucHhdPVwidGhpcy5zZWFyY2hGaWVsZFdpZHRoXCI+XG4gICAgQGlmIChtZW51VGVtcGxhdGUpIHtcbiAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJtZW51VGVtcGxhdGU7IGNvbnRleHQ6IHsgZWxlbWVudDogbWVudSB9XCI+PC9uZy1jb250YWluZXI+XG4gICAgfVxuICA8L2Rpdj5cbjwvbWF0LW1lbnU+XG5cbkBpZiAobWVudVRlbXBsYXRlICYmIHRoaXMuc2VhcmNoSGlzdG9yeT8udHlwZSAmJiB0aGlzLmlzRHJvcERvd24gPT09IGZhbHNlKSB7XG4gIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJtZW51VGVtcGxhdGU7IGNvbnRleHQ6IHsgZWxlbWVudDogbWVudSB9XCI+PC9uZy1jb250YWluZXI+XG59XG5cblxuIl19