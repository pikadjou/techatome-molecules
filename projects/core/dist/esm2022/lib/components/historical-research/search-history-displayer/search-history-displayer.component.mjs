import { NgFor, NgIf, NgTemplateOutlet } from "@angular/common";
import { Component, ElementRef, EventEmitter, Output, ViewChild, input, } from "@angular/core";
import { Validators } from "@angular/forms";
import { MatMenu, MatMenuTrigger } from "@angular/material/menu";
import { LocalStorage } from "storage-manager-js";
import { SearchFieldComponent } from "@ta/form-input";
import { InputTextBox } from "@ta/form-model";
import { FontIconComponent } from "@ta/icons";
import { ContactInformationComponent, EmptyComponent, ListContainerComponent, ListElementComponent, ListTagComponent, ListTitleComponent, } from "@ta/ui";
import * as i0 from "@angular/core";
export class SearchHistoryDisplayerComponent {
    constructor() {
        this.searchHistory = input();
        this.placeholder = input("");
        this.isDropDown = input(false);
        this.valueCompleted = new EventEmitter();
        this.searchField = null;
        this.searchTrigger = null;
        this.input = new InputTextBox({
            validators: [Validators.minLength(3)],
        });
    }
    get searchFieldWidth() {
        return this.searchField?.nativeElement.offsetWidth;
    }
    get listRecentSearches() {
        const searchHistoryValue = this.searchHistory();
        if (searchHistoryValue?.type) {
            const storedSearches = this._getFromLocalStorage(searchHistoryValue.type);
            const searches = storedSearches.map((obj) => obj.research);
            return searches;
        }
        return null;
    }
    searchCompleted(search) {
        const searchHistoryValue = this.searchHistory();
        if (searchHistoryValue?.type) {
            this._saveInLocalStorage(search);
        }
        this.input.value = "";
        this.searchTrigger?.closeMenu();
        this.valueCompleted.emit(search);
        return;
    }
    _getFromLocalStorage(type) {
        return JSON.parse(LocalStorage.get("search-" + type) || "[]");
    }
    _saveInLocalStorage(searchValue) {
        const searchHistoryValue = this.searchHistory();
        if (searchHistoryValue?.type) {
            let storedSearches = this._getFromLocalStorage(searchHistoryValue.type);
            const search = storedSearches.find((s) => s.research === searchValue);
            if (search) {
                search.storageTime = new Date();
            }
            else {
                storedSearches.push({
                    research: searchValue,
                    storageTime: new Date(),
                });
            }
            this.orderAndSelect(storedSearches);
            LocalStorage.set("search-" + searchHistoryValue.type || "", JSON.stringify(storedSearches.slice(0, 5)));
        }
    }
    orderAndSelect(items) {
        items.sort((a, b) => {
            const dateA = new Date(a.storageTime);
            const dateB = new Date(b.storageTime);
            return dateB.getTime() - dateA.getTime();
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: SearchHistoryDisplayerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: SearchHistoryDisplayerComponent, isStandalone: true, selector: "ta-search-history-displayer", inputs: { searchHistory: { classPropertyName: "searchHistory", publicName: "searchHistory", isSignal: true, isRequired: false, transformFunction: null }, placeholder: { classPropertyName: "placeholder", publicName: "placeholder", isSignal: true, isRequired: false, transformFunction: null }, isDropDown: { classPropertyName: "isDropDown", publicName: "isDropDown", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { valueCompleted: "valueCompleted" }, viewQueries: [{ propertyName: "searchField", first: true, predicate: ["searchField"], descendants: true, read: ElementRef }, { propertyName: "searchTrigger", first: true, predicate: ["searchField"], descendants: true, read: MatMenuTrigger }], ngImport: i0, template: "<ng-template #menuTemplate>\n  <div class=\"p-space-md\">\n    <ta-contact-information\n      icon=\"history\"\n      value=\"core.historical-research.last-searches\"\n    >\n      <ta-empty\n        [isEmpty]=\"!this.listRecentSearches?.length && !this.isDropDown()\"\n      >\n        <ta-list-container class=\"list-container\">\n          @for (search of this.listRecentSearches; track search) {\n          <ta-list-element (click)=\"this.searchCompleted(search)\">\n            <ta-list-title>\n              {{ search }}\n            </ta-list-title>\n            <ta-list-tag>\n              <ta-font-icon name=\"arrow-big-right\" type=\"sm\"></ta-font-icon>\n            </ta-list-tag>\n          </ta-list-element>\n          }\n        </ta-list-container>\n      </ta-empty>\n    </ta-contact-information>\n  </div>\n</ng-template>\n\n<ta-search-field\n  #searchField\n  [isOpen]=\"true\"\n  [placeholder]=\"this.placeholder()\"\n  [input]=\"this.input\"\n  (valueCompleted)=\"this.searchCompleted($event)\"\n  [matMenuTriggerFor]=\"\n    this.searchHistory()?.type && this.isDropDown() === true ? menu : null\n  \"\n></ta-search-field>\n\n<mat-menu #menu=\"matMenu\">\n  <div class=\"\" [style.width.px]=\"this.searchFieldWidth\">\n    @if (menuTemplate) {\n    <ng-container\n      *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n    ></ng-container>\n    }\n  </div>\n</mat-menu>\n\n@if (menuTemplate && this.searchHistory()?.type && this.isDropDown() === false) {\n<ng-container\n  *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n></ng-container>\n}\n", styles: [""], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: ContactInformationComponent, selector: "ta-contact-information", inputs: ["value", "icon", "localIcon"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ListContainerComponent, selector: "ta-list-container" }, { kind: "component", type: ListElementComponent, selector: "ta-list-element", inputs: ["withSeparator", "flexColumn"], outputs: ["action"] }, { kind: "component", type: ListTitleComponent, selector: "ta-list-title" }, { kind: "component", type: ListTagComponent, selector: "ta-list-tag" }, { kind: "component", type: SearchFieldComponent, selector: "ta-search-field", inputs: ["isOpen", "placeholder", "space", "type"], outputs: ["valueCompleted"] }, { kind: "component", type: MatMenu, selector: "mat-menu", inputs: ["backdropClass", "aria-label", "aria-labelledby", "aria-describedby", "xPosition", "yPosition", "overlapTrigger", "hasBackdrop", "class", "classList"], outputs: ["closed", "close"], exportAs: ["matMenu"] }, { kind: "directive", type: MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", inputs: ["mat-menu-trigger-for", "matMenuTriggerFor", "matMenuTriggerData", "matMenuTriggerRestoreFocus"], outputs: ["menuOpened", "onMenuOpen", "menuClosed", "onMenuClose"], exportAs: ["matMenuTrigger"] }, { kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: SearchHistoryDisplayerComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-search-history-displayer", standalone: true, imports: [
                        NgIf,
                        NgFor,
                        FontIconComponent,
                        ContactInformationComponent,
                        EmptyComponent,
                        ListContainerComponent,
                        ListElementComponent,
                        ListTitleComponent,
                        ListTagComponent,
                        SearchFieldComponent,
                        MatMenu,
                        MatMenuTrigger,
                        NgTemplateOutlet,
                    ], template: "<ng-template #menuTemplate>\n  <div class=\"p-space-md\">\n    <ta-contact-information\n      icon=\"history\"\n      value=\"core.historical-research.last-searches\"\n    >\n      <ta-empty\n        [isEmpty]=\"!this.listRecentSearches?.length && !this.isDropDown()\"\n      >\n        <ta-list-container class=\"list-container\">\n          @for (search of this.listRecentSearches; track search) {\n          <ta-list-element (click)=\"this.searchCompleted(search)\">\n            <ta-list-title>\n              {{ search }}\n            </ta-list-title>\n            <ta-list-tag>\n              <ta-font-icon name=\"arrow-big-right\" type=\"sm\"></ta-font-icon>\n            </ta-list-tag>\n          </ta-list-element>\n          }\n        </ta-list-container>\n      </ta-empty>\n    </ta-contact-information>\n  </div>\n</ng-template>\n\n<ta-search-field\n  #searchField\n  [isOpen]=\"true\"\n  [placeholder]=\"this.placeholder()\"\n  [input]=\"this.input\"\n  (valueCompleted)=\"this.searchCompleted($event)\"\n  [matMenuTriggerFor]=\"\n    this.searchHistory()?.type && this.isDropDown() === true ? menu : null\n  \"\n></ta-search-field>\n\n<mat-menu #menu=\"matMenu\">\n  <div class=\"\" [style.width.px]=\"this.searchFieldWidth\">\n    @if (menuTemplate) {\n    <ng-container\n      *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n    ></ng-container>\n    }\n  </div>\n</mat-menu>\n\n@if (menuTemplate && this.searchHistory()?.type && this.isDropDown() === false) {\n<ng-container\n  *ngTemplateOutlet=\"menuTemplate; context: { element: menu }\"\n></ng-container>\n}\n" }]
        }], propDecorators: { valueCompleted: [{
                type: Output
            }], searchField: [{
                type: ViewChild,
                args: ["searchField", { read: ElementRef }]
            }], searchTrigger: [{
                type: ViewChild,
                args: ["searchField", { read: MatMenuTrigger }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWhpc3RvcnktZGlzcGxheWVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9oaXN0b3JpY2FsLXJlc2VhcmNoL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci9zZWFyY2gtaGlzdG9yeS1kaXNwbGF5ZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2hpc3RvcmljYWwtcmVzZWFyY2gvc2VhcmNoLWhpc3RvcnktZGlzcGxheWVyL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hFLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sU0FBUyxFQUNULEtBQUssR0FDTixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVqRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUM5QyxPQUFPLEVBQ0wsMkJBQTJCLEVBQzNCLGNBQWMsRUFDZCxzQkFBc0IsRUFDdEIsb0JBQW9CLEVBQ3BCLGdCQUFnQixFQUNoQixrQkFBa0IsR0FDbkIsTUFBTSxRQUFRLENBQUM7O0FBdUJoQixNQUFN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QUFhO3NCQURaLFNBQVM7dUJBQUMsYUFBYSxFQUFFLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nRm9yLCBOZ0lmLCBOZ1RlbXBsYXRlT3V0bGV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkLFxuICBpbnB1dCxcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFZhbGlkYXRvcnMgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IE1hdE1lbnUsIE1hdE1lbnVUcmlnZ2VyIH0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL21lbnVcIjtcblxuaW1wb3J0IHsgTG9jYWxTdG9yYWdlIH0gZnJvbSBcInN0b3JhZ2UtbWFuYWdlci1qc1wiO1xuXG5pbXBvcnQgeyBTZWFyY2hGaWVsZENvbXBvbmVudCB9IGZyb20gXCJAdGEvZm9ybS1pbnB1dFwiO1xuaW1wb3J0IHsgSW5wdXRUZXh0Qm94IH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gXCJAdGEvaWNvbnNcIjtcbmltcG9ydCB7XG4gIENvbnRhY3RJbmZvcm1hdGlvbkNvbXBvbmVudCxcbiAgRW1wdHlDb21wb25lbnQsXG4gIExpc3RDb250YWluZXJDb21wb25lbnQsXG4gIExpc3RFbGVtZW50Q29tcG9uZW50LFxuICBMaXN0VGFnQ29tcG9uZW50LFxuICBMaXN0VGl0bGVDb21wb25lbnQsXG59IGZyb20gXCJAdGEvdWlcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRhLXNlYXJjaC1oaXN0b3J5LWRpc3BsYXllclwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL3NlYXJjaC1oaXN0b3J5LWRpc3BsYXllci5jb21wb25lbnQuaHRtbFwiLFxuICBzdHlsZVVybHM6IFtcIi4vc2VhcmNoLWhpc3RvcnktZGlzcGxheWVyLmNvbXBvbmVudC5zY3NzXCJdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgTmdJZixcbiAgICBOZ0ZvcixcbiAgICBGb250SWNvbkNvbXBvbmVudCxcbiAgICBDb250YWN0SW5mb3JtYXRpb25Db21wb25lbnQsXG4gICAgRW1wdHlDb21wb25lbnQsXG4gICAgTGlzdENvbnRhaW5lckNvbXBvbmVudCxcbiAgICBMaXN0RWxlbWVudENvbXBvbmVudCxcbiAgICBMaXN0VGl0bGVDb21wb25lbnQsXG4gICAgTGlzdFRhZ0NvbXBvbmVudCxcbiAgICBTZWFyY2hGaWVsZENvbXBvbmVudCxcbiAgICBNYXRNZW51LFxuICAgIE1hdE1lbnVUcmlnZ2VyLFxuICAgIE5nVGVtcGxhdGVPdXRsZXQsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaEhpc3RvcnlEaXNwbGF5ZXJDb21wb25lbnQge1xuICBzZWFyY2hIaXN0b3J5ID0gaW5wdXQ8e1xuICAgIHR5cGU6IHN0cmluZztcbiAgfT4oKTtcblxuICBwbGFjZWhvbGRlciA9IGlucHV0PHN0cmluZz4oXCJcIik7XG5cbiAgaXNEcm9wRG93biA9IGlucHV0PGJvb2xlYW4+KGZhbHNlKTtcblxuICBAT3V0cHV0KClcbiAgdmFsdWVDb21wbGV0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQFZpZXdDaGlsZChcInNlYXJjaEZpZWxkXCIsIHsgcmVhZDogRWxlbWVudFJlZiB9KVxuICBzZWFyY2hGaWVsZDogRWxlbWVudFJlZiB8IG51bGwgPSBudWxsO1xuICBAVmlld0NoaWxkKFwic2VhcmNoRmllbGRcIiwgeyByZWFkOiBNYXRNZW51VHJpZ2dlciB9KVxuICBzZWFyY2hUcmlnZ2VyOiBNYXRNZW51VHJpZ2dlciB8IG51bGwgPSBudWxsO1xuXG4gIGdldCBzZWFyY2hGaWVsZFdpZHRoKCkge1xuICAgIHJldHVybiB0aGlzLnNlYXJjaEZpZWxkPy5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICB9XG4gIGdldCBsaXN0UmVjZW50U2VhcmNoZXMoKSB7XG4gICAgY29uc3Qgc2VhcmNoSGlzdG9yeVZhbHVlID0gdGhpcy5zZWFyY2hIaXN0b3J5KCk7XG4gICAgaWYgKHNlYXJjaEhpc3RvcnlWYWx1ZT8udHlwZSkge1xuICAgICAgY29uc3Qgc3RvcmVkU2VhcmNoZXM6IHsgcmVzZWFyY2g6IHN0cmluZyB9W10gPSB0aGlzLl9nZXRGcm9tTG9jYWxTdG9yYWdlKFxuICAgICAgICBzZWFyY2hIaXN0b3J5VmFsdWUudHlwZVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHNlYXJjaGVzOiBzdHJpbmdbXSA9IHN0b3JlZFNlYXJjaGVzLm1hcCgob2JqKSA9PiBvYmoucmVzZWFyY2gpO1xuICAgICAgcmV0dXJuIHNlYXJjaGVzO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHB1YmxpYyBpbnB1dCA9IG5ldyBJbnB1dFRleHRCb3goe1xuICAgIHZhbGlkYXRvcnM6IFtWYWxpZGF0b3JzLm1pbkxlbmd0aCgzKV0sXG4gIH0pO1xuXG4gIHB1YmxpYyBzZWFyY2hDb21wbGV0ZWQoc2VhcmNoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZWFyY2hIaXN0b3J5VmFsdWUgPSB0aGlzLnNlYXJjaEhpc3RvcnkoKTtcbiAgICBpZiAoc2VhcmNoSGlzdG9yeVZhbHVlPy50eXBlKSB7XG4gICAgICB0aGlzLl9zYXZlSW5Mb2NhbFN0b3JhZ2Uoc2VhcmNoKTtcbiAgICB9XG4gICAgdGhpcy5pbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgdGhpcy5zZWFyY2hUcmlnZ2VyPy5jbG9zZU1lbnUoKTtcbiAgICB0aGlzLnZhbHVlQ29tcGxldGVkLmVtaXQoc2VhcmNoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBwcml2YXRlIF9nZXRGcm9tTG9jYWxTdG9yYWdlKHR5cGU6IHN0cmluZykge1xuICAgIHJldHVybiBKU09OLnBhcnNlKExvY2FsU3RvcmFnZS5nZXQoXCJzZWFyY2gtXCIgKyB0eXBlKSB8fCBcIltdXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBfc2F2ZUluTG9jYWxTdG9yYWdlKHNlYXJjaFZhbHVlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZWFyY2hIaXN0b3J5VmFsdWUgPSB0aGlzLnNlYXJjaEhpc3RvcnkoKTtcbiAgICBpZiAoc2VhcmNoSGlzdG9yeVZhbHVlPy50eXBlKSB7XG4gICAgICBsZXQgc3RvcmVkU2VhcmNoZXM6IHsgcmVzZWFyY2g6IHN0cmluZzsgc3RvcmFnZVRpbWU6IERhdGUgfVtdID1cbiAgICAgICAgdGhpcy5fZ2V0RnJvbUxvY2FsU3RvcmFnZShzZWFyY2hIaXN0b3J5VmFsdWUudHlwZSk7XG4gICAgICBjb25zdCBzZWFyY2ggPSBzdG9yZWRTZWFyY2hlcy5maW5kKChzKSA9PiBzLnJlc2VhcmNoID09PSBzZWFyY2hWYWx1ZSk7XG4gICAgICBpZiAoc2VhcmNoKSB7XG4gICAgICAgIHNlYXJjaC5zdG9yYWdlVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdG9yZWRTZWFyY2hlcy5wdXNoKHtcbiAgICAgICAgICByZXNlYXJjaDogc2VhcmNoVmFsdWUsXG4gICAgICAgICAgc3RvcmFnZVRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5vcmRlckFuZFNlbGVjdChzdG9yZWRTZWFyY2hlcyk7XG4gICAgICBMb2NhbFN0b3JhZ2Uuc2V0KFxuICAgICAgICBcInNlYXJjaC1cIiArIHNlYXJjaEhpc3RvcnlWYWx1ZS50eXBlIHx8IFwiXCIsXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHN0b3JlZFNlYXJjaGVzLnNsaWNlKDAsIDUpKVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9yZGVyQW5kU2VsZWN0KGl0ZW1zOiB7IHN0b3JhZ2VUaW1lOiBEYXRlIH1bXSkge1xuICAgIGl0ZW1zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IGRhdGVBID0gbmV3IERhdGUoYS5zdG9yYWdlVGltZSk7XG4gICAgICBjb25zdCBkYXRlQiA9IG5ldyBEYXRlKGIuc3RvcmFnZVRpbWUpO1xuICAgICAgcmV0dXJuIGRhdGVCLmdldFRpbWUoKSAtIGRhdGVBLmdldFRpbWUoKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiPG5nLXRlbXBsYXRlICNtZW51VGVtcGxhdGU+XG4gIDxkaXYgY2xhc3M9XCJwLXNwYWNlLW1kXCI+XG4gICAgPHRhLWNvbnRhY3QtaW5mb3JtYXRpb25cbiAgICAgIGljb249XCJoaXN0b3J5XCJcbiAgICAgIHZhbHVlPVwiY29yZS5oaXN0b3JpY2FsLXJlc2VhcmNoLmxhc3Qtc2VhcmNoZXNcIlxuICAgID5cbiAgICAgIDx0YS1lbXB0eVxuICAgICAgICBbaXNFbXB0eV09XCIhdGhpcy5saXN0UmVjZW50U2VhcmNoZXM/Lmxlbmd0aCAmJiAhdGhpcy5pc0Ryb3BEb3duKClcIlxuICAgICAgPlxuICAgICAgICA8dGEtbGlzdC1jb250YWluZXIgY2xhc3M9XCJsaXN0LWNvbnRhaW5lclwiPlxuICAgICAgICAgIEBmb3IgKHNlYXJjaCBvZiB0aGlzLmxpc3RSZWNlbnRTZWFyY2hlczsgdHJhY2sgc2VhcmNoKSB7XG4gICAgICAgICAgPHRhLWxpc3QtZWxlbWVudCAoY2xpY2spPVwidGhpcy5zZWFyY2hDb21wbGV0ZWQoc2VhcmNoKVwiPlxuICAgICAgICAgICAgPHRhLWxpc3QtdGl0bGU+XG4gICAgICAgICAgICAgIHt7IHNlYXJjaCB9fVxuICAgICAgICAgICAgPC90YS1saXN0LXRpdGxlPlxuICAgICAgICAgICAgPHRhLWxpc3QtdGFnPlxuICAgICAgICAgICAgICA8dGEtZm9udC1pY29uIG5hbWU9XCJhcnJvdy1iaWctcmlnaHRcIiB0eXBlPVwic21cIj48L3RhLWZvbnQtaWNvbj5cbiAgICAgICAgICAgIDwvdGEtbGlzdC10YWc+XG4gICAgICAgICAgPC90YS1saXN0LWVsZW1lbnQ+XG4gICAgICAgICAgfVxuICAgICAgICA8L3RhLWxpc3QtY29udGFpbmVyPlxuICAgICAgPC90YS1lbXB0eT5cbiAgICA8L3RhLWNvbnRhY3QtaW5mb3JtYXRpb24+XG4gIDwvZGl2PlxuPC9uZy10ZW1wbGF0ZT5cblxuPHRhLXNlYXJjaC1maWVsZFxuICAjc2VhcmNoRmllbGRcbiAgW2lzT3Blbl09XCJ0cnVlXCJcbiAgW3BsYWNlaG9sZGVyXT1cInRoaXMucGxhY2Vob2xkZXIoKVwiXG4gIFtpbnB1dF09XCJ0aGlzLmlucHV0XCJcbiAgKHZhbHVlQ29tcGxldGVkKT1cInRoaXMuc2VhcmNoQ29tcGxldGVkKCRldmVudClcIlxuICBbbWF0TWVudVRyaWdnZXJGb3JdPVwiXG4gICAgdGhpcy5zZWFyY2hIaXN0b3J5KCk/LnR5cGUgJiYgdGhpcy5pc0Ryb3BEb3duKCkgPT09IHRydWUgPyBtZW51IDogbnVsbFxuICBcIlxuPjwvdGEtc2VhcmNoLWZpZWxkPlxuXG48bWF0LW1lbnUgI21lbnU9XCJtYXRNZW51XCI+XG4gIDxkaXYgY2xhc3M9XCJcIiBbc3R5bGUud2lkdGgucHhdPVwidGhpcy5zZWFyY2hGaWVsZFdpZHRoXCI+XG4gICAgQGlmIChtZW51VGVtcGxhdGUpIHtcbiAgICA8bmctY29udGFpbmVyXG4gICAgICAqbmdUZW1wbGF0ZU91dGxldD1cIm1lbnVUZW1wbGF0ZTsgY29udGV4dDogeyBlbGVtZW50OiBtZW51IH1cIlxuICAgID48L25nLWNvbnRhaW5lcj5cbiAgICB9XG4gIDwvZGl2PlxuPC9tYXQtbWVudT5cblxuQGlmIChtZW51VGVtcGxhdGUgJiYgdGhpcy5zZWFyY2hIaXN0b3J5KCk/LnR5cGUgJiYgdGhpcy5pc0Ryb3BEb3duKCkgPT09IGZhbHNlKSB7XG48bmctY29udGFpbmVyXG4gICpuZ1RlbXBsYXRlT3V0bGV0PVwibWVudVRlbXBsYXRlOyBjb250ZXh0OiB7IGVsZW1lbnQ6IG1lbnUgfVwiXG4+PC9uZy1jb250YWluZXI+XG59XG4iXX0=