import { Injectable } from "@angular/core";
import { filter, map } from "rxjs";
import { HandleSimpleRequest, Request, TaBaseService, } from "@ta/server";
import { isNonNullable, keepUniqueObjectByProperty } from "@ta/utils";
import { GET_DOCUMENTS } from "./queries";
import * as i0 from "@angular/core";
const graphEndpoint = {
    clientName: "documentService",
    endpoint: "document",
};
const apiRoutes = {
    UploadDocument: {
        type: "FILES",
        url: "{ApiUrl}/Media/upload",
    },
};
export class TaDocumentsService extends TaBaseService {
    constructor() {
        super();
        this.documents = new HandleSimpleRequest();
        super.registerRoutes({
            apiRoutes: apiRoutes,
            graphEndpoint: graphEndpoint,
        });
    }
    getDocuments(ids) {
        return this.documents.get()?.filter((doc) => ids.includes(doc.id));
    }
    getDocuments$(ids) {
        return this.documents
            .get$()
            .pipe(map((list) => list?.filter((doc) => ids.includes(doc.id))));
    }
    fetchDocuments$(ids) {
        return this.documents.fetch(this._graphService
            .fetchPagedQueryList(GET_DOCUMENTS({ ids }), "documents", graphEndpoint.clientName)
            .pipe(map((data) => data.items ?? []), filter(isNonNullable), map((list) => [...(list ?? []), ...(this.documents.get() ?? [])]), map((list) => keepUniqueObjectByProperty(list, (item) => item.id))));
    }
    addDocument$(doc) {
        const formData = new FormData();
        formData.append("file", doc.file, doc.file.name);
        return this._serverService.request(new Request({
            type: "UploadDocument",
            content: {
                files: formData,
            },
        }));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: TaDocumentsService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: TaDocumentsService, providedIn: "root" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: TaDocumentsService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: "root",
                }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnRzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL3NlcnZpY2VzL2ZpbGVzL2RvY3VtZW50cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbkMsT0FBTyxFQUVMLG1CQUFtQixFQUVuQixPQUFPLEVBQ1AsYUFBYSxHQUNkLE1BQU0sWUFBWSxDQUFDO0FBQ3BCLE9BQU8sRUFBRSxhQUFhLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFJdEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLFdBQVcsQ0FBQzs7QUFFMUMsTUFBTSxhQUFhLEdBQWtCO0lBQ25DLFVBQVUsRUFBRSxpQkFBaUI7SUFDN0IsUUFBUSxFQUFFLFVBQVU7Q0FDckIsQ0FBQztBQUVGLE1BQU0sU0FBUyxHQUFtQjtJQUNoQyxjQUFjLEVBQUU7UUFDZCxJQUFJLEVBQUUsT0FBTztRQUNiLEdBQUcsRUFBRSx1QkFBdUI7S0FDN0I7Q0FDRixDQUFDO0FBS0YsTUFBTSxPQUFPLGtCQUFtQixTQUFRLGFBQWE7SUFHbkQ7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUhILGNBQVMsR0FBRyxJQUFJLG1CQUFtQixFQUFpQixDQUFDO1FBSTFELEtBQUssQ0FBQyxjQUFjLENBQUM7WUFDbkIsU0FBUyxFQUFFLFNBQVM7WUFDcEIsYUFBYSxFQUFFLGFBQWE7U0FDN0IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLFlBQVksQ0FBQyxHQUFhO1FBQy9CLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVNLGFBQWEsQ0FBQyxHQUFhO1FBQ2hDLE9BQU8sSUFBSSxDQUFDLFNBQVM7YUFDbEIsSUFBSSxFQUFFO2FBQ04sSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUNNLGVBQWUsQ0FBQyxHQUFhO1FBQ2xDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQ3pCLElBQUksQ0FBQyxhQUFhO2FBQ2YsbUJBQW1CLENBQ2xCLGFBQWEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQ3RCLFdBQVcsRUFDWCxhQUFhLENBQUMsVUFBVSxDQUN6QjthQUNBLElBQUksQ0FDSCxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLEVBQy9CLE1BQU0sQ0FBQyxhQUFhLENBQUMsRUFDckIsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUNqRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLDBCQUEwQixDQUFDLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQ25FLENBQ0osQ0FBQztJQUNKLENBQUM7SUFFTSxZQUFZLENBQUMsR0FBMkI7UUFDN0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztRQUNoQyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFakQsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FDaEMsSUFBSSxPQUFPLENBQUM7WUFDVixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLE9BQU8sRUFBRTtnQkFDUCxLQUFLLEVBQUUsUUFBUTthQUNoQjtTQUNGLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzsrR0FqRFUsa0JBQWtCO21IQUFsQixrQkFBa0IsY0FGakIsTUFBTTs7NEZBRVAsa0JBQWtCO2tCQUg5QixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gXCJyeGpzXCI7XG5cbmltcG9ydCB7XG4gIEdyYXBoRW5kcG9pbnQsXG4gIEhhbmRsZVNpbXBsZVJlcXVlc3QsXG4gIE1hcHBpbmdBcGlUeXBlLFxuICBSZXF1ZXN0LFxuICBUYUJhc2VTZXJ2aWNlLFxufSBmcm9tIFwiQHRhL3NlcnZlclwiO1xuaW1wb3J0IHsgaXNOb25OdWxsYWJsZSwga2VlcFVuaXF1ZU9iamVjdEJ5UHJvcGVydHkgfSBmcm9tIFwiQHRhL3V0aWxzXCI7XG5cbmltcG9ydCB7IERvY3VtZW50RHRvIH0gZnJvbSBcIi4vZHRvL2RvY3VtZW50XCI7XG5pbXBvcnQgeyBVcGxvYWRGaWxlUGF5bG9hZElucHV0IH0gZnJvbSBcIi4vZHRvL3Bvc3QvVXBsb2FkRmlsZVBheWxvYWRJbnB1dFwiO1xuaW1wb3J0IHsgR0VUX0RPQ1VNRU5UUyB9IGZyb20gXCIuL3F1ZXJpZXNcIjtcblxuY29uc3QgZ3JhcGhFbmRwb2ludDogR3JhcGhFbmRwb2ludCA9IHtcbiAgY2xpZW50TmFtZTogXCJkb2N1bWVudFNlcnZpY2VcIixcbiAgZW5kcG9pbnQ6IFwiZG9jdW1lbnRcIixcbn07XG5cbmNvbnN0IGFwaVJvdXRlczogTWFwcGluZ0FwaVR5cGUgPSB7XG4gIFVwbG9hZERvY3VtZW50OiB7XG4gICAgdHlwZTogXCJGSUxFU1wiLFxuICAgIHVybDogXCJ7QXBpVXJsfS9NZWRpYS91cGxvYWRcIixcbiAgfSxcbn07XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogXCJyb290XCIsXG59KVxuZXhwb3J0IGNsYXNzIFRhRG9jdW1lbnRzU2VydmljZSBleHRlbmRzIFRhQmFzZVNlcnZpY2Uge1xuICBwdWJsaWMgZG9jdW1lbnRzID0gbmV3IEhhbmRsZVNpbXBsZVJlcXVlc3Q8RG9jdW1lbnREdG9bXT4oKTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHN1cGVyLnJlZ2lzdGVyUm91dGVzKHtcbiAgICAgIGFwaVJvdXRlczogYXBpUm91dGVzLFxuICAgICAgZ3JhcGhFbmRwb2ludDogZ3JhcGhFbmRwb2ludCxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXREb2N1bWVudHMoaWRzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLmRvY3VtZW50cy5nZXQoKT8uZmlsdGVyKChkb2MpID0+IGlkcy5pbmNsdWRlcyhkb2MuaWQpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXREb2N1bWVudHMkKGlkczogc3RyaW5nW10pIHtcbiAgICByZXR1cm4gdGhpcy5kb2N1bWVudHNcbiAgICAgIC5nZXQkKClcbiAgICAgIC5waXBlKG1hcCgobGlzdCkgPT4gbGlzdD8uZmlsdGVyKChkb2MpID0+IGlkcy5pbmNsdWRlcyhkb2MuaWQpKSkpO1xuICB9XG4gIHB1YmxpYyBmZXRjaERvY3VtZW50cyQoaWRzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiB0aGlzLmRvY3VtZW50cy5mZXRjaChcbiAgICAgIHRoaXMuX2dyYXBoU2VydmljZVxuICAgICAgICAuZmV0Y2hQYWdlZFF1ZXJ5TGlzdDxEb2N1bWVudER0bz4oXG4gICAgICAgICAgR0VUX0RPQ1VNRU5UUyh7IGlkcyB9KSxcbiAgICAgICAgICBcImRvY3VtZW50c1wiLFxuICAgICAgICAgIGdyYXBoRW5kcG9pbnQuY2xpZW50TmFtZVxuICAgICAgICApXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIG1hcCgoZGF0YSkgPT4gZGF0YS5pdGVtcyA/PyBbXSksXG4gICAgICAgICAgZmlsdGVyKGlzTm9uTnVsbGFibGUpLFxuICAgICAgICAgIG1hcCgobGlzdCkgPT4gWy4uLihsaXN0ID8/IFtdKSwgLi4uKHRoaXMuZG9jdW1lbnRzLmdldCgpID8/IFtdKV0pLFxuICAgICAgICAgIG1hcCgobGlzdCkgPT4ga2VlcFVuaXF1ZU9iamVjdEJ5UHJvcGVydHkobGlzdCwgKGl0ZW0pID0+IGl0ZW0uaWQpKVxuICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGREb2N1bWVudCQoZG9jOiBVcGxvYWRGaWxlUGF5bG9hZElucHV0KSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGRvYy5maWxlLCBkb2MuZmlsZS5uYW1lKTtcblxuICAgIHJldHVybiB0aGlzLl9zZXJ2ZXJTZXJ2aWNlLnJlcXVlc3Q8RG9jdW1lbnREdG8+KFxuICAgICAgbmV3IFJlcXVlc3Qoe1xuICAgICAgICB0eXBlOiBcIlVwbG9hZERvY3VtZW50XCIsXG4gICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICBmaWxlczogZm9ybURhdGEsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICk7XG4gIH1cbn1cbiJdfQ==