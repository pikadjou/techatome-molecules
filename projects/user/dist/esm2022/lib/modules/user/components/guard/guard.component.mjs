import { AsyncPipe } from '@angular/common';
import { Component, inject, input } from '@angular/core';
import { FontIconComponent } from '@ta/icons';
import { TaIconType } from '@ta/icons';
import { TaMainRoute, TaRoutes } from '@ta/menu';
import { TranslatePipe } from '@ta/translation';
import { ButtonComponent } from '@ta/ui';
import { TaAbstractComponent } from '@ta/utils';
import { TaTranslationUser } from '../../../../translation.service';
import { TaPermissionsService } from '../../services/permissions.service';
import * as i0 from "@angular/core";
export class GuardComponent extends TaAbstractComponent {
    get noAccessIcon() {
        return TaIconType.NoAccess;
    }
    constructor() {
        super();
        this.level = input();
        this.feature = input();
        this.role = input();
        this.canDisplayErrorMessage = input(true);
        /** Affiche le contenu avec un overlay de connexion au lieu de le masquer */
        this.preview = input(false);
        this._permissionsService = inject(TaPermissionsService);
        TaTranslationUser.getInstance();
    }
    isGuardValid$() {
        if (this.role()) {
            return this._permissionsService.hasRole$(this.role());
        }
        return this._permissionsService.canAccess$(this.feature() ?? '', this.level() ?? 'authorize');
    }
    goToLogin() {
        this._router.navigateByUrl(TaRoutes.getUrl([TaMainRoute.USERLOGIN]));
    }
    goToRegister() {
        this._router.navigateByUrl(TaRoutes.getUrl([TaMainRoute.SINGIN]));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: GuardComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: GuardComponent, isStandalone: true, selector: "ta-guard", inputs: { level: { classPropertyName: "level", publicName: "level", isSignal: true, isRequired: false, transformFunction: null }, feature: { classPropertyName: "feature", publicName: "feature", isSignal: true, isRequired: false, transformFunction: null }, role: { classPropertyName: "role", publicName: "role", isSignal: true, isRequired: false, transformFunction: null }, canDisplayErrorMessage: { classPropertyName: "canDisplayErrorMessage", publicName: "canDisplayErrorMessage", isSignal: true, isRequired: false, transformFunction: null }, preview: { classPropertyName: "preview", publicName: "preview", isSignal: true, isRequired: false, transformFunction: null } }, usesInheritance: true, ngImport: i0, template: "@let isValid = this.isGuardValid$() | async;\n\n<div class=\"guard\">\n  @if (isValid || this.preview()) {\n  <div class=\"guard-content\" [class.guard-content--preview]=\"!isValid && this.preview()\">\n    <div class=\"guard-projected\">\n      <ng-content></ng-content>\n    </div>\n\n    @if (!isValid && this.preview()) {\n    <div class=\"guard-overlay\">\n      <div class=\"guard-overlay-cta\">\n        <p class=\"guard-overlay-title\">{{ \"user.guard.preview.title\" | translate }}</p>\n        <p class=\"guard-overlay-subtitle\">{{ \"user.guard.preview.subtitle\" | translate }}</p>\n        <div class=\"flex-row g-space-sm\">\n          <ta-button [type]=\"'secondary'\" (action)=\"this.goToRegister()\">\n            {{ \"user.register\" | translate }}\n          </ta-button>\n          <ta-button (action)=\"this.goToLogin()\">\n            {{ \"user.login\" | translate }}\n          </ta-button>\n        </div>\n      </div>\n    </div>\n    }\n  </div>\n  } @if (!isValid && !this.preview() && this.canDisplayErrorMessage()) {\n  <div class=\"guard-no-valid ta-c\">\n    <ta-font-icon name=\"close-tool\" size=\"md\"></ta-font-icon>\n    {{ \"user.guard.content\" | translate }}\n\n    @if (this.level() === 'authenticated') {\n    <ta-button (action)=\"this.goToLogin()\"> Me connecter </ta-button>\n    }\n  </div>\n  }\n</div>\n", styles: [":host{display:block}.guard-content--preview{position:relative;overflow:hidden;min-height:200px}.guard-content--preview .guard-projected{opacity:.25;pointer-events:none;-webkit-user-select:none;user-select:none}.guard-overlay{position:absolute;inset:0;background:linear-gradient(to bottom,transparent 0%,var(--ta-surface-secondary) 80%);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:var(--ta-space-xl)}.guard-overlay-cta{display:flex;flex-direction:column;align-items:center;gap:var(--ta-space-md);text-align:center;max-width:440px}.guard-overlay-title{font-size:var(--ta-font-h3-default-size);font-weight:var(--ta-font-h3-default-weight);color:var(--ta-text-primary);margin:0}.guard-overlay-subtitle{font-size:var(--ta-font-body-md-default-size);font-weight:var(--ta-font-body-md-default-weight);color:var(--ta-text-secondary);margin:0}.guard-no-valid{display:flex;flex-direction:column;align-items:center;gap:var(--ta-space-md);padding:var(--ta-space-xl);color:var(--ta-text-secondary)}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: ButtonComponent, selector: "ta-button", inputs: ["state", "type", "size", "icon", "options", "stopPropagationActivation"], outputs: ["action"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: GuardComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-guard', standalone: true, imports: [AsyncPipe, FontIconComponent, ButtonComponent, TranslatePipe], template: "@let isValid = this.isGuardValid$() | async;\n\n<div class=\"guard\">\n  @if (isValid || this.preview()) {\n  <div class=\"guard-content\" [class.guard-content--preview]=\"!isValid && this.preview()\">\n    <div class=\"guard-projected\">\n      <ng-content></ng-content>\n    </div>\n\n    @if (!isValid && this.preview()) {\n    <div class=\"guard-overlay\">\n      <div class=\"guard-overlay-cta\">\n        <p class=\"guard-overlay-title\">{{ \"user.guard.preview.title\" | translate }}</p>\n        <p class=\"guard-overlay-subtitle\">{{ \"user.guard.preview.subtitle\" | translate }}</p>\n        <div class=\"flex-row g-space-sm\">\n          <ta-button [type]=\"'secondary'\" (action)=\"this.goToRegister()\">\n            {{ \"user.register\" | translate }}\n          </ta-button>\n          <ta-button (action)=\"this.goToLogin()\">\n            {{ \"user.login\" | translate }}\n          </ta-button>\n        </div>\n      </div>\n    </div>\n    }\n  </div>\n  } @if (!isValid && !this.preview() && this.canDisplayErrorMessage()) {\n  <div class=\"guard-no-valid ta-c\">\n    <ta-font-icon name=\"close-tool\" size=\"md\"></ta-font-icon>\n    {{ \"user.guard.content\" | translate }}\n\n    @if (this.level() === 'authenticated') {\n    <ta-button (action)=\"this.goToLogin()\"> Me connecter </ta-button>\n    }\n  </div>\n  }\n</div>\n", styles: [":host{display:block}.guard-content--preview{position:relative;overflow:hidden;min-height:200px}.guard-content--preview .guard-projected{opacity:.25;pointer-events:none;-webkit-user-select:none;user-select:none}.guard-overlay{position:absolute;inset:0;background:linear-gradient(to bottom,transparent 0%,var(--ta-surface-secondary) 80%);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:var(--ta-space-xl)}.guard-overlay-cta{display:flex;flex-direction:column;align-items:center;gap:var(--ta-space-md);text-align:center;max-width:440px}.guard-overlay-title{font-size:var(--ta-font-h3-default-size);font-weight:var(--ta-font-h3-default-weight);color:var(--ta-text-primary);margin:0}.guard-overlay-subtitle{font-size:var(--ta-font-body-md-default-size);font-weight:var(--ta-font-body-md-default-weight);color:var(--ta-text-secondary);margin:0}.guard-no-valid{display:flex;flex-direction:column;align-items:center;gap:var(--ta-space-md);padding:var(--ta-space-xl);color:var(--ta-text-secondary)}\n"] }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VhcmQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9tb2R1bGVzL3VzZXIvY29tcG9uZW50cy9ndWFyZC9ndWFyZC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL21vZHVsZXMvdXNlci9jb21wb25lbnRzL2d1YXJkL2d1YXJkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdkMsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDakQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRWhELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ3BFLE9BQU8sRUFBUyxvQkFBb0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDOztBQVNqRixNQUFNLE9BQU8sY0FBZSxTQUFRLG1CQUFtQjtJQWFyRCxJQUFJLFlBQVk7UUFDZCxPQUFPLFVBQVUsQ0FBQyxRQUFRLENBQUM7SUFDN0IsQ0FBQztJQUVEO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFqQlYsVUFBSyxHQUFHLEtBQUssRUFBUyxDQUFDO1FBRXZCLFlBQU8sR0FBRyxLQUFLLEVBQVUsQ0FBQztRQUUxQixTQUFJLEdBQUcsS0FBSyxFQUFVLENBQUM7UUFFdkIsMkJBQXNCLEdBQUcsS0FBSyxDQUFVLElBQUksQ0FBQyxDQUFDO1FBRTlDLDRFQUE0RTtRQUM1RSxZQUFPLEdBQUcsS0FBSyxDQUFVLEtBQUssQ0FBQyxDQUFDO1FBRWYsd0JBQW1CLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFPbEUsaUJBQWlCLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbEMsQ0FBQztJQUVNLGFBQWE7UUFDbEIsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQztZQUNoQixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRyxDQUFDLENBQUM7UUFDekQsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxXQUFXLENBQUMsQ0FBQztJQUNoRyxDQUFDO0lBRU0sU0FBUztRQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFFTSxZQUFZO1FBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7K0dBcENVLGNBQWM7bUdBQWQsY0FBYywydkJDcEIzQix5MENBcUNBLDZqQ0RuQlksU0FBUyw4Q0FBRSxpQkFBaUIsbUZBQUUsZUFBZSx5SkFBRSxhQUFhOzs0RkFFM0QsY0FBYztrQkFQMUIsU0FBUzsrQkFDRSxVQUFVLGNBR1IsSUFBSSxXQUNQLENBQUMsU0FBUyxFQUFFLGlCQUFpQixFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY1BpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBpbmplY3QsIGlucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IEZvbnRJY29uQ29tcG9uZW50IH0gZnJvbSAnQHRhL2ljb25zJztcbmltcG9ydCB7IFRhSWNvblR5cGUgfSBmcm9tICdAdGEvaWNvbnMnO1xuaW1wb3J0IHsgVGFNYWluUm91dGUsIFRhUm91dGVzIH0gZnJvbSAnQHRhL21lbnUnO1xuaW1wb3J0IHsgVHJhbnNsYXRlUGlwZSB9IGZyb20gJ0B0YS90cmFuc2xhdGlvbic7XG5pbXBvcnQgeyBCdXR0b25Db21wb25lbnQgfSBmcm9tICdAdGEvdWknO1xuaW1wb3J0IHsgVGFBYnN0cmFjdENvbXBvbmVudCB9IGZyb20gJ0B0YS91dGlscyc7XG5cbmltcG9ydCB7IFRhVHJhbnNsYXRpb25Vc2VyIH0gZnJvbSAnLi4vLi4vLi4vLi4vdHJhbnNsYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBMZXZlbCwgVGFQZXJtaXNzaW9uc1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wZXJtaXNzaW9ucy5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGEtZ3VhcmQnLFxuICB0ZW1wbGF0ZVVybDogJy4vZ3VhcmQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9ndWFyZC5jb21wb25lbnQuc2NzcyddLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbQXN5bmNQaXBlLCBGb250SWNvbkNvbXBvbmVudCwgQnV0dG9uQ29tcG9uZW50LCBUcmFuc2xhdGVQaXBlXSxcbn0pXG5leHBvcnQgY2xhc3MgR3VhcmRDb21wb25lbnQgZXh0ZW5kcyBUYUFic3RyYWN0Q29tcG9uZW50IHtcbiAgbGV2ZWwgPSBpbnB1dDxMZXZlbD4oKTtcblxuICBmZWF0dXJlID0gaW5wdXQ8c3RyaW5nPigpO1xuXG4gIHJvbGUgPSBpbnB1dDxzdHJpbmc+KCk7XG5cbiAgY2FuRGlzcGxheUVycm9yTWVzc2FnZSA9IGlucHV0PGJvb2xlYW4+KHRydWUpO1xuXG4gIC8qKiBBZmZpY2hlIGxlIGNvbnRlbnUgYXZlYyB1biBvdmVybGF5IGRlIGNvbm5leGlvbiBhdSBsaWV1IGRlIGxlIG1hc3F1ZXIgKi9cbiAgcHJldmlldyA9IGlucHV0PGJvb2xlYW4+KGZhbHNlKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9wZXJtaXNzaW9uc1NlcnZpY2UgPSBpbmplY3QoVGFQZXJtaXNzaW9uc1NlcnZpY2UpO1xuICBnZXQgbm9BY2Nlc3NJY29uKCkge1xuICAgIHJldHVybiBUYUljb25UeXBlLk5vQWNjZXNzO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICBUYVRyYW5zbGF0aW9uVXNlci5nZXRJbnN0YW5jZSgpO1xuICB9XG5cbiAgcHVibGljIGlzR3VhcmRWYWxpZCQoKSB7XG4gICAgaWYgKHRoaXMucm9sZSgpKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcGVybWlzc2lvbnNTZXJ2aWNlLmhhc1JvbGUkKHRoaXMucm9sZSgpISk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX3Blcm1pc3Npb25zU2VydmljZS5jYW5BY2Nlc3MkKHRoaXMuZmVhdHVyZSgpID8/ICcnLCB0aGlzLmxldmVsKCkgPz8gJ2F1dGhvcml6ZScpO1xuICB9XG5cbiAgcHVibGljIGdvVG9Mb2dpbigpIHtcbiAgICB0aGlzLl9yb3V0ZXIubmF2aWdhdGVCeVVybChUYVJvdXRlcy5nZXRVcmwoW1RhTWFpblJvdXRlLlVTRVJMT0dJTl0pKTtcbiAgfVxuXG4gIHB1YmxpYyBnb1RvUmVnaXN0ZXIoKSB7XG4gICAgdGhpcy5fcm91dGVyLm5hdmlnYXRlQnlVcmwoVGFSb3V0ZXMuZ2V0VXJsKFtUYU1haW5Sb3V0ZS5TSU5HSU5dKSk7XG4gIH1cbn1cbiIsIkBsZXQgaXNWYWxpZCA9IHRoaXMuaXNHdWFyZFZhbGlkJCgpIHwgYXN5bmM7XG5cbjxkaXYgY2xhc3M9XCJndWFyZFwiPlxuICBAaWYgKGlzVmFsaWQgfHwgdGhpcy5wcmV2aWV3KCkpIHtcbiAgPGRpdiBjbGFzcz1cImd1YXJkLWNvbnRlbnRcIiBbY2xhc3MuZ3VhcmQtY29udGVudC0tcHJldmlld109XCIhaXNWYWxpZCAmJiB0aGlzLnByZXZpZXcoKVwiPlxuICAgIDxkaXYgY2xhc3M9XCJndWFyZC1wcm9qZWN0ZWRcIj5cbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICA8L2Rpdj5cblxuICAgIEBpZiAoIWlzVmFsaWQgJiYgdGhpcy5wcmV2aWV3KCkpIHtcbiAgICA8ZGl2IGNsYXNzPVwiZ3VhcmQtb3ZlcmxheVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImd1YXJkLW92ZXJsYXktY3RhXCI+XG4gICAgICAgIDxwIGNsYXNzPVwiZ3VhcmQtb3ZlcmxheS10aXRsZVwiPnt7IFwidXNlci5ndWFyZC5wcmV2aWV3LnRpdGxlXCIgfCB0cmFuc2xhdGUgfX08L3A+XG4gICAgICAgIDxwIGNsYXNzPVwiZ3VhcmQtb3ZlcmxheS1zdWJ0aXRsZVwiPnt7IFwidXNlci5ndWFyZC5wcmV2aWV3LnN1YnRpdGxlXCIgfCB0cmFuc2xhdGUgfX08L3A+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4LXJvdyBnLXNwYWNlLXNtXCI+XG4gICAgICAgICAgPHRhLWJ1dHRvbiBbdHlwZV09XCInc2Vjb25kYXJ5J1wiIChhY3Rpb24pPVwidGhpcy5nb1RvUmVnaXN0ZXIoKVwiPlxuICAgICAgICAgICAge3sgXCJ1c2VyLnJlZ2lzdGVyXCIgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3RhLWJ1dHRvbj5cbiAgICAgICAgICA8dGEtYnV0dG9uIChhY3Rpb24pPVwidGhpcy5nb1RvTG9naW4oKVwiPlxuICAgICAgICAgICAge3sgXCJ1c2VyLmxvZ2luXCIgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3RhLWJ1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICB9XG4gIDwvZGl2PlxuICB9IEBpZiAoIWlzVmFsaWQgJiYgIXRoaXMucHJldmlldygpICYmIHRoaXMuY2FuRGlzcGxheUVycm9yTWVzc2FnZSgpKSB7XG4gIDxkaXYgY2xhc3M9XCJndWFyZC1uby12YWxpZCB0YS1jXCI+XG4gICAgPHRhLWZvbnQtaWNvbiBuYW1lPVwiY2xvc2UtdG9vbFwiIHNpemU9XCJtZFwiPjwvdGEtZm9udC1pY29uPlxuICAgIHt7IFwidXNlci5ndWFyZC5jb250ZW50XCIgfCB0cmFuc2xhdGUgfX1cblxuICAgIEBpZiAodGhpcy5sZXZlbCgpID09PSAnYXV0aGVudGljYXRlZCcpIHtcbiAgICA8dGEtYnV0dG9uIChhY3Rpb24pPVwidGhpcy5nb1RvTG9naW4oKVwiPiBNZSBjb25uZWN0ZXIgPC90YS1idXR0b24+XG4gICAgfVxuICA8L2Rpdj5cbiAgfVxuPC9kaXY+XG4iXX0=