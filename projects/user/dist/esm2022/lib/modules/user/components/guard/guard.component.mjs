import { AsyncPipe } from "@angular/common";
import { Component, inject, input } from "@angular/core";
import { FontIconComponent } from "@ta/icons";
import { TaIconType } from "@ta/icons";
import { TaMainRoute, TaRoutes } from "@ta/menu";
import { TranslatePipe } from "@ta/translation";
import { ButtonComponent } from "@ta/ui";
import { TaAbstractComponent } from "@ta/utils";
import { TaPermissionsService, } from "../../services/permissions.service";
import * as i0 from "@angular/core";
export class GuardComponent extends TaAbstractComponent {
    get noAccessIcon() {
        return TaIconType.NoAccess;
    }
    constructor() {
        super();
        this.level = input();
        this.feature = input();
        this.role = input();
        this.canDisplayErrorMessage = input(true);
        this._permissionsService = inject(TaPermissionsService);
    }
    isGuardValid$() {
        if (this.role()) {
            return this._permissionsService.hasRole$(this.role());
        }
        return this._permissionsService.canAccess$(this.feature() ?? "", this.level() ?? "authorize");
    }
    goToLogin() {
        this._router.navigateByUrl(TaRoutes.getUrl([TaMainRoute.USERLOGIN]));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: GuardComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: GuardComponent, isStandalone: true, selector: "ta-guard", inputs: { level: { classPropertyName: "level", publicName: "level", isSignal: true, isRequired: false, transformFunction: null }, feature: { classPropertyName: "feature", publicName: "feature", isSignal: true, isRequired: false, transformFunction: null }, role: { classPropertyName: "role", publicName: "role", isSignal: true, isRequired: false, transformFunction: null }, canDisplayErrorMessage: { classPropertyName: "canDisplayErrorMessage", publicName: "canDisplayErrorMessage", isSignal: true, isRequired: false, transformFunction: null } }, usesInheritance: true, ngImport: i0, template: "@let isValid = this.isGuardValid$() | async;\n\n<div class=\"guard\">\n  @if (isValid) {\n  <div class=\"guard-valid\">\n    <ng-content></ng-content>\n  </div>\n  } @if (!isValid && this.canDisplayErrorMessage()) {\n  <div class=\"guard-no-valid ta-c\">\n    <ta-font-icon name=\"close-tool\" size=\"md\"></ta-font-icon>\n    {{ \"user.guard.content\" | translate }}\n\n    @if (this.level() === 'authenticated') {\n    <ta-button (action)=\"this.goToLogin()\"> Me connecter </ta-button>\n    }\n  </div>\n  }\n</div>\n", styles: [""], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: ButtonComponent, selector: "ta-button", inputs: ["state", "type", "size", "icon", "options", "stopPropagationActivation"], outputs: ["action"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: GuardComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-guard", standalone: true, imports: [AsyncPipe, FontIconComponent, ButtonComponent, TranslatePipe], template: "@let isValid = this.isGuardValid$() | async;\n\n<div class=\"guard\">\n  @if (isValid) {\n  <div class=\"guard-valid\">\n    <ng-content></ng-content>\n  </div>\n  } @if (!isValid && this.canDisplayErrorMessage()) {\n  <div class=\"guard-no-valid ta-c\">\n    <ta-font-icon name=\"close-tool\" size=\"md\"></ta-font-icon>\n    {{ \"user.guard.content\" | translate }}\n\n    @if (this.level() === 'authenticated') {\n    <ta-button (action)=\"this.goToLogin()\"> Me connecter </ta-button>\n    }\n  </div>\n  }\n</div>\n" }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VhcmQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9tb2R1bGVzL3VzZXIvY29tcG9uZW50cy9ndWFyZC9ndWFyZC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL21vZHVsZXMvdXNlci9jb21wb25lbnRzL2d1YXJkL2d1YXJkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdkMsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDakQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRWhELE9BQU8sRUFFTCxvQkFBb0IsR0FDckIsTUFBTSxvQ0FBb0MsQ0FBQzs7QUFTNUMsTUFBTSxPQUFPLGNBQWUsU0FBUSxtQkFBbUI7SUFVckQsSUFBSSxZQUFZO1FBQ2QsT0FBTyxVQUFVLENBQUMsUUFBUSxDQUFDO0lBQzdCLENBQUM7SUFFRDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBZFYsVUFBSyxHQUFHLEtBQUssRUFBUyxDQUFDO1FBRXZCLFlBQU8sR0FBRyxLQUFLLEVBQVUsQ0FBQztRQUUxQixTQUFJLEdBQUcsS0FBSyxFQUFVLENBQUM7UUFFdkIsMkJBQXNCLEdBQUcsS0FBSyxDQUFVLElBQUksQ0FBQyxDQUFDO1FBRTdCLHdCQUFtQixHQUFHLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBT3BFLENBQUM7SUFFTSxhQUFhO1FBQ2xCLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7WUFDaEIsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUcsQ0FBQyxDQUFDO1FBQ3pELENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQ3hDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEVBQ3BCLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxXQUFXLENBQzVCLENBQUM7SUFDSixDQUFDO0lBRU0sU0FBUztRQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7K0dBL0JVLGNBQWM7bUdBQWQsY0FBYyw2bkJDdEIzQiwwZ0JBa0JBLHFEREVZLFNBQVMsOENBQUUsaUJBQWlCLG1GQUFFLGVBQWUseUpBQUUsYUFBYTs7NEZBRTNELGNBQWM7a0JBUDFCLFNBQVM7K0JBQ0UsVUFBVSxjQUdSLElBQUksV0FDUCxDQUFDLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsYUFBYSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXN5bmNQaXBlIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBpbmplY3QsIGlucHV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcblxuaW1wb3J0IHsgRm9udEljb25Db21wb25lbnQgfSBmcm9tIFwiQHRhL2ljb25zXCI7XG5pbXBvcnQgeyBUYUljb25UeXBlIH0gZnJvbSBcIkB0YS9pY29uc1wiO1xuaW1wb3J0IHsgVGFNYWluUm91dGUsIFRhUm91dGVzIH0gZnJvbSBcIkB0YS9tZW51XCI7XG5pbXBvcnQgeyBUcmFuc2xhdGVQaXBlIH0gZnJvbSBcIkB0YS90cmFuc2xhdGlvblwiO1xuaW1wb3J0IHsgQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIkB0YS91aVwiO1xuaW1wb3J0IHsgVGFBYnN0cmFjdENvbXBvbmVudCB9IGZyb20gXCJAdGEvdXRpbHNcIjtcblxuaW1wb3J0IHtcbiAgTGV2ZWwsXG4gIFRhUGVybWlzc2lvbnNTZXJ2aWNlLFxufSBmcm9tIFwiLi4vLi4vc2VydmljZXMvcGVybWlzc2lvbnMuc2VydmljZVwiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwidGEtZ3VhcmRcIixcbiAgdGVtcGxhdGVVcmw6IFwiLi9ndWFyZC5jb21wb25lbnQuaHRtbFwiLFxuICBzdHlsZVVybHM6IFtcIi4vZ3VhcmQuY29tcG9uZW50LnNjc3NcIl0sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtBc3luY1BpcGUsIEZvbnRJY29uQ29tcG9uZW50LCBCdXR0b25Db21wb25lbnQsIFRyYW5zbGF0ZVBpcGVdLFxufSlcbmV4cG9ydCBjbGFzcyBHdWFyZENvbXBvbmVudCBleHRlbmRzIFRhQWJzdHJhY3RDb21wb25lbnQge1xuICBsZXZlbCA9IGlucHV0PExldmVsPigpO1xuXG4gIGZlYXR1cmUgPSBpbnB1dDxzdHJpbmc+KCk7XG5cbiAgcm9sZSA9IGlucHV0PHN0cmluZz4oKTtcblxuICBjYW5EaXNwbGF5RXJyb3JNZXNzYWdlID0gaW5wdXQ8Ym9vbGVhbj4odHJ1ZSk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfcGVybWlzc2lvbnNTZXJ2aWNlID0gaW5qZWN0KFRhUGVybWlzc2lvbnNTZXJ2aWNlKTtcbiAgZ2V0IG5vQWNjZXNzSWNvbigpIHtcbiAgICByZXR1cm4gVGFJY29uVHlwZS5Ob0FjY2VzcztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBwdWJsaWMgaXNHdWFyZFZhbGlkJCgpIHtcbiAgICBpZiAodGhpcy5yb2xlKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wZXJtaXNzaW9uc1NlcnZpY2UuaGFzUm9sZSQodGhpcy5yb2xlKCkhKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fcGVybWlzc2lvbnNTZXJ2aWNlLmNhbkFjY2VzcyQoXG4gICAgICB0aGlzLmZlYXR1cmUoKSA/PyBcIlwiLFxuICAgICAgdGhpcy5sZXZlbCgpID8/IFwiYXV0aG9yaXplXCJcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGdvVG9Mb2dpbigpIHtcbiAgICB0aGlzLl9yb3V0ZXIubmF2aWdhdGVCeVVybChUYVJvdXRlcy5nZXRVcmwoW1RhTWFpblJvdXRlLlVTRVJMT0dJTl0pKTtcbiAgfVxufVxuIiwiQGxldCBpc1ZhbGlkID0gdGhpcy5pc0d1YXJkVmFsaWQkKCkgfCBhc3luYztcblxuPGRpdiBjbGFzcz1cImd1YXJkXCI+XG4gIEBpZiAoaXNWYWxpZCkge1xuICA8ZGl2IGNsYXNzPVwiZ3VhcmQtdmFsaWRcIj5cbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIDwvZGl2PlxuICB9IEBpZiAoIWlzVmFsaWQgJiYgdGhpcy5jYW5EaXNwbGF5RXJyb3JNZXNzYWdlKCkpIHtcbiAgPGRpdiBjbGFzcz1cImd1YXJkLW5vLXZhbGlkIHRhLWNcIj5cbiAgICA8dGEtZm9udC1pY29uIG5hbWU9XCJjbG9zZS10b29sXCIgc2l6ZT1cIm1kXCI+PC90YS1mb250LWljb24+XG4gICAge3sgXCJ1c2VyLmd1YXJkLmNvbnRlbnRcIiB8IHRyYW5zbGF0ZSB9fVxuXG4gICAgQGlmICh0aGlzLmxldmVsKCkgPT09ICdhdXRoZW50aWNhdGVkJykge1xuICAgIDx0YS1idXR0b24gKGFjdGlvbik9XCJ0aGlzLmdvVG9Mb2dpbigpXCI+IE1lIGNvbm5lY3RlciA8L3RhLWJ1dHRvbj5cbiAgICB9XG4gIDwvZGl2PlxuICB9XG48L2Rpdj5cbiJdfQ==