import { AsyncPipe } from "@angular/common";
import { Component, EventEmitter, Output, inject, input, signal, } from "@angular/core";
import { map } from "rxjs";
import { FontIconComponent } from "@ta/icons";
import { Menu, MenuComponent, MenuIcon } from "@ta/menu";
import { TranslatePipe } from "@ta/translation";
import { ButtonComponent, EmptyComponent, ErrorComponent, LoaderComponent, } from "@ta/ui";
import { InlineProfileDataComponent } from "@ta/ui";
import { StopPropagationDirective } from "@ta/utils";
import { TaBaseComponent } from "@ta/utils";
import { TA_AUTH_TOKEN } from "../../services/auth.service";
import { TA_USER_SERVICE } from "../../services/user.service";
import * as i0 from "@angular/core";
export class MyAccountComponent extends TaBaseComponent {
    constructor() {
        super();
        this.profileMenu = input(null);
        this.appVersion = input(null);
        this.isEditable = input(false);
        this.navigateEvent = new EventEmitter();
        this.navigateEditEvent = new EventEmitter();
        this._userService = inject(TA_USER_SERVICE);
        this._authService = inject(TA_AUTH_TOKEN);
        this.disconnectionMenu = signal(null);
        this.userLogo$ = signal(this._userService.userProfile.get$().pipe(map((up) => {
            if (!up) {
                return null;
            }
            return {
                user: {
                    picture: up.picture,
                    lastname: up.lastname ?? "",
                    firstname: up.firstname ?? "",
                },
                size: "lg",
            };
        })));
    }
    get profile$() {
        return this._userService.userProfile.get$().pipe(map((data) => {
            return {
                title: {
                    second: data?.firstname || data?.lastname,
                },
                email: data?.email || "",
            };
        }));
    }
    ngOnInit() {
        this.disconnectionMenu.set(this.getDisconnectionMenu());
    }
    navigateToProfile() {
        this.navigateEvent.emit();
    }
    disconnect() {
        this._authService.logout().then(() => location.reload());
    }
    getDisconnectionMenu() {
        const menu = [
            new MenuIcon({
                key: "logout",
                label: "user.logout",
                order: 4,
                style: "dark",
                icon: "logout",
                iconsColor: "icon-color-icon-tertiary",
                callback: () => this.disconnect(),
            }),
        ];
        return new Menu({
            elements: menu.sort((a, b) => a.order - b.order),
            direction: "vertical",
        });
    }
    navigateToEditProfile() {
        this.navigateEditEvent.emit();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: MyAccountComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: MyAccountComponent, isStandalone: true, selector: "ta-my-account", inputs: { profileMenu: { classPropertyName: "profileMenu", publicName: "profileMenu", isSignal: true, isRequired: false, transformFunction: null }, appVersion: { classPropertyName: "appVersion", publicName: "appVersion", isSignal: true, isRequired: false, transformFunction: null }, isEditable: { classPropertyName: "isEditable", publicName: "isEditable", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { navigateEvent: "navigateEvent", navigateEditEvent: "navigateEditEvent" }, usesInheritance: true, ngImport: i0, template: "@let profile = this.profile$ | async;\n<div class=\"mx-space-sm\" appStopPropagation>\n  <ta-loader [isLoading]=\"this.requestState.isLoading()\">\n    <ta-error\n      [message]=\"this.requestState.getErrorMessage()\"\n      [code]=\"this.requestState.getErrorStatus()\"\n    >\n      <ta-empty [isEmpty]=\"!profile\">\n        <div class=\"p-space-sm bdp-b color-border-primary\">\n          <ta-inline-profile-data\n            [profile]=\"profile ?? {}\"\n            [userLogo]=\"this.userLogo$() | async\"\n            (click)=\"this.navigateToProfile()\"\n          ></ta-inline-profile-data>\n          @if (this.isEditable()) {\n          <div class=\"my-space-md\">\n            <ta-button\n              (action)=\"this.navigateToEditProfile()\"\n              [style]=\"'secondary'\"\n            >\n              <div class=\"align-center button-content\">\n                <ta-font-icon\n                  name=\"modify\"\n                  class=\"mr-space-xs modify-icon\"\n                ></ta-font-icon>\n                <div class=\"text\">\n                  {{ \"user.modify\" | translate }}\n                </div>\n              </div>\n            </ta-button>\n          </div>\n          }\n        </div>\n      </ta-empty>\n    </ta-error>\n  </ta-loader>\n  @if (this.profileMenu()) {\n  <div class=\"bdp-b color-border-primary pt-space-xs\">\n    <ta-menu\n      [menu]=\"this.profileMenu()!\"\n      [style]=\"'dark'\"\n      [container]=\"'overflow'\"\n    ></ta-menu>\n  </div>\n  } @let disconnectionMenu = this.disconnectionMenu(); @if (disconnectionMenu) {\n  <div class=\"bdp-b pt-space-xs\">\n    <ta-menu [menu]=\"disconnectionMenu\" [style]=\"'dark'\" [container]=\"'overflow'\"></ta-menu>\n  </div>\n  }\n  <div class=\"ta-c\">\n    <small>{{ this.appVersion }}</small>\n  </div>\n</div>\n", styles: [".modify-icon{color:var(--ta-brand-700)}.language-panel{min-width:240px}.text{font-size:var(--ta-font-body-md-default-size);font-weight:var(--ta-font-body-md-default-weight)}.button-content{justify-content:center}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "directive", type: StopPropagationDirective, selector: "[appStopPropagation]", inputs: ["stopPropagationActivation"] }, { kind: "component", type: LoaderComponent, selector: "ta-loader", inputs: ["isLoading", "skeleton", "size", "text"] }, { kind: "component", type: ErrorComponent, selector: "ta-error", inputs: ["message", "code"] }, { kind: "component", type: EmptyComponent, selector: "ta-empty", inputs: ["isEmpty", "isLight", "showMessage", "text", "type", "icon", "iconSize"] }, { kind: "component", type: ButtonComponent, selector: "ta-button", inputs: ["state", "type", "size", "icon", "options", "stopPropagationActivation"], outputs: ["action"] }, { kind: "component", type: MenuComponent, selector: "ta-menu", inputs: ["menu", "container"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }, { kind: "component", type: InlineProfileDataComponent, selector: "ta-inline-profile-data", inputs: ["profile", "userLogo"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: MyAccountComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-my-account", standalone: true, imports: [
                        AsyncPipe,
                        FontIconComponent,
                        StopPropagationDirective,
                        LoaderComponent,
                        ErrorComponent,
                        EmptyComponent,
                        ButtonComponent,
                        MenuComponent,
                        TranslatePipe,
                        InlineProfileDataComponent,
                        StopPropagationDirective,
                    ], template: "@let profile = this.profile$ | async;\n<div class=\"mx-space-sm\" appStopPropagation>\n  <ta-loader [isLoading]=\"this.requestState.isLoading()\">\n    <ta-error\n      [message]=\"this.requestState.getErrorMessage()\"\n      [code]=\"this.requestState.getErrorStatus()\"\n    >\n      <ta-empty [isEmpty]=\"!profile\">\n        <div class=\"p-space-sm bdp-b color-border-primary\">\n          <ta-inline-profile-data\n            [profile]=\"profile ?? {}\"\n            [userLogo]=\"this.userLogo$() | async\"\n            (click)=\"this.navigateToProfile()\"\n          ></ta-inline-profile-data>\n          @if (this.isEditable()) {\n          <div class=\"my-space-md\">\n            <ta-button\n              (action)=\"this.navigateToEditProfile()\"\n              [style]=\"'secondary'\"\n            >\n              <div class=\"align-center button-content\">\n                <ta-font-icon\n                  name=\"modify\"\n                  class=\"mr-space-xs modify-icon\"\n                ></ta-font-icon>\n                <div class=\"text\">\n                  {{ \"user.modify\" | translate }}\n                </div>\n              </div>\n            </ta-button>\n          </div>\n          }\n        </div>\n      </ta-empty>\n    </ta-error>\n  </ta-loader>\n  @if (this.profileMenu()) {\n  <div class=\"bdp-b color-border-primary pt-space-xs\">\n    <ta-menu\n      [menu]=\"this.profileMenu()!\"\n      [style]=\"'dark'\"\n      [container]=\"'overflow'\"\n    ></ta-menu>\n  </div>\n  } @let disconnectionMenu = this.disconnectionMenu(); @if (disconnectionMenu) {\n  <div class=\"bdp-b pt-space-xs\">\n    <ta-menu [menu]=\"disconnectionMenu\" [style]=\"'dark'\" [container]=\"'overflow'\"></ta-menu>\n  </div>\n  }\n  <div class=\"ta-c\">\n    <small>{{ this.appVersion }}</small>\n  </div>\n</div>\n", styles: [".modify-icon{color:var(--ta-brand-700)}.language-panel{min-width:240px}.text{font-size:var(--ta-font-body-md-default-size);font-weight:var(--ta-font-body-md-default-weight)}.button-content{justify-content:center}\n"] }]
        }], ctorParameters: () => [], propDecorators: { navigateEvent: [{
                type: Output
            }], navigateEditEvent: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktYWNjb3VudC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL21vZHVsZXMvdXNlci9jb21wb25lbnRzL215LWFjY291bnQvbXktYWNjb3VudC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL21vZHVsZXMvdXNlci9jb21wb25lbnRzL215LWFjY291bnQvbXktYWNjb3VudC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUNMLFNBQVMsRUFDVCxZQUFZLEVBRVosTUFBTSxFQUNOLE1BQU0sRUFDTixLQUFLLEVBQ0wsTUFBTSxHQUNQLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBYyxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFdkMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUV6RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDaEQsT0FBTyxFQUNMLGVBQWUsRUFDZixjQUFjLEVBQ2QsY0FBYyxFQUNkLGVBQWUsR0FFaEIsTUFBTSxRQUFRLENBQUM7QUFDaEIsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ3BELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRTVDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7O0FBcUI5RCxNQUFNLE9B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LEVBQUUsQ0FBQztJQUNoQyxDQUFDOytHQTFGVSxrQkFBa0I7bUdBQWxCLGtCQUFrQix5bEJDbEQvQix5eURBcURBLDJRRGhCSSxTQUFTLDhDQUNULGlCQUFpQixtRkFDakIsd0JBQXdCLHdHQUN4QixlQUFlLHlHQUNmLGNBQWMsa0ZBQ2QsY0FBYyx3SUFDZCxlQUFlLDhKQUNmLGFBQWEsOEVBQ2IsYUFBYSxrREFDYiwwQkFBMEI7OzRGQUlqQixrQkFBa0I7a0JBbkI5QixTQUFTOytCQUNFLGVBQWUsY0FHYixJQUFJLFdBQ1A7d0JBQ1AsU0FBUzt3QkFDVCxpQkFBaUI7d0JBQ2pCLHdCQUF3Qjt3QkFDeEIsZUFBZTt3QkFDZixjQUFjO3dCQUNkLGNBQWM7d0JBQ2QsZUFBZTt3QkFDZixhQUFhO3dCQUNiLGFBQWE7d0JBQ2IsMEJBQTBCO3dCQUMxQix3QkFBd0I7cUJBQ3pCO3dEQVVELGFBQWE7c0JBRFosTUFBTTtnQkFJUCxpQkFBaUI7c0JBRGhCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY1BpcGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIGluamVjdCxcbiAgaW5wdXQsXG4gIHNpZ25hbCxcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgbWFwIH0gZnJvbSBcInJ4anNcIjtcblxuaW1wb3J0IHsgRm9udEljb25Db21wb25lbnQgfSBmcm9tIFwiQHRhL2ljb25zXCI7XG5pbXBvcnQgeyBNZW51LCBNZW51Q29tcG9uZW50LCBNZW51SWNvbiB9IGZyb20gXCJAdGEvbWVudVwiO1xuaW1wb3J0IHsgVGFTaXplcyB9IGZyb20gXCJAdGEvc3R5bGVzXCI7XG5pbXBvcnQgeyBUcmFuc2xhdGVQaXBlIH0gZnJvbSBcIkB0YS90cmFuc2xhdGlvblwiO1xuaW1wb3J0IHtcbiAgQnV0dG9uQ29tcG9uZW50LFxuICBFbXB0eUNvbXBvbmVudCxcbiAgRXJyb3JDb21wb25lbnQsXG4gIExvYWRlckNvbXBvbmVudCxcbiAgVXNlckxvZ29EYXRhLFxufSBmcm9tIFwiQHRhL3VpXCI7XG5pbXBvcnQgeyBJbmxpbmVQcm9maWxlRGF0YUNvbXBvbmVudCB9IGZyb20gXCJAdGEvdWlcIjtcbmltcG9ydCB7IFN0b3BQcm9wYWdhdGlvbkRpcmVjdGl2ZSB9IGZyb20gXCJAdGEvdXRpbHNcIjtcbmltcG9ydCB7IFRhQmFzZUNvbXBvbmVudCB9IGZyb20gXCJAdGEvdXRpbHNcIjtcblxuaW1wb3J0IHsgVEFfQVVUSF9UT0tFTiB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9hdXRoLnNlcnZpY2VcIjtcbmltcG9ydCB7IFRBX1VTRVJfU0VSVklDRSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy91c2VyLnNlcnZpY2VcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRhLW15LWFjY291bnRcIixcbiAgdGVtcGxhdGVVcmw6IFwiLi9teS1hY2NvdW50LmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9teS1hY2NvdW50LmNvbXBvbmVudC5zY3NzXCJdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQXN5bmNQaXBlLFxuICAgIEZvbnRJY29uQ29tcG9uZW50LFxuICAgIFN0b3BQcm9wYWdhdGlvbkRpcmVjdGl2ZSxcbiAgICBMb2FkZXJDb21wb25lbnQsXG4gICAgRXJyb3JDb21wb25lbnQsXG4gICAgRW1wdHlDb21wb25lbnQsXG4gICAgQnV0dG9uQ29tcG9uZW50LFxuICAgIE1lbnVDb21wb25lbnQsXG4gICAgVHJhbnNsYXRlUGlwZSxcbiAgICBJbmxpbmVQcm9maWxlRGF0YUNvbXBvbmVudCxcbiAgICBTdG9wUHJvcGFnYXRpb25EaXJlY3RpdmUsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIE15QWNjb3VudENvbXBvbmVudCBleHRlbmRzIFRhQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByb2ZpbGVNZW51ID0gaW5wdXQ8TWVudSB8IG51bGw+KG51bGwpO1xuXG4gIGFwcFZlcnNpb24gPSBpbnB1dDxzdHJpbmcgfCBudWxsPihudWxsKTtcblxuICBpc0VkaXRhYmxlID0gaW5wdXQ8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIEBPdXRwdXQoKVxuICBuYXZpZ2F0ZUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBPdXRwdXQoKVxuICBuYXZpZ2F0ZUVkaXRFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwcml2YXRlIF91c2VyU2VydmljZSA9IGluamVjdChUQV9VU0VSX1NFUlZJQ0UpO1xuICBwcml2YXRlIF9hdXRoU2VydmljZSA9IGluamVjdChUQV9BVVRIX1RPS0VOKTtcblxuICBwdWJsaWMgZGlzY29ubmVjdGlvbk1lbnUgPSBzaWduYWw8TWVudSB8IG51bGw+KG51bGwpO1xuICBwdWJsaWMgdXNlckxvZ28kID0gc2lnbmFsPFxuICAgIE9ic2VydmFibGU8e1xuICAgICAgdXNlcjogVXNlckxvZ29EYXRhO1xuICAgICAgc2l6ZT86IFRhU2l6ZXM7XG4gICAgfSB8IG51bGw+XG4gID4oXG4gICAgdGhpcy5fdXNlclNlcnZpY2UudXNlclByb2ZpbGUuZ2V0JCgpLnBpcGUoXG4gICAgICBtYXAoKHVwKSA9PiB7XG4gICAgICAgIGlmICghdXApIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgcGljdHVyZTogdXAucGljdHVyZSxcbiAgICAgICAgICAgIGxhc3RuYW1lOiB1cC5sYXN0bmFtZSA/PyBcIlwiLFxuICAgICAgICAgICAgZmlyc3RuYW1lOiB1cC5maXJzdG5hbWUgPz8gXCJcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNpemU6IFwibGdcIixcbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgKVxuICApO1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgZ2V0IHByb2ZpbGUkKCkge1xuICAgIHJldHVybiB0aGlzLl91c2VyU2VydmljZS51c2VyUHJvZmlsZS5nZXQkKCkucGlwZShcbiAgICAgIG1hcCgoZGF0YSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICBzZWNvbmQ6IGRhdGE/LmZpcnN0bmFtZSB8fCBkYXRhPy5sYXN0bmFtZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVtYWlsOiBkYXRhPy5lbWFpbCB8fCBcIlwiLFxuICAgICAgICB9O1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5kaXNjb25uZWN0aW9uTWVudS5zZXQodGhpcy5nZXREaXNjb25uZWN0aW9uTWVudSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBuYXZpZ2F0ZVRvUHJvZmlsZSgpIHtcbiAgICB0aGlzLm5hdmlnYXRlRXZlbnQuZW1pdCgpO1xuICB9XG5cbiAgcHVibGljIGRpc2Nvbm5lY3QoKSB7XG4gICAgdGhpcy5fYXV0aFNlcnZpY2UubG9nb3V0KCkudGhlbigoKSA9PiBsb2NhdGlvbi5yZWxvYWQoKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0RGlzY29ubmVjdGlvbk1lbnUoKSB7XG4gICAgY29uc3QgbWVudSA9IFtcbiAgICAgIG5ldyBNZW51SWNvbih7XG4gICAgICAgIGtleTogXCJsb2dvdXRcIixcbiAgICAgICAgbGFiZWw6IFwidXNlci5sb2dvdXRcIixcbiAgICAgICAgb3JkZXI6IDQsXG4gICAgICAgIHN0eWxlOiBcImRhcmtcIixcbiAgICAgICAgaWNvbjogXCJsb2dvdXRcIixcbiAgICAgICAgaWNvbnNDb2xvcjogXCJpY29uLWNvbG9yLWljb24tdGVydGlhcnlcIixcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHRoaXMuZGlzY29ubmVjdCgpLFxuICAgICAgfSksXG4gICAgXTtcblxuICAgIHJldHVybiBuZXcgTWVudSh7XG4gICAgICBlbGVtZW50czogbWVudS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlciksXG4gICAgICBkaXJlY3Rpb246IFwidmVydGljYWxcIixcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBuYXZpZ2F0ZVRvRWRpdFByb2ZpbGUoKSB7XG4gICAgdGhpcy5uYXZpZ2F0ZUVkaXRFdmVudC5lbWl0KCk7XG4gIH1cbn1cbiIsIkBsZXQgcHJvZmlsZSA9IHRoaXMucHJvZmlsZSQgfCBhc3luYztcbjxkaXYgY2xhc3M9XCJteC1zcGFjZS1zbVwiIGFwcFN0b3BQcm9wYWdhdGlvbj5cbiAgPHRhLWxvYWRlciBbaXNMb2FkaW5nXT1cInRoaXMucmVxdWVzdFN0YXRlLmlzTG9hZGluZygpXCI+XG4gICAgPHRhLWVycm9yXG4gICAgICBbbWVzc2FnZV09XCJ0aGlzLnJlcXVlc3RTdGF0ZS5nZXRFcnJvck1lc3NhZ2UoKVwiXG4gICAgICBbY29kZV09XCJ0aGlzLnJlcXVlc3RTdGF0ZS5nZXRFcnJvclN0YXR1cygpXCJcbiAgICA+XG4gICAgICA8dGEtZW1wdHkgW2lzRW1wdHldPVwiIXByb2ZpbGVcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInAtc3BhY2Utc20gYmRwLWIgY29sb3ItYm9yZGVyLXByaW1hcnlcIj5cbiAgICAgICAgICA8dGEtaW5saW5lLXByb2ZpbGUtZGF0YVxuICAgICAgICAgICAgW3Byb2ZpbGVdPVwicHJvZmlsZSA/PyB7fVwiXG4gICAgICAgICAgICBbdXNlckxvZ29dPVwidGhpcy51c2VyTG9nbyQoKSB8IGFzeW5jXCJcbiAgICAgICAgICAgIChjbGljayk9XCJ0aGlzLm5hdmlnYXRlVG9Qcm9maWxlKClcIlxuICAgICAgICAgID48L3RhLWlubGluZS1wcm9maWxlLWRhdGE+XG4gICAgICAgICAgQGlmICh0aGlzLmlzRWRpdGFibGUoKSkge1xuICAgICAgICAgIDxkaXYgY2xhc3M9XCJteS1zcGFjZS1tZFwiPlxuICAgICAgICAgICAgPHRhLWJ1dHRvblxuICAgICAgICAgICAgICAoYWN0aW9uKT1cInRoaXMubmF2aWdhdGVUb0VkaXRQcm9maWxlKClcIlxuICAgICAgICAgICAgICBbc3R5bGVdPVwiJ3NlY29uZGFyeSdcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWxpZ24tY2VudGVyIGJ1dHRvbi1jb250ZW50XCI+XG4gICAgICAgICAgICAgICAgPHRhLWZvbnQtaWNvblxuICAgICAgICAgICAgICAgICAgbmFtZT1cIm1vZGlmeVwiXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cIm1yLXNwYWNlLXhzIG1vZGlmeS1pY29uXCJcbiAgICAgICAgICAgICAgICA+PC90YS1mb250LWljb24+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHRcIj5cbiAgICAgICAgICAgICAgICAgIHt7IFwidXNlci5tb2RpZnlcIiB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvdGEtYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L3RhLWVtcHR5PlxuICAgIDwvdGEtZXJyb3I+XG4gIDwvdGEtbG9hZGVyPlxuICBAaWYgKHRoaXMucHJvZmlsZU1lbnUoKSkge1xuICA8ZGl2IGNsYXNzPVwiYmRwLWIgY29sb3ItYm9yZGVyLXByaW1hcnkgcHQtc3BhY2UteHNcIj5cbiAgICA8dGEtbWVudVxuICAgICAgW21lbnVdPVwidGhpcy5wcm9maWxlTWVudSgpIVwiXG4gICAgICBbc3R5bGVdPVwiJ2RhcmsnXCJcbiAgICAgIFtjb250YWluZXJdPVwiJ292ZXJmbG93J1wiXG4gICAgPjwvdGEtbWVudT5cbiAgPC9kaXY+XG4gIH0gQGxldCBkaXNjb25uZWN0aW9uTWVudSA9IHRoaXMuZGlzY29ubmVjdGlvbk1lbnUoKTsgQGlmIChkaXNjb25uZWN0aW9uTWVudSkge1xuICA8ZGl2IGNsYXNzPVwiYmRwLWIgcHQtc3BhY2UteHNcIj5cbiAgICA8dGEtbWVudSBbbWVudV09XCJkaXNjb25uZWN0aW9uTWVudVwiIFtzdHlsZV09XCInZGFyaydcIiBbY29udGFpbmVyXT1cIidvdmVyZmxvdydcIj48L3RhLW1lbnU+XG4gIDwvZGl2PlxuICB9XG4gIDxkaXYgY2xhc3M9XCJ0YS1jXCI+XG4gICAgPHNtYWxsPnt7IHRoaXMuYXBwVmVyc2lvbiB9fTwvc21hbGw+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=