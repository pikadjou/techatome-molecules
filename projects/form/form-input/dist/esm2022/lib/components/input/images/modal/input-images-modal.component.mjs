import { AsyncPipe, NgIf } from '@angular/common';
import { Component, Inject } from '@angular/core';
import { MAT_DIALOG_DATA } from '@angular/material/dialog';
import { map } from 'rxjs';
import { FileListComponent } from '@ta/files-basic';
import { DualButtonComponent } from '@ta/ui';
import { TaBaseModal, TemporaryFile, pickImages } from '@ta/utils';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
// eslint-disable-next-line @angular-eslint/component-class-suffix
export class InputImageModal extends TaBaseModal {
    constructor(dialogRef, data) {
        super();
        this.dialogRef = dialogRef;
        this.data = data;
        this.selection = [];
        this.tempFiles = new TemporaryFile();
        this.uploadPics = async () => {
            const pics = await pickImages();
            if (this.data.input.update) {
                this.tempFiles.addFiles(pics);
                this.data.input.update(pics);
            }
        };
        this.selected = () => {
            this.dialogRef.close(this.selection);
        };
        this.dialogRef.addPanelClass(['full-screen-modal', 'forced']);
        this.selection = this.data.selection;
    }
    ngOnInit() {
        if (this.data.input.files$) {
            this._registerSubscription(this.data.input.files$.subscribe(() => this.tempFiles.removeAll()));
        }
    }
    getPics$() {
        return this.data.input.files$?.pipe(map(files => files.map(file => ({
            ...file,
            isSelected: this.selection.includes(file.url),
        }))));
    }
    onFileSelected(file) {
        if (this.selection.includes(file.url)) {
            this.selection = this.selection.filter(url => file.url !== url);
            return;
        }
        this.selection = [...this.selection, file.url];
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: InputImageModal, deps: [{ token: i1.MatDialogRef }, { token: MAT_DIALOG_DATA }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: InputImageModal, isStandalone: true, selector: "ng-component", usesInheritance: true, ngImport: i0, template: "<div class=\"input-image-container\">\n  @if (this.tempFiles.files.length > 0) {\n    <ta-files-list [files]=\"this.tempFiles.files\"></ta-files-list>\n    <hr />\n  }\n\n  <ta-files-list [files]=\"(this.getPics$() | async) || []\" (fileSelected)=\"this.onFileSelected($event)\">\n  </ta-files-list>\n\n  <div class=\"cta-container\">\n    <ta-dual-button\n      [isFull]=\"true\"\n      [first]=\"{\n        icon: 'add',\n        label: 'input.images.add',\n        callback: this.uploadPics,\n      }\"\n      [second]=\"{\n        icon: 'check-line',\n        label: 'input.images.pick',\n        callback: this.selected,\n      }\"\n    ></ta-dual-button>\n  </div>\n</div>\n", styles: [".input-image-container{padding-bottom:70px}.cta-container{position:fixed;bottom:env(safe-area-inset-bottom);right:0;left:0;margin:space(xs)}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "component", type: FileListComponent, selector: "ta-files-list", inputs: ["files", "canDeleteFile"], outputs: ["fileSelected", "moreInformationSelected", "fileDeleted"] }, { kind: "component", type: DualButtonComponent, selector: "ta-dual-button", inputs: ["isFull", "first", "second", "type"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: InputImageModal, decorators: [{
            type: Component,
            args: [{ selector: '', standalone: true, imports: [NgIf, AsyncPipe, FileListComponent, DualButtonComponent], template: "<div class=\"input-image-container\">\n  @if (this.tempFiles.files.length > 0) {\n    <ta-files-list [files]=\"this.tempFiles.files\"></ta-files-list>\n    <hr />\n  }\n\n  <ta-files-list [files]=\"(this.getPics$() | async) || []\" (fileSelected)=\"this.onFileSelected($event)\">\n  </ta-files-list>\n\n  <div class=\"cta-container\">\n    <ta-dual-button\n      [isFull]=\"true\"\n      [first]=\"{\n        icon: 'add',\n        label: 'input.images.add',\n        callback: this.uploadPics,\n      }\"\n      [second]=\"{\n        icon: 'check-line',\n        label: 'input.images.pick',\n        callback: this.selected,\n      }\"\n    ></ta-dual-button>\n  </div>\n</div>\n", styles: [".input-image-container{padding-bottom:70px}.cta-container{position:fixed;bottom:env(safe-area-inset-bottom);right:0;left:0;margin:space(xs)}\n"] }]
        }], ctorParameters: () => [{ type: i1.MatDialogRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MAT_DIALOG_DATA]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtaW1hZ2VzLW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9pbWFnZXMvbW9kYWwvaW5wdXQtaW1hZ2VzLW1vZGFsLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9pbWFnZXMvbW9kYWwvaW5wdXQtaW1hZ2VzLW1vZGFsLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDMUQsT0FBTyxFQUFFLGVBQWUsRUFBZ0IsTUFBTSwwQkFBMEIsQ0FBQztBQUV6RSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTNCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUM3QyxPQUFPLEVBQVksV0FBVyxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7OztBQVc3RSxrRUFBa0U7QUFDbEUsTUFBTSxPQUFPLGVBQWdCLFNBQVEsV0FBVztJQUs5QyxZQUNTLFNBQXdDLEVBQ2YsSUFBZ0I7UUFFaEQsS0FBSyxFQUFFLENBQUM7UUFIRCxjQUFTLEdBQVQsU0FBUyxDQUErQjtRQUNmLFNBQUksR0FBSixJQUFJLENBQVk7UUFOM0MsY0FBUyxHQUFhLEVBQUUsQ0FBQztRQUV6QixjQUFTLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQztRQW1DaEMsZUFBVSxHQUFHLEtBQUssSUFBSSxFQUFFO1lBQzdCLE1BQU0sSUFBSSxHQUFHLE1BQU0sVUFBVSxFQUFFLENBQUM7WUFDaEMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMvQixDQUFDO1FBQ0gsQ0FBQyxDQUFDO1FBQ0ssYUFBUSxHQUFHLEdBQUcsRUFBRTtZQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDO1FBcENBLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsbUJBQW1CLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqRyxDQUFDO0lBQ0gsQ0FBQztJQUVNLFFBQVE7UUFDYixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQ2pDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUNWLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2pCLEdBQUcsSUFBSTtZQUNQLFVBQVUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQzlDLENBQUMsQ0FBQyxDQUNKLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFDTSxjQUFjLENBQUMsSUFBYztRQUNsQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ2hFLE9BQU87UUFDVCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakQsQ0FBQzsrR0FyQ1UsZUFBZSw4Q0FPaEIsZUFBZTttR0FQZCxlQUFlLCtGQ3BCNUIseXFCQXlCQSxtTURSa0IsU0FBUyw4Q0FBRSxpQkFBaUIsbUtBQUUsbUJBQW1COzs0RkFHdEQsZUFBZTtrQkFSM0IsU0FBUzsrQkFDRSxFQUFFLGNBR0EsSUFBSSxXQUNQLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxtQkFBbUIsQ0FBQzs7MEJBVS9ELE1BQU07MkJBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jUGlwZSwgTmdJZiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBDb21wb25lbnQsIEluamVjdCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNQVRfRElBTE9HX0RBVEEsIE1hdERpYWxvZ1JlZiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5cbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBGaWxlTGlzdENvbXBvbmVudCB9IGZyb20gJ0B0YS9maWxlcy1iYXNpYyc7XG5pbXBvcnQgeyBEdWFsQnV0dG9uQ29tcG9uZW50IH0gZnJvbSAnQHRhL3VpJztcbmltcG9ydCB7IEZpbGVEYXRhLCBUYUJhc2VNb2RhbCwgVGVtcG9yYXJ5RmlsZSwgcGlja0ltYWdlcyB9IGZyb20gJ0B0YS91dGlscyc7XG5cbmltcG9ydCB7IERpYWxvZ0RhdGEgfSBmcm9tICcuLi9pbnB1dC1pbWFnZXMuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnJyxcbiAgc3R5bGVVcmxzOiBbJy4vaW5wdXQtaW1hZ2VzLW1vZGFsLmNvbXBvbmVudC5zY3NzJ10sXG4gIHRlbXBsYXRlVXJsOiAnLi9pbnB1dC1pbWFnZXMtbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbTmdJZiwgQXN5bmNQaXBlLCBGaWxlTGlzdENvbXBvbmVudCwgRHVhbEJ1dHRvbkNvbXBvbmVudF0sXG59KVxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9jb21wb25lbnQtY2xhc3Mtc3VmZml4XG5leHBvcnQgY2xhc3MgSW5wdXRJbWFnZU1vZGFsIGV4dGVuZHMgVGFCYXNlTW9kYWwgaW1wbGVtZW50cyBPbkluaXQge1xuICBwdWJsaWMgc2VsZWN0aW9uOiBzdHJpbmdbXSA9IFtdO1xuXG4gIHB1YmxpYyB0ZW1wRmlsZXMgPSBuZXcgVGVtcG9yYXJ5RmlsZSgpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBkaWFsb2dSZWY6IE1hdERpYWxvZ1JlZjxJbnB1dEltYWdlTW9kYWw+LFxuICAgIEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBwdWJsaWMgZGF0YTogRGlhbG9nRGF0YVxuICApIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5kaWFsb2dSZWYuYWRkUGFuZWxDbGFzcyhbJ2Z1bGwtc2NyZWVuLW1vZGFsJywgJ2ZvcmNlZCddKTtcbiAgICB0aGlzLnNlbGVjdGlvbiA9IHRoaXMuZGF0YS5zZWxlY3Rpb247XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy5kYXRhLmlucHV0LmZpbGVzJCkge1xuICAgICAgdGhpcy5fcmVnaXN0ZXJTdWJzY3JpcHRpb24odGhpcy5kYXRhLmlucHV0LmZpbGVzJC5zdWJzY3JpYmUoKCkgPT4gdGhpcy50ZW1wRmlsZXMucmVtb3ZlQWxsKCkpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0UGljcyQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5pbnB1dC5maWxlcyQ/LnBpcGUoXG4gICAgICBtYXAoZmlsZXMgPT5cbiAgICAgICAgZmlsZXMubWFwKGZpbGUgPT4gKHtcbiAgICAgICAgICAuLi5maWxlLFxuICAgICAgICAgIGlzU2VsZWN0ZWQ6IHRoaXMuc2VsZWN0aW9uLmluY2x1ZGVzKGZpbGUudXJsKSxcbiAgICAgICAgfSkpXG4gICAgICApXG4gICAgKTtcbiAgfVxuICBwdWJsaWMgb25GaWxlU2VsZWN0ZWQoZmlsZTogRmlsZURhdGEpIHtcbiAgICBpZiAodGhpcy5zZWxlY3Rpb24uaW5jbHVkZXMoZmlsZS51cmwpKSB7XG4gICAgICB0aGlzLnNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uLmZpbHRlcih1cmwgPT4gZmlsZS51cmwgIT09IHVybCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VsZWN0aW9uID0gWy4uLnRoaXMuc2VsZWN0aW9uLCBmaWxlLnVybF07XG4gIH1cbiAgcHVibGljIHVwbG9hZFBpY3MgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcGljcyA9IGF3YWl0IHBpY2tJbWFnZXMoKTtcbiAgICBpZiAodGhpcy5kYXRhLmlucHV0LnVwZGF0ZSkge1xuICAgICAgdGhpcy50ZW1wRmlsZXMuYWRkRmlsZXMocGljcyk7XG4gICAgICB0aGlzLmRhdGEuaW5wdXQudXBkYXRlKHBpY3MpO1xuICAgIH1cbiAgfTtcbiAgcHVibGljIHNlbGVjdGVkID0gKCkgPT4ge1xuICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKHRoaXMuc2VsZWN0aW9uKTtcbiAgfTtcbn1cbiIsIjxkaXYgY2xhc3M9XCJpbnB1dC1pbWFnZS1jb250YWluZXJcIj5cbiAgQGlmICh0aGlzLnRlbXBGaWxlcy5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgPHRhLWZpbGVzLWxpc3QgW2ZpbGVzXT1cInRoaXMudGVtcEZpbGVzLmZpbGVzXCI+PC90YS1maWxlcy1saXN0PlxuICAgIDxociAvPlxuICB9XG5cbiAgPHRhLWZpbGVzLWxpc3QgW2ZpbGVzXT1cIih0aGlzLmdldFBpY3MkKCkgfCBhc3luYykgfHwgW11cIiAoZmlsZVNlbGVjdGVkKT1cInRoaXMub25GaWxlU2VsZWN0ZWQoJGV2ZW50KVwiPlxuICA8L3RhLWZpbGVzLWxpc3Q+XG5cbiAgPGRpdiBjbGFzcz1cImN0YS1jb250YWluZXJcIj5cbiAgICA8dGEtZHVhbC1idXR0b25cbiAgICAgIFtpc0Z1bGxdPVwidHJ1ZVwiXG4gICAgICBbZmlyc3RdPVwie1xuICAgICAgICBpY29uOiAnYWRkJyxcbiAgICAgICAgbGFiZWw6ICdpbnB1dC5pbWFnZXMuYWRkJyxcbiAgICAgICAgY2FsbGJhY2s6IHRoaXMudXBsb2FkUGljcyxcbiAgICAgIH1cIlxuICAgICAgW3NlY29uZF09XCJ7XG4gICAgICAgIGljb246ICdjaGVjay1saW5lJyxcbiAgICAgICAgbGFiZWw6ICdpbnB1dC5pbWFnZXMucGljaycsXG4gICAgICAgIGNhbGxiYWNrOiB0aGlzLnNlbGVjdGVkLFxuICAgICAgfVwiXG4gICAgPjwvdGEtZHVhbC1idXR0b24+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=