import { Component, inject } from '@angular/core';
import { combineLatest } from 'rxjs';
import { TaDocumentsService } from '@ta/services';
import { ButtonComponent } from '@ta/ui';
import { isNonNullable, pickImages } from '@ta/utils';
import { TaAbstractInputComponent } from '../../abstract.component';
import { FormLabelComponent } from '../../label/label.component';
import * as i0 from "@angular/core";
export class InputImagesComponent extends TaAbstractInputComponent {
    constructor() {
        super();
        this._documentsService = inject(TaDocumentsService);
    }
    async openDialog() {
        const images = await pickImages();
        if (images.length > 0) {
            combineLatest(images
                .map((image) => image.file)
                .filter(isNonNullable)
                .map((file) => this._documentsService.addDocument$({ file: file }))).subscribe({
                next: (documents) => {
                    this.input.value = [...(this.input.value || []), ...documents];
                },
            });
        }
    }
    onFileDeleted(fileData) {
        if (!this.input.value) {
            return;
        }
        this.input.value = this.input.value.filter((doc) => doc.url !== fileData.url);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: InputImagesComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: InputImagesComponent, isStandalone: true, selector: "ta-input-images", usesInheritance: true, ngImport: i0, template: "<div class=\"row g-0 align-items-center mb-space-2\">\n  <div class=\"col\">\n    <ta-form-label [input]=\"this.input\"></ta-form-label>\n  </div>\n</div>\n\n<div class=\"flex-column g-space-xs\">\n  @if (this.input.value?.length ?? 0 > 0) {\n    <div class=\"grid g-space-md\">\n      @for(value of this.input.value; track value.id) {\n        <div class=\"image-preview-wrapper one-fourth\">\n          <img [src]=\"value.url\" class=\"image-preview\" />\n          <div class=\"image-remove\">\n            <ta-button\n              type=\"danger\"\n              (action)=\"this.onFileDeleted(value)\"\n              icon=\"delete\"\n            >\n            </ta-button>\n          </div>\n        </div>\n      }\n    </div>\n  }\n  <div class=\"flex-start\">\n      <ta-button\n        type=\"tertiary\"\n        (action)=\"this.openDialog()\"\n        icon=\"add_a_photo\"\n      >\n        Ajouter\n      </ta-button>\n  </div>\n</div>\n\n", styles: [".image-preview-wrapper{position:relative;background-color:var(--ta-surface-secondary)}.image-preview-wrapper img{border-radius:var(--ta-radius-rounded);aspect-ratio:3/4;overflow:hidden}.image-remove{padding:var(--ta-spacing-sm)}\n"], dependencies: [{ kind: "component", type: FormLabelComponent, selector: "ta-form-label", inputs: ["input", "withMarginBottom"] }, { kind: "component", type: ButtonComponent, selector: "ta-button", inputs: ["state", "type", "size", "icon", "options", "stopPropagationActivation"], outputs: ["action"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: InputImagesComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-input-images', standalone: true, imports: [FormLabelComponent, ButtonComponent], template: "<div class=\"row g-0 align-items-center mb-space-2\">\n  <div class=\"col\">\n    <ta-form-label [input]=\"this.input\"></ta-form-label>\n  </div>\n</div>\n\n<div class=\"flex-column g-space-xs\">\n  @if (this.input.value?.length ?? 0 > 0) {\n    <div class=\"grid g-space-md\">\n      @for(value of this.input.value; track value.id) {\n        <div class=\"image-preview-wrapper one-fourth\">\n          <img [src]=\"value.url\" class=\"image-preview\" />\n          <div class=\"image-remove\">\n            <ta-button\n              type=\"danger\"\n              (action)=\"this.onFileDeleted(value)\"\n              icon=\"delete\"\n            >\n            </ta-button>\n          </div>\n        </div>\n      }\n    </div>\n  }\n  <div class=\"flex-start\">\n      <ta-button\n        type=\"tertiary\"\n        (action)=\"this.openDialog()\"\n        icon=\"add_a_photo\"\n      >\n        Ajouter\n      </ta-button>\n  </div>\n</div>\n\n", styles: [".image-preview-wrapper{position:relative;background-color:var(--ta-surface-secondary)}.image-preview-wrapper img{border-radius:var(--ta-radius-rounded);aspect-ratio:3/4;overflow:hidden}.image-remove{padding:var(--ta-spacing-sm)}\n"] }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9pbWFnZXMvaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9pbWFnZXMvaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHckMsT0FBTyxFQUFlLGtCQUFrQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFdEQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7O0FBU2pFLE1BQU0sT0FBTyxvQkFBcUIsU0FBUSx3QkFBcUM7SUFHN0U7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUhGLHNCQUFpQixHQUFHLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBSXZELENBQUM7SUFFTSxLQUFLLENBQUMsVUFBVTtRQUNyQixNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsRUFBRSxDQUFDO1FBRWxDLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN0QixhQUFhLENBQ1gsTUFBTTtpQkFDSCxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7aUJBQzFCLE1BQU0sQ0FBQyxhQUFhLENBQUM7aUJBQ3JCLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQ3RFLENBQUMsU0FBUyxDQUFDO2dCQUNWLElBQUksRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFO29CQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDO2dCQUNqRSxDQUFDO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUM7SUFFTSxhQUFhLENBQUMsUUFBcUI7UUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDdEIsT0FBTztRQUNULENBQUM7UUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2hGLENBQUM7K0dBN0JVLG9CQUFvQjttR0FBcEIsb0JBQW9CLGtHQ25CakMsdzdCQW1DQSxnU0RsQlksa0JBQWtCLGlHQUFFLGVBQWU7OzRGQUVsQyxvQkFBb0I7a0JBUGhDLFNBQVM7K0JBQ0UsaUJBQWlCLGNBR2YsSUFBSSxXQUNQLENBQUMsa0JBQWtCLEVBQUUsZUFBZSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIGluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IElucHV0SW1hZ2VzIH0gZnJvbSAnQHRhL2Zvcm0tbW9kZWwnO1xuaW1wb3J0IHsgRG9jdW1lbnREdG8sIFRhRG9jdW1lbnRzU2VydmljZSB9IGZyb20gJ0B0YS9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBCdXR0b25Db21wb25lbnQgfSBmcm9tICdAdGEvdWknO1xuaW1wb3J0IHsgaXNOb25OdWxsYWJsZSwgcGlja0ltYWdlcyB9IGZyb20gJ0B0YS91dGlscyc7XG5cbmltcG9ydCB7IFRhQWJzdHJhY3RJbnB1dENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Fic3RyYWN0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBGb3JtTGFiZWxDb21wb25lbnQgfSBmcm9tICcuLi8uLi9sYWJlbC9sYWJlbC5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0YS1pbnB1dC1pbWFnZXMnLFxuICB0ZW1wbGF0ZVVybDogJy4vaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5zY3NzJ10sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtGb3JtTGFiZWxDb21wb25lbnQsIEJ1dHRvbkNvbXBvbmVudF0sXG59KVxuZXhwb3J0IGNsYXNzIElucHV0SW1hZ2VzQ29tcG9uZW50IGV4dGVuZHMgVGFBYnN0cmFjdElucHV0Q29tcG9uZW50PElucHV0SW1hZ2VzPiBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByaXZhdGUgX2RvY3VtZW50c1NlcnZpY2UgPSBpbmplY3QoVGFEb2N1bWVudHNTZXJ2aWNlKTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIG9wZW5EaWFsb2coKSB7XG4gICAgY29uc3QgaW1hZ2VzID0gYXdhaXQgcGlja0ltYWdlcygpO1xuXG4gICAgaWYgKGltYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb21iaW5lTGF0ZXN0KFxuICAgICAgICBpbWFnZXNcbiAgICAgICAgICAubWFwKChpbWFnZSkgPT4gaW1hZ2UuZmlsZSlcbiAgICAgICAgICAuZmlsdGVyKGlzTm9uTnVsbGFibGUpXG4gICAgICAgICAgLm1hcCgoZmlsZSkgPT4gdGhpcy5fZG9jdW1lbnRzU2VydmljZS5hZGREb2N1bWVudCQoeyBmaWxlOiBmaWxlIH0pKSxcbiAgICAgICkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKGRvY3VtZW50cykgPT4ge1xuICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBbLi4uKHRoaXMuaW5wdXQudmFsdWUgfHwgW10pLCAuLi5kb2N1bWVudHNdO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uRmlsZURlbGV0ZWQoZmlsZURhdGE6IERvY3VtZW50RHRvKSB7XG4gICAgaWYgKCF0aGlzLmlucHV0LnZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaW5wdXQudmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlLmZpbHRlcigoZG9jKSA9PiBkb2MudXJsICE9PSBmaWxlRGF0YS51cmwpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicm93IGctMCBhbGlnbi1pdGVtcy1jZW50ZXIgbWItc3BhY2UtMlwiPlxuICA8ZGl2IGNsYXNzPVwiY29sXCI+XG4gICAgPHRhLWZvcm0tbGFiZWwgW2lucHV0XT1cInRoaXMuaW5wdXRcIj48L3RhLWZvcm0tbGFiZWw+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgY2xhc3M9XCJmbGV4LWNvbHVtbiBnLXNwYWNlLXhzXCI+XG4gIEBpZiAodGhpcy5pbnB1dC52YWx1ZT8ubGVuZ3RoID8/IDAgPiAwKSB7XG4gICAgPGRpdiBjbGFzcz1cImdyaWQgZy1zcGFjZS1tZFwiPlxuICAgICAgQGZvcih2YWx1ZSBvZiB0aGlzLmlucHV0LnZhbHVlOyB0cmFjayB2YWx1ZS5pZCkge1xuICAgICAgICA8ZGl2IGNsYXNzPVwiaW1hZ2UtcHJldmlldy13cmFwcGVyIG9uZS1mb3VydGhcIj5cbiAgICAgICAgICA8aW1nIFtzcmNdPVwidmFsdWUudXJsXCIgY2xhc3M9XCJpbWFnZS1wcmV2aWV3XCIgLz5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaW1hZ2UtcmVtb3ZlXCI+XG4gICAgICAgICAgICA8dGEtYnV0dG9uXG4gICAgICAgICAgICAgIHR5cGU9XCJkYW5nZXJcIlxuICAgICAgICAgICAgICAoYWN0aW9uKT1cInRoaXMub25GaWxlRGVsZXRlZCh2YWx1ZSlcIlxuICAgICAgICAgICAgICBpY29uPVwiZGVsZXRlXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDwvdGEtYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgfVxuICA8ZGl2IGNsYXNzPVwiZmxleC1zdGFydFwiPlxuICAgICAgPHRhLWJ1dHRvblxuICAgICAgICB0eXBlPVwidGVydGlhcnlcIlxuICAgICAgICAoYWN0aW9uKT1cInRoaXMub3BlbkRpYWxvZygpXCJcbiAgICAgICAgaWNvbj1cImFkZF9hX3Bob3RvXCJcbiAgICAgID5cbiAgICAgICAgQWpvdXRlclxuICAgICAgPC90YS1idXR0b24+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbiJdfQ==