import { Component, inject } from "@angular/core";
import { combineLatest } from "rxjs";
import { TaDocumentsService } from "@ta/services";
import { ButtonComponent } from "@ta/ui";
import { isNonNullable, pickImages } from "@ta/utils";
import { TaAbstractInputComponent } from "../../abstract.component";
import { FormLabelComponent } from "../../label/label.component";
import * as i0 from "@angular/core";
export class InputImagesComponent extends TaAbstractInputComponent {
    constructor() {
        super();
        this._documentsService = inject(TaDocumentsService);
    }
    async openDialog() {
        const images = await pickImages();
        if (images.length > 0) {
            combineLatest(images
                .map((image) => image.file)
                .filter(isNonNullable)
                .map((file) => this._documentsService.addDocument$({ file: file }))).subscribe({
                next: (documents) => {
                    this.input.value = [...(this.input.value || []), ...documents];
                },
            });
        }
    }
    onFileDeleted(fileData) {
        if (!this.input.value) {
            return;
        }
        this.input.value = this.input.value.filter((doc) => doc.url !== fileData.url);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: InputImagesComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: InputImagesComponent, isStandalone: true, selector: "ta-input-images", usesInheritance: true, ngImport: i0, template: "<div class=\"row g-0 align-items-center mb-space-2\">\n  <div class=\"col\">\n    <ta-form-label [input]=\"this.input\"></ta-form-label>\n  </div>\n</div>\n\n<div class=\"flex-column g-space-xs\">\n  @if (this.input.value?.length ?? 0 > 0) {\n  <div class=\"grid g-space-md\">\n    @for(value of this.input.value; track value.id) {\n    <div class=\"image-preview-wrapper one-fourth\">\n      <img [src]=\"value.url\" class=\"image-preview\" />\n      <div class=\"image-remove\">\n        <ta-button\n          type=\"danger\"\n          (action)=\"this.onFileDeleted(value)\"\n          icon=\"delete\"\n        >\n        </ta-button>\n      </div>\n    </div>\n    }\n  </div>\n  }\n  <div class=\"flex-start\">\n    <ta-button type=\"tertiary\" (action)=\"this.openDialog()\" icon=\"add_a_photo\">\n      Ajouter\n    </ta-button>\n  </div>\n</div>\n", styles: [".image-preview-wrapper{position:relative;background-color:var(--ta-surface-secondary)}.image-preview-wrapper img{border-radius:var(--ta-radius-rounded);aspect-ratio:3/4;overflow:hidden}.image-remove{padding:var(--ta-spacing-sm)}\n"], dependencies: [{ kind: "component", type: FormLabelComponent, selector: "ta-form-label", inputs: ["input", "withMarginBottom"] }, { kind: "component", type: ButtonComponent, selector: "ta-button", inputs: ["state", "type", "size", "icon", "options", "stopPropagationActivation"], outputs: ["action"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: InputImagesComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-input-images", standalone: true, imports: [FormLabelComponent, ButtonComponent], template: "<div class=\"row g-0 align-items-center mb-space-2\">\n  <div class=\"col\">\n    <ta-form-label [input]=\"this.input\"></ta-form-label>\n  </div>\n</div>\n\n<div class=\"flex-column g-space-xs\">\n  @if (this.input.value?.length ?? 0 > 0) {\n  <div class=\"grid g-space-md\">\n    @for(value of this.input.value; track value.id) {\n    <div class=\"image-preview-wrapper one-fourth\">\n      <img [src]=\"value.url\" class=\"image-preview\" />\n      <div class=\"image-remove\">\n        <ta-button\n          type=\"danger\"\n          (action)=\"this.onFileDeleted(value)\"\n          icon=\"delete\"\n        >\n        </ta-button>\n      </div>\n    </div>\n    }\n  </div>\n  }\n  <div class=\"flex-start\">\n    <ta-button type=\"tertiary\" (action)=\"this.openDialog()\" icon=\"add_a_photo\">\n      Ajouter\n    </ta-button>\n  </div>\n</div>\n", styles: [".image-preview-wrapper{position:relative;background-color:var(--ta-surface-secondary)}.image-preview-wrapper img{border-radius:var(--ta-radius-rounded);aspect-ratio:3/4;overflow:hidden}.image-remove{padding:var(--ta-spacing-sm)}\n"] }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9pbWFnZXMvaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9pbWFnZXMvaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHckMsT0FBTyxFQUFlLGtCQUFrQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFdEQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDcEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7O0FBU2pFLE1BQU0sT0FBTyxvQkFDWCxTQUFRLHdCQUFxQztJQUs3QztRQUNFLEtBQUssRUFBRSxDQUFDO1FBSEYsc0JBQWlCLEdBQUcsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFJdkQsQ0FBQztJQUVNLEtBQUssQ0FBQyxVQUFVO1FBQ3JCLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxFQUFFLENBQUM7UUFFbEMsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3RCLGFBQWEsQ0FDWCxNQUFNO2lCQUNILEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztpQkFDMUIsTUFBTSxDQUFDLGFBQWEsQ0FBQztpQkFDckIsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FDdEUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1YsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLEVBQUU7b0JBQ2xCLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUM7Z0JBQ2pFLENBQUM7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQztJQUVNLGFBQWEsQ0FBQyxRQUFxQjtRQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN0QixPQUFPO1FBQ1QsQ0FBQztRQUNELElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FDeEMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssUUFBUSxDQUFDLEdBQUcsQ0FDbEMsQ0FBQztJQUNKLENBQUM7K0dBbENVLG9CQUFvQjttR0FBcEIsb0JBQW9CLGtHQ25CakMseTFCQThCQSxnU0RiWSxrQkFBa0IsaUdBQUUsZUFBZTs7NEZBRWxDLG9CQUFvQjtrQkFQaEMsU0FBUzsrQkFDRSxpQkFBaUIsY0FHZixJQUFJLFdBQ1AsQ0FBQyxrQkFBa0IsRUFBRSxlQUFlLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgaW5qZWN0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcblxuaW1wb3J0IHsgY29tYmluZUxhdGVzdCB9IGZyb20gXCJyeGpzXCI7XG5cbmltcG9ydCB7IElucHV0SW1hZ2VzIH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBEb2N1bWVudER0bywgVGFEb2N1bWVudHNTZXJ2aWNlIH0gZnJvbSBcIkB0YS9zZXJ2aWNlc1wiO1xuaW1wb3J0IHsgQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIkB0YS91aVwiO1xuaW1wb3J0IHsgaXNOb25OdWxsYWJsZSwgcGlja0ltYWdlcyB9IGZyb20gXCJAdGEvdXRpbHNcIjtcblxuaW1wb3J0IHsgVGFBYnN0cmFjdElucHV0Q29tcG9uZW50IH0gZnJvbSBcIi4uLy4uL2Fic3RyYWN0LmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgRm9ybUxhYmVsQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uL2xhYmVsL2xhYmVsLmNvbXBvbmVudFwiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwidGEtaW5wdXQtaW1hZ2VzXCIsXG4gIHRlbXBsYXRlVXJsOiBcIi4vaW5wdXQtaW1hZ2VzLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9pbnB1dC1pbWFnZXMuY29tcG9uZW50LnNjc3NcIl0sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtGb3JtTGFiZWxDb21wb25lbnQsIEJ1dHRvbkNvbXBvbmVudF0sXG59KVxuZXhwb3J0IGNsYXNzIElucHV0SW1hZ2VzQ29tcG9uZW50XG4gIGV4dGVuZHMgVGFBYnN0cmFjdElucHV0Q29tcG9uZW50PElucHV0SW1hZ2VzPlxuICBpbXBsZW1lbnRzIE9uSW5pdFxue1xuICBwcml2YXRlIF9kb2N1bWVudHNTZXJ2aWNlID0gaW5qZWN0KFRhRG9jdW1lbnRzU2VydmljZSk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBvcGVuRGlhbG9nKCkge1xuICAgIGNvbnN0IGltYWdlcyA9IGF3YWl0IHBpY2tJbWFnZXMoKTtcblxuICAgIGlmIChpbWFnZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29tYmluZUxhdGVzdChcbiAgICAgICAgaW1hZ2VzXG4gICAgICAgICAgLm1hcCgoaW1hZ2UpID0+IGltYWdlLmZpbGUpXG4gICAgICAgICAgLmZpbHRlcihpc05vbk51bGxhYmxlKVxuICAgICAgICAgIC5tYXAoKGZpbGUpID0+IHRoaXMuX2RvY3VtZW50c1NlcnZpY2UuYWRkRG9jdW1lbnQkKHsgZmlsZTogZmlsZSB9KSlcbiAgICAgICkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKGRvY3VtZW50cykgPT4ge1xuICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBbLi4uKHRoaXMuaW5wdXQudmFsdWUgfHwgW10pLCAuLi5kb2N1bWVudHNdO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uRmlsZURlbGV0ZWQoZmlsZURhdGE6IERvY3VtZW50RHRvKSB7XG4gICAgaWYgKCF0aGlzLmlucHV0LnZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaW5wdXQudmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlLmZpbHRlcihcbiAgICAgIChkb2MpID0+IGRvYy51cmwgIT09IGZpbGVEYXRhLnVybFxuICAgICk7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJyb3cgZy0wIGFsaWduLWl0ZW1zLWNlbnRlciBtYi1zcGFjZS0yXCI+XG4gIDxkaXYgY2xhc3M9XCJjb2xcIj5cbiAgICA8dGEtZm9ybS1sYWJlbCBbaW5wdXRdPVwidGhpcy5pbnB1dFwiPjwvdGEtZm9ybS1sYWJlbD5cbiAgPC9kaXY+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz1cImZsZXgtY29sdW1uIGctc3BhY2UteHNcIj5cbiAgQGlmICh0aGlzLmlucHV0LnZhbHVlPy5sZW5ndGggPz8gMCA+IDApIHtcbiAgPGRpdiBjbGFzcz1cImdyaWQgZy1zcGFjZS1tZFwiPlxuICAgIEBmb3IodmFsdWUgb2YgdGhpcy5pbnB1dC52YWx1ZTsgdHJhY2sgdmFsdWUuaWQpIHtcbiAgICA8ZGl2IGNsYXNzPVwiaW1hZ2UtcHJldmlldy13cmFwcGVyIG9uZS1mb3VydGhcIj5cbiAgICAgIDxpbWcgW3NyY109XCJ2YWx1ZS51cmxcIiBjbGFzcz1cImltYWdlLXByZXZpZXdcIiAvPlxuICAgICAgPGRpdiBjbGFzcz1cImltYWdlLXJlbW92ZVwiPlxuICAgICAgICA8dGEtYnV0dG9uXG4gICAgICAgICAgdHlwZT1cImRhbmdlclwiXG4gICAgICAgICAgKGFjdGlvbik9XCJ0aGlzLm9uRmlsZURlbGV0ZWQodmFsdWUpXCJcbiAgICAgICAgICBpY29uPVwiZGVsZXRlXCJcbiAgICAgICAgPlxuICAgICAgICA8L3RhLWJ1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIH1cbiAgPC9kaXY+XG4gIH1cbiAgPGRpdiBjbGFzcz1cImZsZXgtc3RhcnRcIj5cbiAgICA8dGEtYnV0dG9uIHR5cGU9XCJ0ZXJ0aWFyeVwiIChhY3Rpb24pPVwidGhpcy5vcGVuRGlhbG9nKClcIiBpY29uPVwiYWRkX2FfcGhvdG9cIj5cbiAgICAgIEFqb3V0ZXJcbiAgICA8L3RhLWJ1dHRvbj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==