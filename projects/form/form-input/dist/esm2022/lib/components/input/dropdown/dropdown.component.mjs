import { NgFor, NgIf } from '@angular/common';
import { Component, Input, ViewChild } from '@angular/core';
import { FontIconComponent } from '@ta/icons';
import { CamOverlayPanelComponent, LabelComponent } from '@ta/ui';
import { TranslatePipe } from '@ta/translation';
import { CamAbstractInputComponent } from '../../abstract.component';
import { InputLayoutComponent } from '../../input-layout/input-layout.component';
import * as i0 from "@angular/core";
export class DropdownComponent extends CamAbstractInputComponent {
    constructor() {
        super(...arguments);
        this.space = true;
        this.optionsList = [];
        this.filteredOptions = [];
    }
    ngOnInit() {
        super.ngOnInit();
        this._registerSubscription(this.input.options.subscribe(options => {
            this.optionsList = options;
            this.filteredOptions = this.optionsList;
        }));
    }
    getOptionName(id) {
        const found = this.optionsList.find(opt => opt.id === id);
        return found ? found.name : '';
    }
    onMenuSelect(selectedId) {
        if (this.input.multiple) {
            let currentValue = this.input.value || [];
            if (currentValue.includes(selectedId)) {
                currentValue = currentValue.filter((v) => v !== selectedId);
            }
            else {
                currentValue = [...currentValue, selectedId];
            }
            this.input.value = currentValue;
        }
        else {
            this.input.value = selectedId;
            this.overlayPanelRef.close();
        }
    }
    onOverlayClosed() {
        this.filteredOptions = this.optionsList;
    }
    isSelected(id) {
        const currentValue = this.input.value;
        return this.input.multiple ? Array.isArray(currentValue) && currentValue.includes(id) : currentValue === id;
    }
    selectOption(id, event) {
        this.onMenuSelect(id);
    }
    onSearchChange(event) {
        if (!this.input.withSearch)
            return;
        const target = event.target;
        const searchTerm = target.value.trim();
        this.filteredOptions =
            searchTerm.length >= 0
                ? this.optionsList.filter(opt => opt.name.toLowerCase().includes(searchTerm.toLowerCase()))
                : this.optionsList;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DropdownComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: DropdownComponent, isStandalone: true, selector: "ta-input-dropdown", inputs: { space: "space" }, viewQueries: [{ propertyName: "overlayPanelRef", first: true, predicate: CamOverlayPanelComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "@if (this.input) {\n  <ta-overlay-panel [panelConfig]=\"{ matchTriggerWidth: true }\" (closed)=\"this.onOverlayClosed()\">\n    <ng-template #panelTrigger>\n      <ta-input-layout [input]=\"this.input\">\n        <div #focusedElement class=\"custom-dropdown-button form-control\" [class.disabled]=\"this.input.disabled\">\n          <span class=\"selected-value align-center g-space-xs\">\n            @if (!this.input.multiple) {\n              @if (this.input.value) {\n                <span>\n                  {{ this.getOptionName(this.input.value) | translate }}\n                </span>\n              } @else {\n                {{ 'form.input.dropdown.novalue' | translate }}\n              }\n            } @else if (this.input.multiple) {\n              @for (value of this.input.value; track value) {\n                <ta-label size=\"sm\" class=\"d-flex\">\n                  {{ this.getOptionName(value) | translate }}\n                </ta-label>\n              }\n            }\n          </span>\n          <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n        </div>\n      </ta-input-layout>\n    </ng-template>\n\n    <ng-template #panelContent>\n      <div class=\"custom-menu\">\n        @if (this.input.withSearch) {\n          <input class=\"input-search\" type=\"search\" placeholder=\"Rechercher...\" (input)=\"this.onSearchChange($event)\" />\n        }\n\n        @for (opt of this.filteredOptions; track opt.id) {\n          <button\n            [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n            (click)=\"this.selectOption(opt.id, $event)\"\n            [class.selected]=\"this.isSelected(opt.id)\"\n            [class.disabled]=\"opt.disabled\"\n            class=\"dropdown-option space-between\"\n          >\n            {{ opt.name | translate }}\n            @if (this.isSelected(opt.id)) {\n              <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n            }\n          </button>\n        }\n      </div>\n    </ng-template>\n  </ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: CamOverlayPanelComponent, selector: "ta-overlay-panel", inputs: ["panelConfig"], outputs: ["closed"] }, { kind: "component", type: LabelComponent, selector: "ta-label", inputs: ["size", "type"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }, { kind: "component", type: InputLayoutComponent, selector: "ta-input-layout", inputs: ["input", "width", "height"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DropdownComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-input-dropdown', standalone: true, imports: [NgIf, NgFor, FontIconComponent, CamOverlayPanelComponent, LabelComponent, TranslatePipe, InputLayoutComponent], template: "@if (this.input) {\n  <ta-overlay-panel [panelConfig]=\"{ matchTriggerWidth: true }\" (closed)=\"this.onOverlayClosed()\">\n    <ng-template #panelTrigger>\n      <ta-input-layout [input]=\"this.input\">\n        <div #focusedElement class=\"custom-dropdown-button form-control\" [class.disabled]=\"this.input.disabled\">\n          <span class=\"selected-value align-center g-space-xs\">\n            @if (!this.input.multiple) {\n              @if (this.input.value) {\n                <span>\n                  {{ this.getOptionName(this.input.value) | translate }}\n                </span>\n              } @else {\n                {{ 'form.input.dropdown.novalue' | translate }}\n              }\n            } @else if (this.input.multiple) {\n              @for (value of this.input.value; track value) {\n                <ta-label size=\"sm\" class=\"d-flex\">\n                  {{ this.getOptionName(value) | translate }}\n                </ta-label>\n              }\n            }\n          </span>\n          <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n        </div>\n      </ta-input-layout>\n    </ng-template>\n\n    <ng-template #panelContent>\n      <div class=\"custom-menu\">\n        @if (this.input.withSearch) {\n          <input class=\"input-search\" type=\"search\" placeholder=\"Rechercher...\" (input)=\"this.onSearchChange($event)\" />\n        }\n\n        @for (opt of this.filteredOptions; track opt.id) {\n          <button\n            [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n            (click)=\"this.selectOption(opt.id, $event)\"\n            [class.selected]=\"this.isSelected(opt.id)\"\n            [class.disabled]=\"opt.disabled\"\n            class=\"dropdown-option space-between\"\n          >\n            {{ opt.name | translate }}\n            @if (this.isSelected(opt.id)) {\n              <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n            }\n          </button>\n        }\n      </div>\n    </ng-template>\n  </ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"] }]
        }], propDecorators: { space: [{
                type: Input
            }], overlayPanelRef: [{
                type: ViewChild,
                args: [CamOverlayPanelComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2lucHV0L2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9kcm9wZG93bi9kcm9wZG93bi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUc1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUMsT0FBTyxFQUFFLHdCQUF3QixFQUFFLGNBQWMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNsRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFaEQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7O0FBU2pGLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSx5QkFBa0Q7SUFQekY7O1FBUVcsVUFBSyxHQUFHLElBQUksQ0FBQztRQUlmLGdCQUFXLEdBQXVELEVBQUUsQ0FBQztRQUNyRSxvQkFBZSxHQUF1RCxFQUFFLENBQUM7S0FzRGpGO0lBcERVLFFBQVE7UUFDZixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLHFCQUFxQixDQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDckMsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7WUFDM0IsSUFBSSxDQUFDLGVB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QUUsd0JBQXdCLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxvQkFBb0IsQ0FBQzs4QkFHL0csS0FBSztzQkFBYixLQUFLO2dCQUUrQixlQUFlO3NCQUFuRCxTQUFTO3VCQUFDLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nRm9yLCBOZ0lmIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBJbnB1dERyb3Bkb3duIH0gZnJvbSAnQHRhL2Zvcm0tbW9kZWwnO1xuaW1wb3J0IHsgRm9udEljb25Db21wb25lbnQgfSBmcm9tICdAdGEvaWNvbnMnO1xuaW1wb3J0IHsgQ2FtT3ZlcmxheVBhbmVsQ29tcG9uZW50LCBMYWJlbENvbXBvbmVudCB9IGZyb20gJ0B0YS91aSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVQaXBlIH0gZnJvbSAnQHRhL3RyYW5zbGF0aW9uJztcblxuaW1wb3J0IHsgQ2FtQWJzdHJhY3RJbnB1dENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Fic3RyYWN0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJbnB1dExheW91dENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2lucHV0LWxheW91dC9pbnB1dC1sYXlvdXQuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGEtaW5wdXQtZHJvcGRvd24nLFxuICB0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd24uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kcm9wZG93bi5jb21wb25lbnQuc2NzcyddLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbTmdJZiwgTmdGb3IsIEZvbnRJY29uQ29tcG9uZW50LCBDYW1PdmVybGF5UGFuZWxDb21wb25lbnQsIExhYmVsQ29tcG9uZW50LCBUcmFuc2xhdGVQaXBlLCBJbnB1dExheW91dENvbXBvbmVudF0sXG59KVxuZXhwb3J0IGNsYXNzIERyb3Bkb3duQ29tcG9uZW50IGV4dGVuZHMgQ2FtQWJzdHJhY3RJbnB1dENvbXBvbmVudDxJbnB1dERyb3Bkb3duPGFueT4sIGFueT4ge1xuICBASW5wdXQoKSBzcGFjZSA9IHRydWU7XG5cbiAgQFZpZXdDaGlsZChDYW1PdmVybGF5UGFuZWxDb21wb25lbnQpIG92ZXJsYXlQYW5lbFJlZiE6IENhbU92ZXJsYXlQYW5lbENvbXBvbmVudDtcblxuICBwdWJsaWMgb3B0aW9uc0xpc3Q6IHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyBkaXNhYmxlZD86IGJvb2xlYW4gfVtdID0gW107XG4gIHB1YmxpYyBmaWx0ZXJlZE9wdGlvbnM6IHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyBkaXNhYmxlZD86IGJvb2xlYW4gfVtdID0gW107XG5cbiAgb3ZlcnJpZGUgbmdPbkluaXQoKSB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgICB0aGlzLl9yZWdpc3RlclN1YnNjcmlwdGlvbihcbiAgICAgIHRoaXMuaW5wdXQub3B0aW9ucy5zdWJzY3JpYmUob3B0aW9ucyA9PiB7XG4gICAgICAgIHRoaXMub3B0aW9uc0xpc3QgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmZpbHRlcmVkT3B0aW9ucyA9IHRoaXMub3B0aW9uc0xpc3Q7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0T3B0aW9uTmFtZShpZDogYW55KTogc3RyaW5nIHtcbiAgICBjb25zdCBmb3VuZCA9IHRoaXMub3B0aW9uc0xpc3QuZmluZChvcHQgPT4gb3B0LmlkID09PSBpZCk7XG4gICAgcmV0dXJuIGZvdW5kID8gZm91bmQubmFtZSA6ICcnO1xuICB9XG5cbiAgcHVibGljIG9uTWVudVNlbGVjdChzZWxlY3RlZElkOiBhbnkpIHtcbiAgICBpZiAodGhpcy5pbnB1dC5tdWx0aXBsZSkge1xuICAgICAgbGV0IGN1cnJlbnRWYWx1ZSA9IHRoaXMuaW5wdXQudmFsdWUgfHwgW107XG4gICAgICBpZiAoY3VycmVudFZhbHVlLmluY2x1ZGVzKHNlbGVjdGVkSWQpKSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRWYWx1ZS5maWx0ZXIoKHY6IGFueSkgPT4gdiAhPT0gc2VsZWN0ZWRJZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBbLi4uY3VycmVudFZhbHVlLCBzZWxlY3RlZElkXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBjdXJyZW50VmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBzZWxlY3RlZElkO1xuICAgICAgdGhpcy5vdmVybGF5UGFuZWxSZWYuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25PdmVybGF5Q2xvc2VkKCk6IHZvaWQge1xuICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gdGhpcy5vcHRpb25zTGlzdDtcbiAgfVxuXG4gIHB1YmxpYyBpc1NlbGVjdGVkKGlkOiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlO1xuICAgIHJldHVybiB0aGlzLmlucHV0Lm11bHRpcGxlID8gQXJyYXkuaXNBcnJheShjdXJyZW50VmFsdWUpICYmIGN1cnJlbnRWYWx1ZS5pbmNsdWRlcyhpZCkgOiBjdXJyZW50VmFsdWUgPT09IGlkO1xuICB9XG5cbiAgcHVibGljIHNlbGVjdE9wdGlvbihpZDogYW55LCBldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgIHRoaXMub25NZW51U2VsZWN0KGlkKTtcbiAgfVxuXG4gIHB1YmxpYyBvblNlYXJjaENoYW5nZShldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQud2l0aFNlYXJjaCkgcmV0dXJuO1xuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IHNlYXJjaFRlcm0gPSB0YXJnZXQudmFsdWUudHJpbSgpO1xuICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID1cbiAgICAgIHNlYXJjaFRlcm0ubGVuZ3RoID49IDBcbiAgICAgICAgPyB0aGlzLm9wdGlvbnNMaXN0LmZpbHRlcihvcHQgPT4gb3B0Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpKVxuICAgICAgICA6IHRoaXMub3B0aW9uc0xpc3Q7XG4gIH1cbn1cbiIsIkBpZiAodGhpcy5pbnB1dCkge1xuICA8dGEtb3ZlcmxheS1wYW5lbCBbcGFuZWxDb25maWddPVwieyBtYXRjaFRyaWdnZXJXaWR0aDogdHJ1ZSB9XCIgKGNsb3NlZCk9XCJ0aGlzLm9uT3ZlcmxheUNsb3NlZCgpXCI+XG4gICAgPG5nLXRlbXBsYXRlICNwYW5lbFRyaWdnZXI+XG4gICAgICA8dGEtaW5wdXQtbGF5b3V0IFtpbnB1dF09XCJ0aGlzLmlucHV0XCI+XG4gICAgICAgIDxkaXYgI2ZvY3VzZWRFbGVtZW50IGNsYXNzPVwiY3VzdG9tLWRyb3Bkb3duLWJ1dHRvbiBmb3JtLWNvbnRyb2xcIiBbY2xhc3MuZGlzYWJsZWRdPVwidGhpcy5pbnB1dC5kaXNhYmxlZFwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic2VsZWN0ZWQtdmFsdWUgYWxpZ24tY2VudGVyIGctc3BhY2UteHNcIj5cbiAgICAgICAgICAgIEBpZiAoIXRoaXMuaW5wdXQubXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgQGlmICh0aGlzLmlucHV0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgICB7eyB0aGlzLmdldE9wdGlvbk5hbWUodGhpcy5pbnB1dC52YWx1ZSkgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgICAgICAgIHt7ICdmb3JtLmlucHV0LmRyb3Bkb3duLm5vdmFsdWUnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gQGVsc2UgaWYgKHRoaXMuaW5wdXQubXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgQGZvciAodmFsdWUgb2YgdGhpcy5pbnB1dC52YWx1ZTsgdHJhY2sgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICA8dGEtbGFiZWwgc2l6ZT1cInNtXCIgY2xhc3M9XCJkLWZsZXhcIj5cbiAgICAgICAgICAgICAgICAgIHt7IHRoaXMuZ2V0T3B0aW9uTmFtZSh2YWx1ZSkgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgICA8L3RhLWxhYmVsPlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDx0YS1mb250LWljb24gbmFtZT1cImFycm93LWJpZy1ib3R0b21cIiB0eXBlPVwic21cIj48L3RhLWZvbnQtaWNvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L3RhLWlucHV0LWxheW91dD5cbiAgICA8L25nLXRlbXBsYXRlPlxuXG4gICAgPG5nLXRlbXBsYXRlICNwYW5lbENvbnRlbnQ+XG4gICAgICA8ZGl2IGNsYXNzPVwiY3VzdG9tLW1lbnVcIj5cbiAgICAgICAgQGlmICh0aGlzLmlucHV0LndpdGhTZWFyY2gpIHtcbiAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJpbnB1dC1zZWFyY2hcIiB0eXBlPVwic2VhcmNoXCIgcGxhY2Vob2xkZXI9XCJSZWNoZXJjaGVyLi4uXCIgKGlucHV0KT1cInRoaXMub25TZWFyY2hDaGFuZ2UoJGV2ZW50KVwiIC8+XG4gICAgICAgIH1cblxuICAgICAgICBAZm9yIChvcHQgb2YgdGhpcy5maWx0ZXJlZE9wdGlvbnM7IHRyYWNrIG9wdC5pZCkge1xuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIFthdHRyLmNka01lbnVJdGVtXT1cIiF0aGlzLmlucHV0Lm11bHRpcGxlID8gJycgOiBudWxsXCJcbiAgICAgICAgICAgIChjbGljayk9XCJ0aGlzLnNlbGVjdE9wdGlvbihvcHQuaWQsICRldmVudClcIlxuICAgICAgICAgICAgW2NsYXNzLnNlbGVjdGVkXT1cInRoaXMuaXNTZWxlY3RlZChvcHQuaWQpXCJcbiAgICAgICAgICAgIFtjbGFzcy5kaXNhYmxlZF09XCJvcHQuZGlzYWJsZWRcIlxuICAgICAgICAgICAgY2xhc3M9XCJkcm9wZG93bi1vcHRpb24gc3BhY2UtYmV0d2VlblwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAge3sgb3B0Lm5hbWUgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgIEBpZiAodGhpcy5pc1NlbGVjdGVkKG9wdC5pZCkpIHtcbiAgICAgICAgICAgICAgPHRhLWZvbnQtaWNvbiBjbGFzcz1cImNoZWNrbWFya1wiIG5hbWU9XCJjaGVjay1saW5lXCI+PC90YS1mb250LWljb24+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIH1cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctdGVtcGxhdGU+XG4gIDwvdGEtb3ZlcmxheS1wYW5lbD5cbn1cbiJdfQ==