import { Component, Input, ViewChild } from "@angular/core";
import { FontIconComponent } from "@ta/icons";
import { TranslatePipe } from "@ta/translation";
import { LabelComponent, TaOverlayPanelComponent } from "@ta/ui";
import { TaAbstractInputComponent } from "../../abstract.component";
import { InputLayoutComponent } from "../../input-layout/input-layout.component";
import * as i0 from "@angular/core";
export class DropdownComponent extends TaAbstractInputComponent {
    constructor() {
        super(...arguments);
        this.space = true;
        this.optionsList = [];
        this.filteredOptions = [];
    }
    ngOnInit() {
        super.ngOnInit();
        this._registerSubscription(this.input.options$.subscribe((options) => {
            this.optionsList = options;
            this.filteredOptions = this.optionsList;
        }));
    }
    getOptionName(id) {
        const found = this.optionsList.find((opt) => opt.id === id);
        return found ? found.name : "";
    }
    onMenuSelect(selectedId) {
        if (this.input.multiple) {
            let currentValue = this.input.value || [];
            if (currentValue.includes(selectedId)) {
                currentValue = currentValue.filter((v) => v !== selectedId);
            }
            else {
                currentValue = [...currentValue, selectedId];
            }
            this.input.value = currentValue;
        }
        else {
            this.input.value = selectedId;
            this.overlayPanelRef.close();
        }
    }
    onOverlayClosed() {
        this.filteredOptions = this.optionsList;
    }
    isSelected(id) {
        const currentValue = this.input.value;
        return this.input.multiple
            ? Array.isArray(currentValue) && currentValue.includes(id)
            : currentValue === id;
    }
    selectOption(id, event) {
        this.onMenuSelect(id);
    }
    onSearchChange(event) {
        if (!this.input.withSearch)
            return;
        const target = event.target;
        const searchTerm = target.value.trim();
        this.filteredOptions =
            searchTerm.length >= 0
                ? this.optionsList.filter((opt) => opt.name.toLowerCase().includes(searchTerm.toLowerCase()))
                : this.optionsList;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DropdownComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: DropdownComponent, isStandalone: true, selector: "ta-input-dropdown", inputs: { space: "space" }, viewQueries: [{ propertyName: "overlayPanelRef", first: true, predicate: TaOverlayPanelComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "@if (this.input) {\n<ta-overlay-panel\n  [panelConfig]=\"{ matchTriggerWidth: true }\"\n  (closed)=\"this.onOverlayClosed()\"\n>\n  <ng-template #panelTrigger>\n    <ta-input-layout [input]=\"this.input\">\n      <div\n        #focusedElement\n        class=\"custom-dropdown-button form-control\"\n        [class.disabled]=\"this.input.disabled\"\n      >\n        <span class=\"selected-value align-center g-space-xs\">\n          @if (!this.input.multiple) { @if (this.input.value) {\n          <span>\n            {{ this.getOptionName(this.input.value) | translate }}\n          </span>\n          } @else {\n          {{ \"form.input.dropdown.novalue\" | translate }}\n          } } @else if (this.input.multiple) { @for (value of this.input.value;\n          track value) {\n          <ta-label size=\"sm\" class=\"d-flex\">\n            {{ this.getOptionName(value) | translate }}\n          </ta-label>\n          } }\n        </span>\n        <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n      </div>\n    </ta-input-layout>\n  </ng-template>\n\n  <ng-template #panelContent>\n    <div class=\"custom-menu\">\n      @if (this.input.withSearch) {\n      <input\n        class=\"input-search\"\n        type=\"search\"\n        placeholder=\"Rechercher...\"\n        (input)=\"this.onSearchChange($event)\"\n      />\n      } @for (opt of this.filteredOptions; track opt.id) {\n      <button\n        [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n        (click)=\"this.selectOption(opt.id, $event)\"\n        [class.selected]=\"this.isSelected(opt.id)\"\n        [class.disabled]=\"opt.disabled\"\n        class=\"dropdown-option space-between\"\n      >\n        {{ opt.name | translate }}\n        @if (this.isSelected(opt.id)) {\n        <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n        }\n      </button>\n      }\n    </div>\n  </ng-template>\n</ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: TaOverlayPanelComponent, selector: "ta-overlay-panel", inputs: ["panelConfig", "position"], outputs: ["closed"] }, { kind: "component", type: LabelComponent, selector: "ta-label", inputs: ["size", "type"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }, { kind: "component", type: InputLayoutComponent, selector: "ta-input-layout", inputs: ["input", "width", "height"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DropdownComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-input-dropdown", standalone: true, imports: [
                        FontIconComponent,
                        TaOverlayPanelComponent,
                        LabelComponent,
                        TranslatePipe,
                        InputLayoutComponent,
                    ], template: "@if (this.input) {\n<ta-overlay-panel\n  [panelConfig]=\"{ matchTriggerWidth: true }\"\n  (closed)=\"this.onOverlayClosed()\"\n>\n  <ng-template #panelTrigger>\n    <ta-input-layout [input]=\"this.input\">\n      <div\n        #focusedElement\n        class=\"custom-dropdown-button form-control\"\n        [class.disabled]=\"this.input.disabled\"\n      >\n        <span class=\"selected-value align-center g-space-xs\">\n          @if (!this.input.multiple) { @if (this.input.value) {\n          <span>\n            {{ this.getOptionName(this.input.value) | translate }}\n          </span>\n          } @else {\n          {{ \"form.input.dropdown.novalue\" | translate }}\n          } } @else if (this.input.multiple) { @for (value of this.input.value;\n          track value) {\n          <ta-label size=\"sm\" class=\"d-flex\">\n            {{ this.getOptionName(value) | translate }}\n          </ta-label>\n          } }\n        </span>\n        <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n      </div>\n    </ta-input-layout>\n  </ng-template>\n\n  <ng-template #panelContent>\n    <div class=\"custom-menu\">\n      @if (this.input.withSearch) {\n      <input\n        class=\"input-search\"\n        type=\"search\"\n        placeholder=\"Rechercher...\"\n        (input)=\"this.onSearchChange($event)\"\n      />\n      } @for (opt of this.filteredOptions; track opt.id) {\n      <button\n        [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n        (click)=\"this.selectOption(opt.id, $event)\"\n        [class.selected]=\"this.isSelected(opt.id)\"\n        [class.disabled]=\"opt.disabled\"\n        class=\"dropdown-option space-between\"\n      >\n        {{ opt.name | translate }}\n        @if (this.isSelected(opt.id)) {\n        <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n        }\n      </button>\n      }\n    </div>\n  </ng-template>\n</ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"] }]
        }], propDecorators: { space: [{
                type: Input
            }], overlayPanelRef: [{
                type: ViewChild,
                args: [TaOverlayPanelComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2lucHV0L2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9kcm9wZG93bi9kcm9wZG93bi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsY0FBYyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRWpFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDOztBQWVqRixNQUFNLE9BQU8saUJBQWtCLFNBQVEsd0JBR3RDO0lBaEJEOztRQWlCVyxVQUFLLEdBQUcsSUFBSSxDQUFDO1FBSWYsZ0JBQVcsR0FBdUQsRUFBRSxDQUFDO1FBQ3JFLG9CQUFlLEdBQ3BCLEVBQUUsQ0FBQztLQTBETjtJQXhEVSxRQUFRO1FBQ2YsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxxQkFBcUIsQ0FDeEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDeEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7WUFDM0IsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUNI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OzhCQU1RLEtBQUs7c0JBQWIsS0FBSztnQkFFOEIsZUFBZTtzQkFBbEQsU0FBUzt1QkFBQyx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBWaWV3Q2hpbGQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBJbnB1dERyb3Bkb3duIH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gXCJAdGEvaWNvbnNcIjtcbmltcG9ydCB7IFRyYW5zbGF0ZVBpcGUgfSBmcm9tIFwiQHRhL3RyYW5zbGF0aW9uXCI7XG5pbXBvcnQgeyBMYWJlbENvbXBvbmVudCwgVGFPdmVybGF5UGFuZWxDb21wb25lbnQgfSBmcm9tIFwiQHRhL3VpXCI7XG5cbmltcG9ydCB7IFRhQWJzdHJhY3RJbnB1dENvbXBvbmVudCB9IGZyb20gXCIuLi8uLi9hYnN0cmFjdC5jb21wb25lbnRcIjtcbmltcG9ydCB7IElucHV0TGF5b3V0Q29tcG9uZW50IH0gZnJvbSBcIi4uLy4uL2lucHV0LWxheW91dC9pbnB1dC1sYXlvdXQuY29tcG9uZW50XCI7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0YS1pbnB1dC1kcm9wZG93blwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL2Ryb3Bkb3duLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9kcm9wZG93bi5jb21wb25lbnQuc2Nzc1wiXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIEZvbnRJY29uQ29tcG9uZW50LFxuICAgIFRhT3ZlcmxheVBhbmVsQ29tcG9uZW50LFxuICAgIExhYmVsQ29tcG9uZW50LFxuICAgIFRyYW5zbGF0ZVBpcGUsXG4gICAgSW5wdXRMYXlvdXRDb21wb25lbnQsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIERyb3Bkb3duQ29tcG9uZW50IGV4dGVuZHMgVGFBYnN0cmFjdElucHV0Q29tcG9uZW50PFxuICBJbnB1dERyb3Bkb3duPGFueT4sXG4gIGFueVxuPiB7XG4gIEBJbnB1dCgpIHNwYWNlID0gdHJ1ZTtcblxuICBAVmlld0NoaWxkKFRhT3ZlcmxheVBhbmVsQ29tcG9uZW50KSBvdmVybGF5UGFuZWxSZWYhOiBUYU92ZXJsYXlQYW5lbENvbXBvbmVudDtcblxuICBwdWJsaWMgb3B0aW9uc0xpc3Q6IHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyBkaXNhYmxlZD86IGJvb2xlYW4gfVtdID0gW107XG4gIHB1YmxpYyBmaWx0ZXJlZE9wdGlvbnM6IHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyBkaXNhYmxlZD86IGJvb2xlYW4gfVtdID1cbiAgICBbXTtcblxuICBvdmVycmlkZSBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuICAgIHRoaXMuX3JlZ2lzdGVyU3Vic2NyaXB0aW9uKFxuICAgICAgdGhpcy5pbnB1dC5vcHRpb25zJC5zdWJzY3JpYmUoKG9wdGlvbnMpID0+IHtcbiAgICAgICAgdGhpcy5vcHRpb25zTGlzdCA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gdGhpcy5vcHRpb25zTGlzdDtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRPcHRpb25OYW1lKGlkOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IGZvdW5kID0gdGhpcy5vcHRpb25zTGlzdC5maW5kKChvcHQpID0+IG9wdC5pZCA9PT0gaWQpO1xuICAgIHJldHVybiBmb3VuZCA/IGZvdW5kLm5hbWUgOiBcIlwiO1xuICB9XG5cbiAgcHVibGljIG9uTWVudVNlbGVjdChzZWxlY3RlZElkOiBhbnkpIHtcbiAgICBpZiAodGhpcy5pbnB1dC5tdWx0aXBsZSkge1xuICAgICAgbGV0IGN1cnJlbnRWYWx1ZSA9IHRoaXMuaW5wdXQudmFsdWUgfHwgW107XG4gICAgICBpZiAoY3VycmVudFZhbHVlLmluY2x1ZGVzKHNlbGVjdGVkSWQpKSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRWYWx1ZS5maWx0ZXIoKHY6IGFueSkgPT4gdiAhPT0gc2VsZWN0ZWRJZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBbLi4uY3VycmVudFZhbHVlLCBzZWxlY3RlZElkXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBjdXJyZW50VmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBzZWxlY3RlZElkO1xuICAgICAgdGhpcy5vdmVybGF5UGFuZWxSZWYuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25PdmVybGF5Q2xvc2VkKCk6IHZvaWQge1xuICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gdGhpcy5vcHRpb25zTGlzdDtcbiAgfVxuXG4gIHB1YmxpYyBpc1NlbGVjdGVkKGlkOiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlO1xuICAgIHJldHVybiB0aGlzLmlucHV0Lm11bHRpcGxlXG4gICAgICA/IEFycmF5LmlzQXJyYXkoY3VycmVudFZhbHVlKSAmJiBjdXJyZW50VmFsdWUuaW5jbHVkZXMoaWQpXG4gICAgICA6IGN1cnJlbnRWYWx1ZSA9PT0gaWQ7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0T3B0aW9uKGlkOiBhbnksIGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5vbk1lbnVTZWxlY3QoaWQpO1xuICB9XG5cbiAgcHVibGljIG9uU2VhcmNoQ2hhbmdlKGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbnB1dC53aXRoU2VhcmNoKSByZXR1cm47XG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3Qgc2VhcmNoVGVybSA9IHRhcmdldC52YWx1ZS50cmltKCk7XG4gICAgdGhpcy5maWx0ZXJlZE9wdGlvbnMgPVxuICAgICAgc2VhcmNoVGVybS5sZW5ndGggPj0gMFxuICAgICAgICA/IHRoaXMub3B0aW9uc0xpc3QuZmlsdGVyKChvcHQpID0+XG4gICAgICAgICAgICBvcHQubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICApXG4gICAgICAgIDogdGhpcy5vcHRpb25zTGlzdDtcbiAgfVxufVxuIiwiQGlmICh0aGlzLmlucHV0KSB7XG48dGEtb3ZlcmxheS1wYW5lbFxuICBbcGFuZWxDb25maWddPVwieyBtYXRjaFRyaWdnZXJXaWR0aDogdHJ1ZSB9XCJcbiAgKGNsb3NlZCk9XCJ0aGlzLm9uT3ZlcmxheUNsb3NlZCgpXCJcbj5cbiAgPG5nLXRlbXBsYXRlICNwYW5lbFRyaWdnZXI+XG4gICAgPHRhLWlucHV0LWxheW91dCBbaW5wdXRdPVwidGhpcy5pbnB1dFwiPlxuICAgICAgPGRpdlxuICAgICAgICAjZm9jdXNlZEVsZW1lbnRcbiAgICAgICAgY2xhc3M9XCJjdXN0b20tZHJvcGRvd24tYnV0dG9uIGZvcm0tY29udHJvbFwiXG4gICAgICAgIFtjbGFzcy5kaXNhYmxlZF09XCJ0aGlzLmlucHV0LmRpc2FibGVkXCJcbiAgICAgID5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJzZWxlY3RlZC12YWx1ZSBhbGlnbi1jZW50ZXIgZy1zcGFjZS14c1wiPlxuICAgICAgICAgIEBpZiAoIXRoaXMuaW5wdXQubXVsdGlwbGUpIHsgQGlmICh0aGlzLmlucHV0LnZhbHVlKSB7XG4gICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICB7eyB0aGlzLmdldE9wdGlvbk5hbWUodGhpcy5pbnB1dC52YWx1ZSkgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAge3sgXCJmb3JtLmlucHV0LmRyb3Bkb3duLm5vdmFsdWVcIiB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgIH0gfSBAZWxzZSBpZiAodGhpcy5pbnB1dC5tdWx0aXBsZSkgeyBAZm9yICh2YWx1ZSBvZiB0aGlzLmlucHV0LnZhbHVlO1xuICAgICAgICAgIHRyYWNrIHZhbHVlKSB7XG4gICAgICAgICAgPHRhLWxhYmVsIHNpemU9XCJzbVwiIGNsYXNzPVwiZC1mbGV4XCI+XG4gICAgICAgICAgICB7eyB0aGlzLmdldE9wdGlvbk5hbWUodmFsdWUpIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgPC90YS1sYWJlbD5cbiAgICAgICAgICB9IH1cbiAgICAgICAgPC9zcGFuPlxuICAgICAgICA8dGEtZm9udC1pY29uIG5hbWU9XCJhcnJvdy1iaWctYm90dG9tXCIgdHlwZT1cInNtXCI+PC90YS1mb250LWljb24+XG4gICAgICA8L2Rpdj5cbiAgICA8L3RhLWlucHV0LWxheW91dD5cbiAgPC9uZy10ZW1wbGF0ZT5cblxuICA8bmctdGVtcGxhdGUgI3BhbmVsQ29udGVudD5cbiAgICA8ZGl2IGNsYXNzPVwiY3VzdG9tLW1lbnVcIj5cbiAgICAgIEBpZiAodGhpcy5pbnB1dC53aXRoU2VhcmNoKSB7XG4gICAgICA8aW5wdXRcbiAgICAgICAgY2xhc3M9XCJpbnB1dC1zZWFyY2hcIlxuICAgICAgICB0eXBlPVwic2VhcmNoXCJcbiAgICAgICAgcGxhY2Vob2xkZXI9XCJSZWNoZXJjaGVyLi4uXCJcbiAgICAgICAgKGlucHV0KT1cInRoaXMub25TZWFyY2hDaGFuZ2UoJGV2ZW50KVwiXG4gICAgICAvPlxuICAgICAgfSBAZm9yIChvcHQgb2YgdGhpcy5maWx0ZXJlZE9wdGlvbnM7IHRyYWNrIG9wdC5pZCkge1xuICAgICAgPGJ1dHRvblxuICAgICAgICBbYXR0ci5jZGtNZW51SXRlbV09XCIhdGhpcy5pbnB1dC5tdWx0aXBsZSA/ICcnIDogbnVsbFwiXG4gICAgICAgIChjbGljayk9XCJ0aGlzLnNlbGVjdE9wdGlvbihvcHQuaWQsICRldmVudClcIlxuICAgICAgICBbY2xhc3Muc2VsZWN0ZWRdPVwidGhpcy5pc1NlbGVjdGVkKG9wdC5pZClcIlxuICAgICAgICBbY2xhc3MuZGlzYWJsZWRdPVwib3B0LmRpc2FibGVkXCJcbiAgICAgICAgY2xhc3M9XCJkcm9wZG93bi1vcHRpb24gc3BhY2UtYmV0d2VlblwiXG4gICAgICA+XG4gICAgICAgIHt7IG9wdC5uYW1lIHwgdHJhbnNsYXRlIH19XG4gICAgICAgIEBpZiAodGhpcy5pc1NlbGVjdGVkKG9wdC5pZCkpIHtcbiAgICAgICAgPHRhLWZvbnQtaWNvbiBjbGFzcz1cImNoZWNrbWFya1wiIG5hbWU9XCJjaGVjay1saW5lXCI+PC90YS1mb250LWljb24+XG4gICAgICAgIH1cbiAgICAgIDwvYnV0dG9uPlxuICAgICAgfVxuICAgIDwvZGl2PlxuICA8L25nLXRlbXBsYXRlPlxuPC90YS1vdmVybGF5LXBhbmVsPlxufVxuIl19