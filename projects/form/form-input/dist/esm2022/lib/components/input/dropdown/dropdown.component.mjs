import { Component, input, ViewChild } from "@angular/core";
import { FontIconComponent } from "@ta/icons";
import { TranslatePipe } from "@ta/translation";
import { LabelComponent, TaOverlayPanelComponent } from "@ta/ui";
import { TaAbstractInputComponent } from "../../abstract.component";
import { InputLayoutComponent } from "../../input-layout/input-layout.component";
import * as i0 from "@angular/core";
export class DropdownComponent extends TaAbstractInputComponent {
    constructor() {
        super(...arguments);
        this.space = input(true);
        this.optionsList = [];
        this.filteredOptions = [];
    }
    ngOnInit() {
        super.ngOnInit();
        this._registerSubscription(this.input.options$.subscribe((options) => {
            this.optionsList = options;
            this.filteredOptions = this.optionsList;
        }));
    }
    getOptionName(id) {
        const found = this.optionsList.find((opt) => opt.id === id);
        return found ? found.name : "";
    }
    onMenuSelect(selectedId) {
        if (this.input.multiple) {
            let currentValue = this.input.value || [];
            if (currentValue.includes(selectedId)) {
                currentValue = currentValue.filter((v) => v !== selectedId);
            }
            else {
                currentValue = [...currentValue, selectedId];
            }
            this.input.value = currentValue;
        }
        else {
            this.input.value = selectedId;
            this.overlayPanelRef.close();
        }
    }
    onOverlayClosed() {
        this.filteredOptions = this.optionsList;
    }
    isSelected(id) {
        const currentValue = this.input.value;
        return this.input.multiple
            ? Array.isArray(currentValue) && currentValue.includes(id)
            : currentValue === id;
    }
    selectOption(id, event) {
        this.onMenuSelect(id);
    }
    onSearchChange(event) {
        if (!this.input.withSearch)
            return;
        const target = event.target;
        const searchTerm = target.value.trim();
        this.filteredOptions =
            searchTerm.length >= 0
                ? this.optionsList.filter((opt) => opt.name.toLowerCase().includes(searchTerm.toLowerCase()))
                : this.optionsList;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DropdownComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.14", type: DropdownComponent, isStandalone: true, selector: "ta-input-dropdown", inputs: { space: { classPropertyName: "space", publicName: "space", isSignal: true, isRequired: false, transformFunction: null } }, viewQueries: [{ propertyName: "overlayPanelRef", first: true, predicate: TaOverlayPanelComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "@if (this.input) {\n<ta-overlay-panel\n  [panelConfig]=\"{ matchTriggerWidth: true }\"\n  (closed)=\"this.onOverlayClosed()\"\n>\n  <ng-template #panelTrigger>\n    <ta-input-layout [input]=\"this.input\">\n      <div\n        #focusedElement\n        class=\"custom-dropdown-button form-control\"\n        [class.disabled]=\"this.input.disabled\"\n      >\n        <span class=\"selected-value align-center g-space-xs\">\n          @if (!this.input.multiple) { @if (this.input.value) {\n          <span>\n            {{ this.getOptionName(this.input.value) | translate }}\n          </span>\n          } @else {\n          {{ \"form.input.dropdown.novalue\" | translate }}\n          } } @else if (this.input.multiple) { @for (value of this.input.value;\n          track value) {\n          <ta-label size=\"sm\" class=\"d-flex\">\n            {{ this.getOptionName(value) | translate }}\n          </ta-label>\n          } }\n        </span>\n        <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n      </div>\n    </ta-input-layout>\n  </ng-template>\n\n  <ng-template #panelContent>\n    <div class=\"custom-menu\">\n      @if (this.input.withSearch) {\n      <input\n        class=\"input-search\"\n        type=\"search\"\n        placeholder=\"Rechercher...\"\n        (input)=\"this.onSearchChange($event)\"\n      />\n      } @for (opt of this.filteredOptions; track opt.id) {\n      <button\n        [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n        (click)=\"this.selectOption(opt.id, $event)\"\n        [class.selected]=\"this.isSelected(opt.id)\"\n        [class.disabled]=\"opt.disabled\"\n        class=\"dropdown-option space-between\"\n      >\n        {{ opt.name | translate }}\n        @if (this.isSelected(opt.id)) {\n        <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n        }\n      </button>\n      }\n    </div>\n  </ng-template>\n</ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: TaOverlayPanelComponent, selector: "ta-overlay-panel", inputs: ["panelConfig", "position"], outputs: ["closed"] }, { kind: "component", type: LabelComponent, selector: "ta-label", inputs: ["size", "type"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }, { kind: "component", type: InputLayoutComponent, selector: "ta-input-layout", inputs: ["input", "width", "height"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.14", ngImport: i0, type: DropdownComponent, decorators: [{
            type: Component,
            args: [{ selector: "ta-input-dropdown", standalone: true, imports: [
                        FontIconComponent,
                        TaOverlayPanelComponent,
                        LabelComponent,
                        TranslatePipe,
                        InputLayoutComponent,
                    ], template: "@if (this.input) {\n<ta-overlay-panel\n  [panelConfig]=\"{ matchTriggerWidth: true }\"\n  (closed)=\"this.onOverlayClosed()\"\n>\n  <ng-template #panelTrigger>\n    <ta-input-layout [input]=\"this.input\">\n      <div\n        #focusedElement\n        class=\"custom-dropdown-button form-control\"\n        [class.disabled]=\"this.input.disabled\"\n      >\n        <span class=\"selected-value align-center g-space-xs\">\n          @if (!this.input.multiple) { @if (this.input.value) {\n          <span>\n            {{ this.getOptionName(this.input.value) | translate }}\n          </span>\n          } @else {\n          {{ \"form.input.dropdown.novalue\" | translate }}\n          } } @else if (this.input.multiple) { @for (value of this.input.value;\n          track value) {\n          <ta-label size=\"sm\" class=\"d-flex\">\n            {{ this.getOptionName(value) | translate }}\n          </ta-label>\n          } }\n        </span>\n        <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n      </div>\n    </ta-input-layout>\n  </ng-template>\n\n  <ng-template #panelContent>\n    <div class=\"custom-menu\">\n      @if (this.input.withSearch) {\n      <input\n        class=\"input-search\"\n        type=\"search\"\n        placeholder=\"Rechercher...\"\n        (input)=\"this.onSearchChange($event)\"\n      />\n      } @for (opt of this.filteredOptions; track opt.id) {\n      <button\n        [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n        (click)=\"this.selectOption(opt.id, $event)\"\n        [class.selected]=\"this.isSelected(opt.id)\"\n        [class.disabled]=\"opt.disabled\"\n        class=\"dropdown-option space-between\"\n      >\n        {{ opt.name | translate }}\n        @if (this.isSelected(opt.id)) {\n        <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n        }\n      </button>\n      }\n    </div>\n  </ng-template>\n</ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"] }]
        }], propDecorators: { overlayPanelRef: [{
                type: ViewChild,
                args: [TaOverlayPanelComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2lucHV0L2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9kcm9wZG93bi9kcm9wZG93bi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsY0FBYyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRWpFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDOztBQWVqRixNQUFNLE9BQU8saUJBQWtCLFNBQVEsd0JBR3RDO0lBaEJEOztRQWlCRSxVQUFLLEdBQUcsS0FBSyxDQUFVLElBQUksQ0FBQyxDQUFDO1FBSXRCLGdCQUFXLEdBQXVELEVBQUUsQ0FBQztRQUNyRSxvQkFBZSxHQUNwQixFQUFFLENBQUM7S0EwRE47SUF4RFUsUUFBUTtRQUNmLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMscUJBQXFCLENBQ3hCLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQ3hDLElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO1lBQzNCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVNLGFBQWEsQ0FBQyxFQUFPO1FBQzFCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQzVELE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVNLFlBQVksQ0FBQyxVQUFlO1FBQ2pDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN4QixJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDMUMsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7Z0JBQ3RDLFlBQVksR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssVUFBVSxDQUFDLENBQUM7WUFDbkUsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLFlBQVksR0FBRyxDQUFDLEdBQUcsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQy9DLENBQUM7WUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUM7UUFDbEMsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUM7WUFDOUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMvQixDQUFDO0lBQ0gsQ0FBQztJQUVNLGVBQWU7UUFDcEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFDLENBQUM7SUFFTSxVQUFVLENBQUMsRUFBTztRQUN2QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztRQUN0QyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUTtZQUN4QixDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUMxRCxDQUFDLENBQUMsWUFBWSxLQUFLLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRU0sWUFBWSxDQUFDLEVBQU8sRUFBRSxLQUFpQjtRQUM1QyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7SUFFTSxjQUFjLENBQUMsS0FBWTtRQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVO1lBQUUsT0FBTztRQUNuQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBMEIsQ0FBQztRQUNoRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxlQUFlO1lBQ2xCLFVBQVUsQ0FBQyxNQUFNLElBQUksQ0FBQztnQkFDcEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FDOUIsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQzFEO2dCQUNILENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQ3pCLENBQUM7K0dBbkVVLGlCQUFpQjttR0FBakIsaUJBQWlCLGtRQU1qQix1QkFBdUIsdUVDN0JwQyw2NURBMERBLG01QkQxQ0ksaUJBQWlCLG1GQUNqQix1QkFBdUIsdUhBQ3ZCLGNBQWMsMEVBQ2QsYUFBYSxrREFDYixvQkFBb0I7OzRGQUdYLGlCQUFpQjtrQkFiN0IsU0FBUzsrQkFDRSxtQkFBbUIsY0FHakIsSUFBSSxXQUNQO3dCQUNQLGlCQUFpQjt3QkFDakIsdUJBQXVCO3dCQUN2QixjQUFjO3dCQUNkLGFBQWE7d0JBQ2Isb0JBQW9CO3FCQUNyQjs4QkFRbUMsZUFBZTtzQkFBbEQsU0FBUzt1QkFBQyx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIGlucHV0LCBWaWV3Q2hpbGQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBJbnB1dERyb3Bkb3duIH0gZnJvbSBcIkB0YS9mb3JtLW1vZGVsXCI7XG5pbXBvcnQgeyBGb250SWNvbkNvbXBvbmVudCB9IGZyb20gXCJAdGEvaWNvbnNcIjtcbmltcG9ydCB7IFRyYW5zbGF0ZVBpcGUgfSBmcm9tIFwiQHRhL3RyYW5zbGF0aW9uXCI7XG5pbXBvcnQgeyBMYWJlbENvbXBvbmVudCwgVGFPdmVybGF5UGFuZWxDb21wb25lbnQgfSBmcm9tIFwiQHRhL3VpXCI7XG5cbmltcG9ydCB7IFRhQWJzdHJhY3RJbnB1dENvbXBvbmVudCB9IGZyb20gXCIuLi8uLi9hYnN0cmFjdC5jb21wb25lbnRcIjtcbmltcG9ydCB7IElucHV0TGF5b3V0Q29tcG9uZW50IH0gZnJvbSBcIi4uLy4uL2lucHV0LWxheW91dC9pbnB1dC1sYXlvdXQuY29tcG9uZW50XCI7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0YS1pbnB1dC1kcm9wZG93blwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL2Ryb3Bkb3duLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9kcm9wZG93bi5jb21wb25lbnQuc2Nzc1wiXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIEZvbnRJY29uQ29tcG9uZW50LFxuICAgIFRhT3ZlcmxheVBhbmVsQ29tcG9uZW50LFxuICAgIExhYmVsQ29tcG9uZW50LFxuICAgIFRyYW5zbGF0ZVBpcGUsXG4gICAgSW5wdXRMYXlvdXRDb21wb25lbnQsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIERyb3Bkb3duQ29tcG9uZW50IGV4dGVuZHMgVGFBYnN0cmFjdElucHV0Q29tcG9uZW50PFxuICBJbnB1dERyb3Bkb3duPGFueT4sXG4gIGFueVxuPiB7XG4gIHNwYWNlID0gaW5wdXQ8Ym9vbGVhbj4odHJ1ZSk7XG5cbiAgQFZpZXdDaGlsZChUYU92ZXJsYXlQYW5lbENvbXBvbmVudCkgb3ZlcmxheVBhbmVsUmVmITogVGFPdmVybGF5UGFuZWxDb21wb25lbnQ7XG5cbiAgcHVibGljIG9wdGlvbnNMaXN0OiB7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgZGlzYWJsZWQ/OiBib29sZWFuIH1bXSA9IFtdO1xuICBwdWJsaWMgZmlsdGVyZWRPcHRpb25zOiB7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgZGlzYWJsZWQ/OiBib29sZWFuIH1bXSA9XG4gICAgW107XG5cbiAgb3ZlcnJpZGUgbmdPbkluaXQoKSB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgICB0aGlzLl9yZWdpc3RlclN1YnNjcmlwdGlvbihcbiAgICAgIHRoaXMuaW5wdXQub3B0aW9ucyQuc3Vic2NyaWJlKChvcHRpb25zKSA9PiB7XG4gICAgICAgIHRoaXMub3B0aW9uc0xpc3QgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmZpbHRlcmVkT3B0aW9ucyA9IHRoaXMub3B0aW9uc0xpc3Q7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0T3B0aW9uTmFtZShpZDogYW55KTogc3RyaW5nIHtcbiAgICBjb25zdCBmb3VuZCA9IHRoaXMub3B0aW9uc0xpc3QuZmluZCgob3B0KSA9PiBvcHQuaWQgPT09IGlkKTtcbiAgICByZXR1cm4gZm91bmQgPyBmb3VuZC5uYW1lIDogXCJcIjtcbiAgfVxuXG4gIHB1YmxpYyBvbk1lbnVTZWxlY3Qoc2VsZWN0ZWRJZDogYW55KSB7XG4gICAgaWYgKHRoaXMuaW5wdXQubXVsdGlwbGUpIHtcbiAgICAgIGxldCBjdXJyZW50VmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlIHx8IFtdO1xuICAgICAgaWYgKGN1cnJlbnRWYWx1ZS5pbmNsdWRlcyhzZWxlY3RlZElkKSkge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBjdXJyZW50VmFsdWUuZmlsdGVyKCh2OiBhbnkpID0+IHYgIT09IHNlbGVjdGVkSWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudFZhbHVlID0gWy4uLmN1cnJlbnRWYWx1ZSwgc2VsZWN0ZWRJZF07XG4gICAgICB9XG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gY3VycmVudFZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gc2VsZWN0ZWRJZDtcbiAgICAgIHRoaXMub3ZlcmxheVBhbmVsUmVmLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uT3ZlcmxheUNsb3NlZCgpOiB2b2lkIHtcbiAgICB0aGlzLmZpbHRlcmVkT3B0aW9ucyA9IHRoaXMub3B0aW9uc0xpc3Q7XG4gIH1cblxuICBwdWJsaWMgaXNTZWxlY3RlZChpZDogYW55KTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZTtcbiAgICByZXR1cm4gdGhpcy5pbnB1dC5tdWx0aXBsZVxuICAgICAgPyBBcnJheS5pc0FycmF5KGN1cnJlbnRWYWx1ZSkgJiYgY3VycmVudFZhbHVlLmluY2x1ZGVzKGlkKVxuICAgICAgOiBjdXJyZW50VmFsdWUgPT09IGlkO1xuICB9XG5cbiAgcHVibGljIHNlbGVjdE9wdGlvbihpZDogYW55LCBldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgIHRoaXMub25NZW51U2VsZWN0KGlkKTtcbiAgfVxuXG4gIHB1YmxpYyBvblNlYXJjaENoYW5nZShldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQud2l0aFNlYXJjaCkgcmV0dXJuO1xuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IHNlYXJjaFRlcm0gPSB0YXJnZXQudmFsdWUudHJpbSgpO1xuICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID1cbiAgICAgIHNlYXJjaFRlcm0ubGVuZ3RoID49IDBcbiAgICAgICAgPyB0aGlzLm9wdGlvbnNMaXN0LmZpbHRlcigob3B0KSA9PlxuICAgICAgICAgICAgb3B0Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICAgKVxuICAgICAgICA6IHRoaXMub3B0aW9uc0xpc3Q7XG4gIH1cbn1cbiIsIkBpZiAodGhpcy5pbnB1dCkge1xuPHRhLW92ZXJsYXktcGFuZWxcbiAgW3BhbmVsQ29uZmlnXT1cInsgbWF0Y2hUcmlnZ2VyV2lkdGg6IHRydWUgfVwiXG4gIChjbG9zZWQpPVwidGhpcy5vbk92ZXJsYXlDbG9zZWQoKVwiXG4+XG4gIDxuZy10ZW1wbGF0ZSAjcGFuZWxUcmlnZ2VyPlxuICAgIDx0YS1pbnB1dC1sYXlvdXQgW2lucHV0XT1cInRoaXMuaW5wdXRcIj5cbiAgICAgIDxkaXZcbiAgICAgICAgI2ZvY3VzZWRFbGVtZW50XG4gICAgICAgIGNsYXNzPVwiY3VzdG9tLWRyb3Bkb3duLWJ1dHRvbiBmb3JtLWNvbnRyb2xcIlxuICAgICAgICBbY2xhc3MuZGlzYWJsZWRdPVwidGhpcy5pbnB1dC5kaXNhYmxlZFwiXG4gICAgICA+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwic2VsZWN0ZWQtdmFsdWUgYWxpZ24tY2VudGVyIGctc3BhY2UteHNcIj5cbiAgICAgICAgICBAaWYgKCF0aGlzLmlucHV0Lm11bHRpcGxlKSB7IEBpZiAodGhpcy5pbnB1dC52YWx1ZSkge1xuICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAge3sgdGhpcy5nZXRPcHRpb25OYW1lKHRoaXMuaW5wdXQudmFsdWUpIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgIHt7IFwiZm9ybS5pbnB1dC5kcm9wZG93bi5ub3ZhbHVlXCIgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICB9IH0gQGVsc2UgaWYgKHRoaXMuaW5wdXQubXVsdGlwbGUpIHsgQGZvciAodmFsdWUgb2YgdGhpcy5pbnB1dC52YWx1ZTtcbiAgICAgICAgICB0cmFjayB2YWx1ZSkge1xuICAgICAgICAgIDx0YS1sYWJlbCBzaXplPVwic21cIiBjbGFzcz1cImQtZmxleFwiPlxuICAgICAgICAgICAge3sgdGhpcy5nZXRPcHRpb25OYW1lKHZhbHVlKSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgIDwvdGEtbGFiZWw+XG4gICAgICAgICAgfSB9XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPHRhLWZvbnQtaWNvbiBuYW1lPVwiYXJyb3ctYmlnLWJvdHRvbVwiIHR5cGU9XCJzbVwiPjwvdGEtZm9udC1pY29uPlxuICAgICAgPC9kaXY+XG4gICAgPC90YS1pbnB1dC1sYXlvdXQ+XG4gIDwvbmctdGVtcGxhdGU+XG5cbiAgPG5nLXRlbXBsYXRlICNwYW5lbENvbnRlbnQ+XG4gICAgPGRpdiBjbGFzcz1cImN1c3RvbS1tZW51XCI+XG4gICAgICBAaWYgKHRoaXMuaW5wdXQud2l0aFNlYXJjaCkge1xuICAgICAgPGlucHV0XG4gICAgICAgIGNsYXNzPVwiaW5wdXQtc2VhcmNoXCJcbiAgICAgICAgdHlwZT1cInNlYXJjaFwiXG4gICAgICAgIHBsYWNlaG9sZGVyPVwiUmVjaGVyY2hlci4uLlwiXG4gICAgICAgIChpbnB1dCk9XCJ0aGlzLm9uU2VhcmNoQ2hhbmdlKCRldmVudClcIlxuICAgICAgLz5cbiAgICAgIH0gQGZvciAob3B0IG9mIHRoaXMuZmlsdGVyZWRPcHRpb25zOyB0cmFjayBvcHQuaWQpIHtcbiAgICAgIDxidXR0b25cbiAgICAgICAgW2F0dHIuY2RrTWVudUl0ZW1dPVwiIXRoaXMuaW5wdXQubXVsdGlwbGUgPyAnJyA6IG51bGxcIlxuICAgICAgICAoY2xpY2spPVwidGhpcy5zZWxlY3RPcHRpb24ob3B0LmlkLCAkZXZlbnQpXCJcbiAgICAgICAgW2NsYXNzLnNlbGVjdGVkXT1cInRoaXMuaXNTZWxlY3RlZChvcHQuaWQpXCJcbiAgICAgICAgW2NsYXNzLmRpc2FibGVkXT1cIm9wdC5kaXNhYmxlZFwiXG4gICAgICAgIGNsYXNzPVwiZHJvcGRvd24tb3B0aW9uIHNwYWNlLWJldHdlZW5cIlxuICAgICAgPlxuICAgICAgICB7eyBvcHQubmFtZSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICBAaWYgKHRoaXMuaXNTZWxlY3RlZChvcHQuaWQpKSB7XG4gICAgICAgIDx0YS1mb250LWljb24gY2xhc3M9XCJjaGVja21hcmtcIiBuYW1lPVwiY2hlY2stbGluZVwiPjwvdGEtZm9udC1pY29uPlxuICAgICAgICB9XG4gICAgICA8L2J1dHRvbj5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9uZy10ZW1wbGF0ZT5cbjwvdGEtb3ZlcmxheS1wYW5lbD5cbn1cbiJdfQ==