import { NgFor, NgIf } from '@angular/common';
import { Component, Input, ViewChild } from '@angular/core';
import { FontIconComponent } from '@ta/icons';
import { TranslatePipe } from '@ta/translation';
import { LabelComponent, TaOverlayPanelComponent } from '@ta/ui';
import { TaAbstractInputComponent } from '../../abstract.component';
import { InputLayoutComponent } from '../../input-layout/input-layout.component';
import * as i0 from "@angular/core";
export class DropdownComponent extends TaAbstractInputComponent {
    constructor() {
        super(...arguments);
        this.space = true;
        this.optionsList = [];
        this.filteredOptions = [];
    }
    ngOnInit() {
        super.ngOnInit();
        this._registerSubscription(this.input.options.subscribe(options => {
            this.optionsList = options;
            this.filteredOptions = this.optionsList;
        }));
    }
    getOptionName(id) {
        const found = this.optionsList.find(opt => opt.id === id);
        return found ? found.name : '';
    }
    onMenuSelect(selectedId) {
        if (this.input.multiple) {
            let currentValue = this.input.value || [];
            if (currentValue.includes(selectedId)) {
                currentValue = currentValue.filter((v) => v !== selectedId);
            }
            else {
                currentValue = [...currentValue, selectedId];
            }
            this.input.value = currentValue;
        }
        else {
            this.input.value = selectedId;
            this.overlayPanelRef.close();
        }
    }
    onOverlayClosed() {
        this.filteredOptions = this.optionsList;
    }
    isSelected(id) {
        const currentValue = this.input.value;
        return this.input.multiple ? Array.isArray(currentValue) && currentValue.includes(id) : currentValue === id;
    }
    selectOption(id, event) {
        this.onMenuSelect(id);
    }
    onSearchChange(event) {
        if (!this.input.withSearch)
            return;
        const target = event.target;
        const searchTerm = target.value.trim();
        this.filteredOptions =
            searchTerm.length >= 0
                ? this.optionsList.filter(opt => opt.name.toLowerCase().includes(searchTerm.toLowerCase()))
                : this.optionsList;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DropdownComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: DropdownComponent, isStandalone: true, selector: "ta-input-dropdown", inputs: { space: "space" }, viewQueries: [{ propertyName: "overlayPanelRef", first: true, predicate: TaOverlayPanelComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "@if (this.input) {\n  <ta-overlay-panel [panelConfig]=\"{ matchTriggerWidth: true }\" (closed)=\"this.onOverlayClosed()\">\n    <ng-template #panelTrigger>\n      <ta-input-layout [input]=\"this.input\">\n        <div #focusedElement class=\"custom-dropdown-button form-control\" [class.disabled]=\"this.input.disabled\">\n          <span class=\"selected-value align-center g-space-xs\">\n            @if (!this.input.multiple) {\n              @if (this.input.value) {\n                <span>\n                  {{ this.getOptionName(this.input.value) | translate }}\n                </span>\n              } @else {\n                {{ 'form.input.dropdown.novalue' | translate }}\n              }\n            } @else if (this.input.multiple) {\n              @for (value of this.input.value; track value) {\n                <ta-label size=\"sm\" class=\"d-flex\">\n                  {{ this.getOptionName(value) | translate }}\n                </ta-label>\n              }\n            }\n          </span>\n          <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n        </div>\n      </ta-input-layout>\n    </ng-template>\n\n    <ng-template #panelContent>\n      <div class=\"custom-menu\">\n        @if (this.input.withSearch) {\n          <input class=\"input-search\" type=\"search\" placeholder=\"Rechercher...\" (input)=\"this.onSearchChange($event)\" />\n        }\n\n        @for (opt of this.filteredOptions; track opt.id) {\n          <button\n            [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n            (click)=\"this.selectOption(opt.id, $event)\"\n            [class.selected]=\"this.isSelected(opt.id)\"\n            [class.disabled]=\"opt.disabled\"\n            class=\"dropdown-option space-between\"\n          >\n            {{ opt.name | translate }}\n            @if (this.isSelected(opt.id)) {\n              <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n            }\n          </button>\n        }\n      </div>\n    </ng-template>\n  </ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"], dependencies: [{ kind: "component", type: FontIconComponent, selector: "ta-font-icon", inputs: ["name", "type"] }, { kind: "component", type: TaOverlayPanelComponent, selector: "ta-overlay-panel", inputs: ["panelConfig"], outputs: ["closed"] }, { kind: "component", type: LabelComponent, selector: "ta-label", inputs: ["size", "type"] }, { kind: "pipe", type: TranslatePipe, name: "translate" }, { kind: "component", type: InputLayoutComponent, selector: "ta-input-layout", inputs: ["input", "width", "height"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: DropdownComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ta-input-dropdown', standalone: true, imports: [
                        NgIf,
                        NgFor,
                        FontIconComponent,
                        TaOverlayPanelComponent,
                        LabelComponent,
                        TranslatePipe,
                        InputLayoutComponent,
                    ], template: "@if (this.input) {\n  <ta-overlay-panel [panelConfig]=\"{ matchTriggerWidth: true }\" (closed)=\"this.onOverlayClosed()\">\n    <ng-template #panelTrigger>\n      <ta-input-layout [input]=\"this.input\">\n        <div #focusedElement class=\"custom-dropdown-button form-control\" [class.disabled]=\"this.input.disabled\">\n          <span class=\"selected-value align-center g-space-xs\">\n            @if (!this.input.multiple) {\n              @if (this.input.value) {\n                <span>\n                  {{ this.getOptionName(this.input.value) | translate }}\n                </span>\n              } @else {\n                {{ 'form.input.dropdown.novalue' | translate }}\n              }\n            } @else if (this.input.multiple) {\n              @for (value of this.input.value; track value) {\n                <ta-label size=\"sm\" class=\"d-flex\">\n                  {{ this.getOptionName(value) | translate }}\n                </ta-label>\n              }\n            }\n          </span>\n          <ta-font-icon name=\"arrow-big-bottom\" type=\"sm\"></ta-font-icon>\n        </div>\n      </ta-input-layout>\n    </ng-template>\n\n    <ng-template #panelContent>\n      <div class=\"custom-menu\">\n        @if (this.input.withSearch) {\n          <input class=\"input-search\" type=\"search\" placeholder=\"Rechercher...\" (input)=\"this.onSearchChange($event)\" />\n        }\n\n        @for (opt of this.filteredOptions; track opt.id) {\n          <button\n            [attr.cdkMenuItem]=\"!this.input.multiple ? '' : null\"\n            (click)=\"this.selectOption(opt.id, $event)\"\n            [class.selected]=\"this.isSelected(opt.id)\"\n            [class.disabled]=\"opt.disabled\"\n            class=\"dropdown-option space-between\"\n          >\n            {{ opt.name | translate }}\n            @if (this.isSelected(opt.id)) {\n              <ta-font-icon class=\"checkmark\" name=\"check-line\"></ta-font-icon>\n            }\n          </button>\n        }\n      </div>\n    </ng-template>\n  </ta-overlay-panel>\n}\n", styles: [".custom-dropdown-button{text-align:left;display:flex;justify-content:space-between;align-items:center}.custom-dropdown-button.disabled{border-color:var(--ta-neutral-300);pointer-events:none}button .selected-value{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-menu{padding:0}.input-search{width:100%;display:flex;flex-direction:column;padding:10px;border:none;outline:none}.input-search:focus{border:none;outline:none;box-shadow:none}.dropdown-option{display:flex;align-items:center;padding:var(--ta-space-sm) var(--ta-space-md);text-align:left;border:none;background:transparent;cursor:pointer;width:100%}.dropdown-option .checkmark{margin-left:var(--ta-space-sm);color:var(--ta-border-brand)}.dropdown-option:hover{background-color:var(--ta-neutral-100)}.dropdown-option.disabled{color:var(--ta-neutral-500);cursor:not-allowed}\n"] }]
        }], propDecorators: { space: [{
                type: Input
            }], overlayPanelRef: [{
                type: ViewChild,
                args: [TaOverlayPanelComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2lucHV0L2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9pbnB1dC9kcm9wZG93bi9kcm9wZG93bi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUc1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxjQUFjLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFFakUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDcEUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7O0FBaUJqRixNQUFNLE9BQU8saUJBQWtCLFNBQVEsd0JBQWlEO0lBZnhGOztRQWdCVyxVQUFLLEdBQUcsSUFBSSxDQUFDO1FBSWYsZ0JBQVcsR0FBdUQsRUFBRSxDQUFDO1FBQ3JFLG9CQUFlLEdBQXVELEVBQUUsQ0FBQztLQXNEakY7SUFwRFUsUUFBUTtRQUNmLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMscUJBQXFCLENBQ3hCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNyQyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQztZQUMzQixJQUFJLENBQUMs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aUI7d0JBQ2pCLHVCQUF1Qjt3QkFDdkIsY0FBYzt3QkFDZCxhQUFhO3dCQUNiLG9CQUFvQjtxQkFDckI7OEJBR1EsS0FBSztzQkFBYixLQUFLO2dCQUU4QixlQUFlO3NCQUFsRCxTQUFTO3VCQUFDLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nRm9yLCBOZ0lmIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBJbnB1dERyb3Bkb3duIH0gZnJvbSAnQHRhL2Zvcm0tbW9kZWwnO1xuaW1wb3J0IHsgRm9udEljb25Db21wb25lbnQgfSBmcm9tICdAdGEvaWNvbnMnO1xuaW1wb3J0IHsgVHJhbnNsYXRlUGlwZSB9IGZyb20gJ0B0YS90cmFuc2xhdGlvbic7XG5pbXBvcnQgeyBMYWJlbENvbXBvbmVudCwgVGFPdmVybGF5UGFuZWxDb21wb25lbnQgfSBmcm9tICdAdGEvdWknO1xuXG5pbXBvcnQgeyBUYUFic3RyYWN0SW5wdXRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9hYnN0cmFjdC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSW5wdXRMYXlvdXRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9pbnB1dC1sYXlvdXQvaW5wdXQtbGF5b3V0LmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhLWlucHV0LWRyb3Bkb3duJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Ryb3Bkb3duLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZHJvcGRvd24uY29tcG9uZW50LnNjc3MnXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIE5nSWYsXG4gICAgTmdGb3IsXG4gICAgRm9udEljb25Db21wb25lbnQsXG4gICAgVGFPdmVybGF5UGFuZWxDb21wb25lbnQsXG4gICAgTGFiZWxDb21wb25lbnQsXG4gICAgVHJhbnNsYXRlUGlwZSxcbiAgICBJbnB1dExheW91dENvbXBvbmVudCxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgRHJvcGRvd25Db21wb25lbnQgZXh0ZW5kcyBUYUFic3RyYWN0SW5wdXRDb21wb25lbnQ8SW5wdXREcm9wZG93bjxhbnk+LCBhbnk+IHtcbiAgQElucHV0KCkgc3BhY2UgPSB0cnVlO1xuXG4gIEBWaWV3Q2hpbGQoVGFPdmVybGF5UGFuZWxDb21wb25lbnQpIG92ZXJsYXlQYW5lbFJlZiE6IFRhT3ZlcmxheVBhbmVsQ29tcG9uZW50O1xuXG4gIHB1YmxpYyBvcHRpb25zTGlzdDogeyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmc7IGRpc2FibGVkPzogYm9vbGVhbiB9W10gPSBbXTtcbiAgcHVibGljIGZpbHRlcmVkT3B0aW9uczogeyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmc7IGRpc2FibGVkPzogYm9vbGVhbiB9W10gPSBbXTtcblxuICBvdmVycmlkZSBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuICAgIHRoaXMuX3JlZ2lzdGVyU3Vic2NyaXB0aW9uKFxuICAgICAgdGhpcy5pbnB1dC5vcHRpb25zLnN1YnNjcmliZShvcHRpb25zID0+IHtcbiAgICAgICAgdGhpcy5vcHRpb25zTGlzdCA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gdGhpcy5vcHRpb25zTGlzdDtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRPcHRpb25OYW1lKGlkOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IGZvdW5kID0gdGhpcy5vcHRpb25zTGlzdC5maW5kKG9wdCA9PiBvcHQuaWQgPT09IGlkKTtcbiAgICByZXR1cm4gZm91bmQgPyBmb3VuZC5uYW1lIDogJyc7XG4gIH1cblxuICBwdWJsaWMgb25NZW51U2VsZWN0KHNlbGVjdGVkSWQ6IGFueSkge1xuICAgIGlmICh0aGlzLmlucHV0Lm11bHRpcGxlKSB7XG4gICAgICBsZXQgY3VycmVudFZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZSB8fCBbXTtcbiAgICAgIGlmIChjdXJyZW50VmFsdWUuaW5jbHVkZXMoc2VsZWN0ZWRJZCkpIHtcbiAgICAgICAgY3VycmVudFZhbHVlID0gY3VycmVudFZhbHVlLmZpbHRlcigodjogYW55KSA9PiB2ICE9PSBzZWxlY3RlZElkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZSA9IFsuLi5jdXJyZW50VmFsdWUsIHNlbGVjdGVkSWRdO1xuICAgICAgfVxuICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IGN1cnJlbnRWYWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IHNlbGVjdGVkSWQ7XG4gICAgICB0aGlzLm92ZXJsYXlQYW5lbFJlZi5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvbk92ZXJsYXlDbG9zZWQoKTogdm9pZCB7XG4gICAgdGhpcy5maWx0ZXJlZE9wdGlvbnMgPSB0aGlzLm9wdGlvbnNMaXN0O1xuICB9XG5cbiAgcHVibGljIGlzU2VsZWN0ZWQoaWQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRoaXMuaW5wdXQudmFsdWU7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXQubXVsdGlwbGUgPyBBcnJheS5pc0FycmF5KGN1cnJlbnRWYWx1ZSkgJiYgY3VycmVudFZhbHVlLmluY2x1ZGVzKGlkKSA6IGN1cnJlbnRWYWx1ZSA9PT0gaWQ7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0T3B0aW9uKGlkOiBhbnksIGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5vbk1lbnVTZWxlY3QoaWQpO1xuICB9XG5cbiAgcHVibGljIG9uU2VhcmNoQ2hhbmdlKGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbnB1dC53aXRoU2VhcmNoKSByZXR1cm47XG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3Qgc2VhcmNoVGVybSA9IHRhcmdldC52YWx1ZS50cmltKCk7XG4gICAgdGhpcy5maWx0ZXJlZE9wdGlvbnMgPVxuICAgICAgc2VhcmNoVGVybS5sZW5ndGggPj0gMFxuICAgICAgICA/IHRoaXMub3B0aW9uc0xpc3QuZmlsdGVyKG9wdCA9PiBvcHQubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIDogdGhpcy5vcHRpb25zTGlzdDtcbiAgfVxufVxuIiwiQGlmICh0aGlzLmlucHV0KSB7XG4gIDx0YS1vdmVybGF5LXBhbmVsIFtwYW5lbENvbmZpZ109XCJ7IG1hdGNoVHJpZ2dlcldpZHRoOiB0cnVlIH1cIiAoY2xvc2VkKT1cInRoaXMub25PdmVybGF5Q2xvc2VkKClcIj5cbiAgICA8bmctdGVtcGxhdGUgI3BhbmVsVHJpZ2dlcj5cbiAgICAgIDx0YS1pbnB1dC1sYXlvdXQgW2lucHV0XT1cInRoaXMuaW5wdXRcIj5cbiAgICAgICAgPGRpdiAjZm9jdXNlZEVsZW1lbnQgY2xhc3M9XCJjdXN0b20tZHJvcGRvd24tYnV0dG9uIGZvcm0tY29udHJvbFwiIFtjbGFzcy5kaXNhYmxlZF09XCJ0aGlzLmlucHV0LmRpc2FibGVkXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzZWxlY3RlZC12YWx1ZSBhbGlnbi1jZW50ZXIgZy1zcGFjZS14c1wiPlxuICAgICAgICAgICAgQGlmICghdGhpcy5pbnB1dC5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICBAaWYgKHRoaXMuaW5wdXQudmFsdWUpIHtcbiAgICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICAgIHt7IHRoaXMuZ2V0T3B0aW9uTmFtZSh0aGlzLmlucHV0LnZhbHVlKSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgICAgICAge3sgJ2Zvcm0uaW5wdXQuZHJvcGRvd24ubm92YWx1ZScgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBAZWxzZSBpZiAodGhpcy5pbnB1dC5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICBAZm9yICh2YWx1ZSBvZiB0aGlzLmlucHV0LnZhbHVlOyB0cmFjayB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIDx0YS1sYWJlbCBzaXplPVwic21cIiBjbGFzcz1cImQtZmxleFwiPlxuICAgICAgICAgICAgICAgICAge3sgdGhpcy5nZXRPcHRpb25OYW1lKHZhbHVlKSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgICAgIDwvdGEtbGFiZWw+XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPHRhLWZvbnQtaWNvbiBuYW1lPVwiYXJyb3ctYmlnLWJvdHRvbVwiIHR5cGU9XCJzbVwiPjwvdGEtZm9udC1pY29uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvdGEtaW5wdXQtbGF5b3V0PlxuICAgIDwvbmctdGVtcGxhdGU+XG5cbiAgICA8bmctdGVtcGxhdGUgI3BhbmVsQ29udGVudD5cbiAgICAgIDxkaXYgY2xhc3M9XCJjdXN0b20tbWVudVwiPlxuICAgICAgICBAaWYgKHRoaXMuaW5wdXQud2l0aFNlYXJjaCkge1xuICAgICAgICAgIDxpbnB1dCBjbGFzcz1cImlucHV0LXNlYXJjaFwiIHR5cGU9XCJzZWFyY2hcIiBwbGFjZWhvbGRlcj1cIlJlY2hlcmNoZXIuLi5cIiAoaW5wdXQpPVwidGhpcy5vblNlYXJjaENoYW5nZSgkZXZlbnQpXCIgLz5cbiAgICAgICAgfVxuXG4gICAgICAgIEBmb3IgKG9wdCBvZiB0aGlzLmZpbHRlcmVkT3B0aW9uczsgdHJhY2sgb3B0LmlkKSB7XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgW2F0dHIuY2RrTWVudUl0ZW1dPVwiIXRoaXMuaW5wdXQubXVsdGlwbGUgPyAnJyA6IG51bGxcIlxuICAgICAgICAgICAgKGNsaWNrKT1cInRoaXMuc2VsZWN0T3B0aW9uKG9wdC5pZCwgJGV2ZW50KVwiXG4gICAgICAgICAgICBbY2xhc3Muc2VsZWN0ZWRdPVwidGhpcy5pc1NlbGVjdGVkKG9wdC5pZClcIlxuICAgICAgICAgICAgW2NsYXNzLmRpc2FibGVkXT1cIm9wdC5kaXNhYmxlZFwiXG4gICAgICAgICAgICBjbGFzcz1cImRyb3Bkb3duLW9wdGlvbiBzcGFjZS1iZXR3ZWVuXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7eyBvcHQubmFtZSB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgQGlmICh0aGlzLmlzU2VsZWN0ZWQob3B0LmlkKSkge1xuICAgICAgICAgICAgICA8dGEtZm9udC1pY29uIGNsYXNzPVwiY2hlY2ttYXJrXCIgbmFtZT1cImNoZWNrLWxpbmVcIj48L3RhLWZvbnQtaWNvbj5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgPC90YS1vdmVybGF5LXBhbmVsPlxufVxuIl19