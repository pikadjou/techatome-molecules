import { FormGroup } from "@angular/forms";
import { Subject } from "rxjs";
import { InputFactory } from "../factory";
import { InputBase } from "./base";
export class InputDynamic extends InputBase {
    constructor(options = {}) {
        super(options);
        this.listChanged$ = new Subject();
        this.firstRender = true;
        this.composedKeyForGroup = true;
        this.inputsGroup = options.inputsGroup || {};
        this.template = options.template || [];
        this.controlType = "dynamic";
    }
    add(key) {
        const templates = [];
        const value = key && this.value ? this.value[key] : null;
        for (const template of this.template) {
            templates.push(InputFactory.getInput(template.type, {
                ...template.options,
                ...{ value: value ? value[template.options.key ?? ""] : null },
            }));
        }
        this._addControl(templates, key ?? this._inputKey());
        this.listChanged$.next();
    }
    remove(id) {
        if (this.inputsGroup[id]) {
            this.formControl?.removeControl(this.key + "-" + id);
            delete this.inputsGroup[id];
        }
        this.listChanged$.next();
    }
    createFormControl(group) {
        this.formControl = new FormGroup({});
        const inputGroupKeys = Object.keys(this.inputsGroup);
        inputGroupKeys.forEach((key) => {
            this._addControl(this.inputsGroup[key], key);
        });
        if (this.firstRender && this.template && inputGroupKeys.length === 0) {
            this.add();
        }
        group.addControl(this.key, this.formControl);
    }
    _addControl(inputs, key) {
        const childGroup = new FormGroup({});
        inputs.forEach((input) => {
            input.createFormControl(childGroup);
        });
        this.formControl?.addControl(this.composedKeyForGroup ? this.key + "-" + key : key, childGroup);
        this.inputsGroup[key] = inputs;
    }
    _inputKey() {
        return "" + Math.floor(Math.random() * 10000);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvbW9kZWxzL2lucHV0L2R5bmFtaWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFvQixZQUFZLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDNUQsT0FBTyxFQUFjLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQWEvQyxNQUFNLE9BQU8sWUFBYSxTQUFRLFNBQW1DO0lBVW5FLFlBQVksVUFBeUIsRUFBRTtRQUNyQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFWakIsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBSW5DLGdCQUFXLEdBQVksSUFBSSxDQUFDO1FBQzVCLHdCQUFtQixHQUFZLElBQUksQ0FBQztRQU1sQyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUM7UUFFdkMsSUFBSSxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUM7SUFDL0IsQ0FBQztJQUVNLEdBQUcsQ0FBQyxHQUFZO1FBQ3JCLE1BQU0sU0FBUyxHQUFxQixFQUFFLENBQUM7UUFDdkMsTUFBTSxLQUFLLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN6RCxLQUFLLE1BQU0sUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNyQyxTQUFTLENBQUMsSUFBSSxDQUNaLFlBQVksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRTtnQkFDbkMsR0FBRyxRQUFRLENBQUMsT0FBTztnQkFDbkIsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO2FBQy9ELENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFDTSxNQUFNLENBQUMsRUFBVTtRQUN0QixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUNyRCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDOUIsQ0FBQztRQUNELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUNlLGlCQUFpQixDQUFDLEtBQWdCO1FBQ2hELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckMsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckQsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzdCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLGNBQWMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDckUsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ2IsQ0FBQztRQUNELEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVPLFdBQVcsQ0FBQyxNQUF3QixFQUFFLEdBQVc7UUFDdkQsTUFBTSxVQUFVLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ3ZCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxXQUFXLEVBQUUsVUFBVSxDQUMxQixJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUNyRCxVQUFVLENBQ1gsQ0FBQztRQUNGLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDO0lBQ2pDLENBQUM7SUFFTyxTQUFTO1FBQ2YsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDaEQsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybUdyb3VwIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5cbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuXG5pbXBvcnQgeyBGYWN0b3J5SW5wdXRUeXBlLCBJbnB1dEZhY3RvcnkgfSBmcm9tIFwiLi4vZmFjdG9yeVwiO1xuaW1wb3J0IHsgSUlucHV0QmFzZSwgSW5wdXRCYXNlIH0gZnJvbSBcIi4vYmFzZVwiO1xuXG5pbnRlcmZhY2UgSUlucHV0VGVtcGxhdGVEeW5hbWljIHtcbiAgdHlwZTogRmFjdG9yeUlucHV0VHlwZTtcbiAgb3B0aW9uczogSUlucHV0Q2hpbGRyZW5EeW5hbWljO1xufVxuZXhwb3J0IGludGVyZmFjZSBJSW5wdXRDaGlsZHJlbkR5bmFtaWMgZXh0ZW5kcyBJSW5wdXRCYXNlPGFueT4ge1xuICB0ZW1wbGF0ZUNoaWxkcmVuPzogKCkgPT4gSW5wdXRCYXNlPGFueT5bXTtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgSUlucHV0RHluYW1pYyBleHRlbmRzIElJbnB1dEJhc2U8YW55PiB7XG4gIGlucHV0c0dyb3VwPzogeyBba2V5OiBzdHJpbmddOiBJbnB1dEJhc2U8YW55PltdIH07XG4gIHRlbXBsYXRlPzogSUlucHV0VGVtcGxhdGVEeW5hbWljW107XG59XG5leHBvcnQgY2xhc3MgSW5wdXREeW5hbWljIGV4dGVuZHMgSW5wdXRCYXNlPHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4ge1xuICBsaXN0Q2hhbmdlZCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIGlucHV0c0dyb3VwOiB7IFtrZXk6IHN0cmluZ106IElucHV0QmFzZTxhbnk+W10gfTtcbiAgdGVtcGxhdGU6IElJbnB1dFRlbXBsYXRlRHluYW1pY1tdO1xuICBmaXJzdFJlbmRlcjogYm9vbGVhbiA9IHRydWU7XG4gIGNvbXBvc2VkS2V5Rm9yR3JvdXA6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIG92ZXJyaWRlIGZvcm1Db250cm9sPzogRm9ybUdyb3VwO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElJbnB1dER5bmFtaWMgPSB7fSkge1xuICAgIHN1cGVyKG9wdGlvbnMpO1xuICAgIHRoaXMuaW5wdXRzR3JvdXAgPSBvcHRpb25zLmlucHV0c0dyb3VwIHx8IHt9O1xuICAgIHRoaXMudGVtcGxhdGUgPSBvcHRpb25zLnRlbXBsYXRlIHx8IFtdO1xuXG4gICAgdGhpcy5jb250cm9sVHlwZSA9IFwiZHluYW1pY1wiO1xuICB9XG5cbiAgcHVibGljIGFkZChrZXk/OiBzdHJpbmcpIHtcbiAgICBjb25zdCB0ZW1wbGF0ZXM6IElucHV0QmFzZTxhbnk+W10gPSBbXTtcbiAgICBjb25zdCB2YWx1ZSA9IGtleSAmJiB0aGlzLnZhbHVlID8gdGhpcy52YWx1ZVtrZXldIDogbnVsbDtcbiAgICBmb3IgKGNvbnN0IHRlbXBsYXRlIG9mIHRoaXMudGVtcGxhdGUpIHtcbiAgICAgIHRlbXBsYXRlcy5wdXNoKFxuICAgICAgICBJbnB1dEZhY3RvcnkuZ2V0SW5wdXQodGVtcGxhdGUudHlwZSwge1xuICAgICAgICAgIC4uLnRlbXBsYXRlLm9wdGlvbnMsXG4gICAgICAgICAgLi4ueyB2YWx1ZTogdmFsdWUgPyB2YWx1ZVt0ZW1wbGF0ZS5vcHRpb25zLmtleSA/PyBcIlwiXSA6IG51bGwgfSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuX2FkZENvbnRyb2wodGVtcGxhdGVzLCBrZXkgPz8gdGhpcy5faW5wdXRLZXkoKSk7XG4gICAgdGhpcy5saXN0Q2hhbmdlZCQubmV4dCgpO1xuICB9XG4gIHB1YmxpYyByZW1vdmUoaWQ6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmlucHV0c0dyb3VwW2lkXSkge1xuICAgICAgdGhpcy5mb3JtQ29udHJvbD8ucmVtb3ZlQ29udHJvbCh0aGlzLmtleSArIFwiLVwiICsgaWQpO1xuICAgICAgZGVsZXRlIHRoaXMuaW5wdXRzR3JvdXBbaWRdO1xuICAgIH1cbiAgICB0aGlzLmxpc3RDaGFuZ2VkJC5uZXh0KCk7XG4gIH1cbiAgcHVibGljIG92ZXJyaWRlIGNyZWF0ZUZvcm1Db250cm9sKGdyb3VwOiBGb3JtR3JvdXApOiB2b2lkIHtcbiAgICB0aGlzLmZvcm1Db250cm9sID0gbmV3IEZvcm1Hcm91cCh7fSk7XG4gICAgY29uc3QgaW5wdXRHcm91cEtleXMgPSBPYmplY3Qua2V5cyh0aGlzLmlucHV0c0dyb3VwKTtcbiAgICBpbnB1dEdyb3VwS2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIHRoaXMuX2FkZENvbnRyb2wodGhpcy5pbnB1dHNHcm91cFtrZXldLCBrZXkpO1xuICAgIH0pO1xuICAgIGlmICh0aGlzLmZpcnN0UmVuZGVyICYmIHRoaXMudGVtcGxhdGUgJiYgaW5wdXRHcm91cEtleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmFkZCgpO1xuICAgIH1cbiAgICBncm91cC5hZGRDb250cm9sKHRoaXMua2V5LCB0aGlzLmZvcm1Db250cm9sKTtcbiAgfVxuXG4gIHByaXZhdGUgX2FkZENvbnRyb2woaW5wdXRzOiBJbnB1dEJhc2U8YW55PltdLCBrZXk6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGNoaWxkR3JvdXAgPSBuZXcgRm9ybUdyb3VwKHt9KTtcbiAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LmNyZWF0ZUZvcm1Db250cm9sKGNoaWxkR3JvdXApO1xuICAgIH0pO1xuICAgIHRoaXMuZm9ybUNvbnRyb2w/LmFkZENvbnRyb2woXG4gICAgICB0aGlzLmNvbXBvc2VkS2V5Rm9yR3JvdXAgPyB0aGlzLmtleSArIFwiLVwiICsga2V5IDoga2V5LFxuICAgICAgY2hpbGRHcm91cFxuICAgICk7XG4gICAgdGhpcy5pbnB1dHNHcm91cFtrZXldID0gaW5wdXRzO1xuICB9XG5cbiAgcHJpdmF0ZSBfaW5wdXRLZXkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJcIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKTtcbiAgfVxufVxuIl19