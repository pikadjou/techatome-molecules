import { signal } from '@angular/core';
import { FormControl } from '@angular/forms';
import { Subject, distinctUntilChanged, of } from 'rxjs';
import { SubscriberHandler } from '@ta/utils';
export class InputBase {
    get value() {
        return this._value();
    }
    set value(value) {
        this._value.set(value);
        this.formControl?.setValue(value);
    }
    constructor(options = {}) {
        this.changeValue$ = new Subject();
        this._value = signal(null);
        this._subscriberHandler = new SubscriberHandler();
        if (options.value$) {
            this._subscriberHandler.registerSubscription(options.value$.subscribe({
                next: value => {
                    if (this.value) {
                        return;
                    }
                    this.value = value;
                },
            }));
        }
        this._value.set(options.value === undefined ? null : options.value);
        this.key = options.key || Math.random().toString();
        this.label = options.label || '';
        this.type = options.type || '';
        this.message = options.message || '';
        this.controlType = options.controlType || '';
        this.validators = options.validators || [];
        this.class = options.class || 'col-12';
        this.children = [];
        this.disabled = options.disabled === true;
        this.visible$ = options.visible$ || of(true);
        if (options.bindStatusToVisible !== false) {
            this._subscriberHandler.registerSubscription(this.visible$.subscribe(visible => {
                this._isVisible = visible;
                if (options.bindStatusToVisible !== false) {
                    if (!visible) {
                        this.disable();
                    }
                    else {
                        this.enable();
                    }
                }
                if (!visible) {
                    this.formControl?.setValue(null);
                }
            }));
        }
    }
    createFormControl(group) {
        if (this.children.length > 0) {
            for (const child of this.children) {
                if (child instanceof InputBase) {
                    child.createFormControl(group);
                }
            }
        }
        else {
            this.formControl = new FormControl(this.value, this.validators);
            if (this.disabled) {
                this.formControl.disable();
            }
            this._subscriberHandler.registerSubscription(this.formControl.valueChanges.pipe(distinctUntilChanged()).subscribe(value => {
                this.value = value;
                this.launchChangeValue();
            }));
            if (group) {
                group.addControl(this.key, this.formControl);
            }
        }
    }
    launchChangeValue() {
        this.changeValue$.next(this.value);
        this.children.forEach(child => child.launchChangeValue());
    }
    disable() {
        this.formControl?.disable();
        this.children.forEach(child => child.disable());
    }
    enable() {
        if (!this._isVisible)
            return;
        this.formControl?.enable();
        this.children.forEach(child => child.enable());
    }
    destroy() {
        this.changeValue$.complete();
        this._subscriberHandler.destroy();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvbW9kZWxzL2lucHV0L2Jhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2QyxPQUFPLEVBQW1CLFdBQVcsRUFBMEIsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RixPQUFPLEVBQWMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUdyRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUF5QjlDLE1BQU0sT0FBTyxTQUFTO0lBbUJwQixJQUFJLEtBQUs7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBQ0QsSUFBSSxLQUFLLENBQUMsS0FBZTtRQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBQ0QsWUFBWSxVQUEyQixFQUFFO1FBZHpDLGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQVksQ0FBQztRQUUvQixXQUFNLEdBQUcsTUFBTSxDQUFXLElBQUksQ0FBQyxDQUFDO1FBRzlCLHVCQUFrQixHQUFHLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQVVyRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNuQixJQUFJLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLENBQzFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO2dCQUN2QixJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQUU7b0JBQ1osSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7d0JBQ2YsT0FBTztvQkFDVCxDQUFDO29CQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixDQUFDO2FBQ0YsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDO1FBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbkQsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQy9CLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FBQztRQUM3QyxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDO1FBQzNDLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUM7UUFDdkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQztRQUUxQyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTdDLElBQUksT0FBTyxDQUFDLG1CQUFtQixLQUFLLEtBQUssRUFBRSxDQUFDO1lBQzFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxvQkFBb0IsQ0FDMUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ2hDLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDO2dCQUUxQixJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsS0FBSyxLQUFLLEVBQUUsQ0FBQztvQkFDMUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO3dCQUNiLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztvQkFDakIsQ0FBQzt5QkFBTSxDQUFDO3dCQUNOLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztvQkFDaEIsQ0FBQztnQkFDSCxDQUFDO2dCQUVELElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztvQkFDYixJQUFJLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbkMsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVNLGlCQUFpQixDQUFDLEtBQWlCO1FBQ3hDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDN0IsS0FBSyxNQUFNLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ2xDLElBQUksS0FBSyxZQUFZLFNBQVMsRUFBRSxDQUFDO29CQUMvQixLQUFLLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksV0FBVyxDQUFXLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzFFLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUNsQixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQzdCLENBQUM7WUFDRCxJQUFJLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLENBQzFDLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUMzRSxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztnQkFDbkIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDM0IsQ0FBQyxDQUFDLENBQ0gsQ0FBQztZQUNGLElBQUksS0FBSyxFQUFFLENBQUM7Z0JBQ1YsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUMvQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFTSxpQkFBaUI7UUFDdEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRU0sT0FBTztRQUNaLElBQUksQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRU0sTUFBTTtRQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVTtZQUFFLE9BQU87UUFDN0IsSUFBSSxDQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFTSxPQUFPO1FBQ1osSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDcEMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2lnbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIFZhbGlkYXRvckZuIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgb2YgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgRU5vdGlmaWNhdGlvbkNvZGUgfSBmcm9tICdAdGEvbm90aWZpY2F0aW9uJztcbmltcG9ydCB7IFN1YnNjcmliZXJIYW5kbGVyIH0gZnJvbSAnQHRhL3V0aWxzJztcblxuaW1wb3J0IHsgSW5wdXRMYWJlbCB9IGZyb20gJy4vbGFiZWwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElJbnB1dHNFcnJvciB7XG4gIHN0YXR1czogRU5vdGlmaWNhdGlvbkNvZGU7XG4gIG1lc3NhZ2U6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJSW5wdXRCYXNlPFQ+IHtcbiAgdmFsdWUkPzogT2JzZXJ2YWJsZTxUPjtcbiAgdmFsdWU/OiBUIHwgbnVsbDtcbiAga2V5Pzogc3RyaW5nO1xuICBsYWJlbD86IHN0cmluZztcbiAgdHlwZT86IHN0cmluZztcbiAgbWVzc2FnZT86IHN0cmluZztcbiAgY29udHJvbFR5cGU/OiBzdHJpbmc7XG4gIHZhbGlkYXRvcnM/OiBWYWxpZGF0b3JGbltdO1xuICBjbGFzcz86IHN0cmluZztcbiAgY2hpbGRyZW4/OiAoSW5wdXRCYXNlPGFueT4gfCBJbnB1dExhYmVsKVtdO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIHZpc2libGUkPzogT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgYmluZFN0YXR1c1RvVmlzaWJsZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBJbnB1dEJhc2U8VD4gaW1wbGVtZW50cyBJSW5wdXRCYXNlPFQ+IHtcbiAga2V5OiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBjb250cm9sVHlwZTogc3RyaW5nO1xuICB2YWxpZGF0b3JzOiBWYWxpZGF0b3JGbltdO1xuICBmb3JtQ29udHJvbD86IEFic3RyYWN0Q29udHJvbDtcbiAgY2xhc3M6IHN0cmluZztcbiAgY2hpbGRyZW46IChJbnB1dEJhc2U8YW55PiB8IElucHV0TGFiZWwpW107XG4gIGRpc2FibGVkOiBib29sZWFuO1xuICB2aXNpYmxlJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgY2hhbmdlVmFsdWUkID0gbmV3IFN1YmplY3Q8VCB8IG51bGw+KCk7XG5cbiAgcHJpdmF0ZSBfdmFsdWUgPSBzaWduYWw8VCB8IG51bGw+KG51bGwpO1xuICBwcml2YXRlIF9pc1Zpc2libGUhOiBib29sZWFuO1xuXG4gIHByb3RlY3RlZCBfc3Vic2NyaWJlckhhbmRsZXIgPSBuZXcgU3Vic2NyaWJlckhhbmRsZXIoKTtcblxuICBnZXQgdmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlKCk7XG4gIH1cbiAgc2V0IHZhbHVlKHZhbHVlOiBUIHwgbnVsbCkge1xuICAgIHRoaXMuX3ZhbHVlLnNldCh2YWx1ZSk7XG4gICAgdGhpcy5mb3JtQ29udHJvbD8uc2V0VmFsdWUodmFsdWUpO1xuICB9XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElJbnB1dEJhc2U8YW55PiA9IHt9KSB7XG4gICAgaWYgKG9wdGlvbnMudmFsdWUkKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpYmVySGFuZGxlci5yZWdpc3RlclN1YnNjcmlwdGlvbihcbiAgICAgICAgb3B0aW9ucy52YWx1ZSQuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiB2YWx1ZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy52YWx1ZSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5fdmFsdWUuc2V0KG9wdGlvbnMudmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBvcHRpb25zLnZhbHVlKTtcbiAgICB0aGlzLmtleSA9IG9wdGlvbnMua2V5IHx8IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKTtcbiAgICB0aGlzLmxhYmVsID0gb3B0aW9ucy5sYWJlbCB8fCAnJztcbiAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJyc7XG4gICAgdGhpcy5tZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlIHx8ICcnO1xuICAgIHRoaXMuY29udHJvbFR5cGUgPSBvcHRpb25zLmNvbnRyb2xUeXBlIHx8ICcnO1xuICAgIHRoaXMudmFsaWRhdG9ycyA9IG9wdGlvbnMudmFsaWRhdG9ycyB8fCBbXTtcbiAgICB0aGlzLmNsYXNzID0gb3B0aW9ucy5jbGFzcyB8fCAnY29sLTEyJztcbiAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgdGhpcy5kaXNhYmxlZCA9IG9wdGlvbnMuZGlzYWJsZWQgPT09IHRydWU7XG5cbiAgICB0aGlzLnZpc2libGUkID0gb3B0aW9ucy52aXNpYmxlJCB8fCBvZih0cnVlKTtcblxuICAgIGlmIChvcHRpb25zLmJpbmRTdGF0dXNUb1Zpc2libGUgIT09IGZhbHNlKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpYmVySGFuZGxlci5yZWdpc3RlclN1YnNjcmlwdGlvbihcbiAgICAgICAgdGhpcy52aXNpYmxlJC5zdWJzY3JpYmUodmlzaWJsZSA9PiB7XG4gICAgICAgICAgdGhpcy5faXNWaXNpYmxlID0gdmlzaWJsZTtcblxuICAgICAgICAgIGlmIChvcHRpb25zLmJpbmRTdGF0dXNUb1Zpc2libGUgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAoIXZpc2libGUpIHtcbiAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghdmlzaWJsZSkge1xuICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbD8uc2V0VmFsdWUobnVsbCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlRm9ybUNvbnRyb2woZ3JvdXA/OiBGb3JtR3JvdXApIHtcbiAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgSW5wdXRCYXNlKSB7XG4gICAgICAgICAgY2hpbGQuY3JlYXRlRm9ybUNvbnRyb2woZ3JvdXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2w8VCB8IG51bGw+KHRoaXMudmFsdWUsIHRoaXMudmFsaWRhdG9ycyk7XG4gICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgICB0aGlzLmZvcm1Db250cm9sLmRpc2FibGUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1YnNjcmliZXJIYW5kbGVyLnJlZ2lzdGVyU3Vic2NyaXB0aW9uKFxuICAgICAgICB0aGlzLmZvcm1Db250cm9sLnZhbHVlQ2hhbmdlcy5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgIHRoaXMubGF1bmNoQ2hhbmdlVmFsdWUoKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgZ3JvdXAuYWRkQ29udHJvbCh0aGlzLmtleSwgdGhpcy5mb3JtQ29udHJvbCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGxhdW5jaENoYW5nZVZhbHVlKCkge1xuICAgIHRoaXMuY2hhbmdlVmFsdWUkLm5leHQodGhpcy52YWx1ZSk7XG4gICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IGNoaWxkLmxhdW5jaENoYW5nZVZhbHVlKCkpO1xuICB9XG5cbiAgcHVibGljIGRpc2FibGUoKSB7XG4gICAgdGhpcy5mb3JtQ29udHJvbD8uZGlzYWJsZSgpO1xuICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiBjaGlsZC5kaXNhYmxlKCkpO1xuICB9XG5cbiAgcHVibGljIGVuYWJsZSgpIHtcbiAgICBpZiAoIXRoaXMuX2lzVmlzaWJsZSkgcmV0dXJuO1xuICAgIHRoaXMuZm9ybUNvbnRyb2w/LmVuYWJsZSgpO1xuICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiBjaGlsZC5lbmFibGUoKSk7XG4gIH1cblxuICBwdWJsaWMgZGVzdHJveSgpIHtcbiAgICB0aGlzLmNoYW5nZVZhbHVlJC5jb21wbGV0ZSgpO1xuICAgIHRoaXMuX3N1YnNjcmliZXJIYW5kbGVyLmRlc3Ryb3koKTtcbiAgfVxufVxuIl19