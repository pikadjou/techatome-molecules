import { isNonNullable } from "@ta/utils";
import { BehaviorSubject, filter, map, tap } from "rxjs";
export class HandleComplexRequest {
    constructor() {
        this.data$ = new BehaviorSubject({});
    }
    fetch(id, subscriber) {
        return subscriber.pipe(filter((data) => !!data), tap((entity) => {
            const entities = this.data$.getValue();
            entities[id] = entity;
            this.data$.next(entities);
        }));
    }
    add(id, item) {
        const entities = this.data$.getValue();
        if (entities[id]) {
            this.update(id, item);
            return;
        }
        entities[id] = item;
        this.data$.next(entities);
    }
    update(id, item, merge = true) {
        const entities = this.data$.getValue();
        if (!entities[id]) {
            return;
        }
        entities[id] = merge ? { ...entities[id], ...item } : item;
        this.data$.next(entities);
    }
    get(key) {
        return this.data$.getValue()[key] ?? null;
    }
    get$(key) {
        return this.data$.pipe(map((data) => data[key]), filter((data) => !!data));
    }
}
export class HandleSimpleRequest {
    constructor() {
        this.data$ = new BehaviorSubject(null);
    }
    fetch(subscriber) {
        return subscriber.pipe(filter(isNonNullable), tap((entity) => {
            this.data$.next(entity);
        }));
    }
    get() {
        return this.data$.getValue() ?? null;
    }
    get$() {
        return this.data$.pipe(filter((data) => !!data));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlLXJlcXVlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL2hlbHBlcnMvaGFuZGxlLXJlcXVlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUMxQyxPQUFPLEVBQUUsZUFBZSxFQUFjLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXJFLE1BQU0sT0FBTyxvQkFBb0I7SUFHL0I7UUFGTyxVQUFLLEdBQUcsSUFBSSxlQUFlLENBQXlCLEVBQUUsQ0FBQyxDQUFDO0lBRWhELENBQUM7SUFFVCxLQUFLLENBQUMsRUFBVSxFQUFFLFVBQXlCO1FBQ2hELE9BQU8sVUFBVSxDQUFDLElBQUksQ0FDcEIsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQ3hCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ2IsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN2QyxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRU0sR0FBRyxDQUFDLEVBQVUsRUFBRSxJQUFPO1FBQzVCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFdkMsSUFBSSxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNqQixJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN0QixPQUFPO1FBQ1QsQ0FBQztRQUNELFFBQVEsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNNLE1BQU0sQ0FBQyxFQUFVLEVBQUUsSUFBTyxFQUFFLFFBQWlCLElBQUk7UUFDdEQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUV2QyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbEIsT0FBTztRQUNULENBQUM7UUFDRCxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUMzRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBQ00sR0FBRyxDQUFDLEdBQVc7UUFDcEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQztJQUM1QyxDQUFDO0lBRU0sSUFBSSxDQUFDLEdBQVc7UUFDckIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDcEIsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFDeEIsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQ3pCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFFRCxNQUFNLE9BQU8sbUJBQW1CO0lBRzlCO1FBRk8sVUFBSyxHQUFHLElBQUksZUFBZSxDQUFXLElBQUksQ0FBQyxDQUFDO0lBRXBDLENBQUM7SUFFVCxLQUFLLENBQUMsVUFBNEM7UUFDdkQsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUNwQixNQUFNLENBQUMsYUFBYSxDQUFDLEVBQ3JCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ2IsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFDTSxHQUFHO1FBQ1IsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLElBQUksQ0FBQztJQUN2QyxDQUFDO0lBRU0sSUFBSTtRQUNULE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc05vbk51bGxhYmxlIH0gZnJvbSBcIkB0YS91dGlsc1wiO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBmaWx0ZXIsIG1hcCwgdGFwIH0gZnJvbSBcInJ4anNcIjtcblxuZXhwb3J0IGNsYXNzIEhhbmRsZUNvbXBsZXhSZXF1ZXN0PFQ+IHtcbiAgcHVibGljIGRhdGEkID0gbmV3IEJlaGF2aW9yU3ViamVjdDx7IFtpbmRleDogc3RyaW5nXTogVCB9Pih7fSk7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIHB1YmxpYyBmZXRjaChpZDogc3RyaW5nLCBzdWJzY3JpYmVyOiBPYnNlcnZhYmxlPFQ+KSB7XG4gICAgcmV0dXJuIHN1YnNjcmliZXIucGlwZShcbiAgICAgIGZpbHRlcigoZGF0YSkgPT4gISFkYXRhKSxcbiAgICAgIHRhcCgoZW50aXR5KSA9PiB7XG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5kYXRhJC5nZXRWYWx1ZSgpO1xuICAgICAgICBlbnRpdGllc1tpZF0gPSBlbnRpdHk7XG4gICAgICAgIHRoaXMuZGF0YSQubmV4dChlbnRpdGllcyk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYWRkKGlkOiBzdHJpbmcsIGl0ZW06IFQpIHtcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuZGF0YSQuZ2V0VmFsdWUoKTtcblxuICAgIGlmIChlbnRpdGllc1tpZF0pIHtcbiAgICAgIHRoaXMudXBkYXRlKGlkLCBpdGVtKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZW50aXRpZXNbaWRdID0gaXRlbTtcbiAgICB0aGlzLmRhdGEkLm5leHQoZW50aXRpZXMpO1xuICB9XG4gIHB1YmxpYyB1cGRhdGUoaWQ6IHN0cmluZywgaXRlbTogVCwgbWVyZ2U6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLmRhdGEkLmdldFZhbHVlKCk7XG5cbiAgICBpZiAoIWVudGl0aWVzW2lkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbnRpdGllc1tpZF0gPSBtZXJnZSA/IHsgLi4uZW50aXRpZXNbaWRdLCAuLi5pdGVtIH0gOiBpdGVtO1xuICAgIHRoaXMuZGF0YSQubmV4dChlbnRpdGllcyk7XG4gIH1cbiAgcHVibGljIGdldChrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmRhdGEkLmdldFZhbHVlKClba2V5XSA/PyBudWxsO1xuICB9XG5cbiAgcHVibGljIGdldCQoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhJC5waXBlKFxuICAgICAgbWFwKChkYXRhKSA9PiBkYXRhW2tleV0pLFxuICAgICAgZmlsdGVyKChkYXRhKSA9PiAhIWRhdGEpXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSGFuZGxlU2ltcGxlUmVxdWVzdDxUPiB7XG4gIHB1YmxpYyBkYXRhJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VCB8IG51bGw+KG51bGwpO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBwdWJsaWMgZmV0Y2goc3Vic2NyaWJlcjogT2JzZXJ2YWJsZTxUIHwgdW5kZWZpbmVkIHwgbnVsbD4pIHtcbiAgICByZXR1cm4gc3Vic2NyaWJlci5waXBlKFxuICAgICAgZmlsdGVyKGlzTm9uTnVsbGFibGUpLFxuICAgICAgdGFwKChlbnRpdHkpID0+IHtcbiAgICAgICAgdGhpcy5kYXRhJC5uZXh0KGVudGl0eSk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgcHVibGljIGdldCgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhJC5nZXRWYWx1ZSgpID8/IG51bGw7XG4gIH1cblxuICBwdWJsaWMgZ2V0JCgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhJC5waXBlKGZpbHRlcigoZGF0YSkgPT4gISFkYXRhKSk7XG4gIH1cbn1cbiJdfQ==