import { isNonNullable } from "@ta/utils";
import { BehaviorSubject, filter, map, tap } from "rxjs";
export class HandleComplexRequest {
    constructor() {
        this.data$ = new BehaviorSubject({});
    }
    fetch(id, subscriber) {
        return subscriber.pipe(filter((data) => !!data), tap((entity) => {
            const entities = this.data$.getValue();
            entities[id] = entity;
            this.data$.next(entities);
        }));
    }
    add(id, item) {
        const entities = this.data$.getValue();
        if (entities[id]) {
            this.update(id, item);
            return;
        }
        entities[id] = item;
        this.data$.next(entities);
    }
    update(id, item, merge = true) {
        const entities = this.data$.getValue();
        if (!entities[id]) {
            return;
        }
        entities[id] = merge ? { ...entities[id], ...item } : item;
        this.data$.next(entities);
    }
    get(key) {
        return this.data$.getValue()[key] ?? null;
    }
    get$(key) {
        return this.data$.pipe(map((data) => data[key]), filter((data) => !!data));
    }
}
export class HandleSimpleRequest {
    constructor() {
        this.data$ = new BehaviorSubject(null);
    }
    fetch(subscriber) {
        return subscriber.pipe(filter(isNonNullable), tap((entity) => {
            this.data$.next(entity);
        }));
    }
    get() {
        return this.data$.getValue() ?? null;
    }
    get$() {
        return this.data$.pipe(filter((data) => !!data));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlLXJlcXVlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL2hlbHBlcnMvaGFuZGxlLXJlcXVlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUMxQyxPQUFPLEVBQUUsZUFBZSxFQUFjLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXJFLE1BQU0sT0FBTyxvQkFBb0I7SUFHL0I7UUFGTyxVQUFLLEdBQUcsSUFBSSxlQUFlLENBQXlCLEVBQUUsQ0FBQyxDQUFDO0lBRWhELENBQUM7SUFFVCxLQUFLLENBQUMsRUFBVSxFQUFFLFVBQXlCO1FBQ2hELE9BQU8sVUFBVSxDQUFDLElBQUksQ0FDcEIsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQ3hCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ2IsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN2QyxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRU0sR0FBRyxDQUFDLEVBQVUsRUFBRSxJQUFPO1FBQzVCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFdkMsSUFBSSxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNqQixJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN0QixPQUFPO1FBQ1QsQ0FBQztRQUNELFFBQVEsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNNLE1BQU0sQ0FBQyxFQUFVLEVBQUUsSUFBTyxFQUFFLFFBQWlCLElBQUk7UUFDdEQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUV2QyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbEIsT0FBTztRQUNULENBQUM7UUFDRCxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUMzRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBQ00sR0FBRyxDQUFDLEdBQVc7UUFDcEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQztJQUM1QyxDQUFDO0lBRU0sSUFBSSxDQUFDLEdBQVc7UUFDckIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDcEIsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFDeEIsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQ3pCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFFRCxNQUFNLE9BQU8sbUJBQW1CO0lBRzlCO1FBRk8sVUFBSyxHQUFHLElBQUksZUFBZSxDQUFXLElBQUksQ0FBQyxDQUFDO0lBRXBDLENBQUM7SUFFVCxLQUFLLENBQUMsVUFBNEM7UUFDdkQsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUNwQixNQUFNLENBQUMsYUFBYSxDQUFDLEVBQ3JCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ2IsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFDTSxHQUFHO1FBQ1IsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLElBQUksQ0FBQztJQUN2QyxDQUFDO0lBRU0sSUFBSTtRQUNULE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc05vbk51bGxhYmxlIH0gZnJvbSBcIkB0YS91dGlsc1wiO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIGZpbHRlciwgbWFwLCB0YXAgfSBmcm9tIFwicnhqc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEhhbmRsZUNvbXBsZXhSZXF1ZXN0PFQ+IHtcclxuICBwdWJsaWMgZGF0YSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHsgW2luZGV4OiBzdHJpbmddOiBUIH0+KHt9KTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICBwdWJsaWMgZmV0Y2goaWQ6IHN0cmluZywgc3Vic2NyaWJlcjogT2JzZXJ2YWJsZTxUPikge1xyXG4gICAgcmV0dXJuIHN1YnNjcmliZXIucGlwZShcclxuICAgICAgZmlsdGVyKChkYXRhKSA9PiAhIWRhdGEpLFxyXG4gICAgICB0YXAoKGVudGl0eSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5kYXRhJC5nZXRWYWx1ZSgpO1xyXG4gICAgICAgIGVudGl0aWVzW2lkXSA9IGVudGl0eTtcclxuICAgICAgICB0aGlzLmRhdGEkLm5leHQoZW50aXRpZXMpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGQoaWQ6IHN0cmluZywgaXRlbTogVCkge1xyXG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLmRhdGEkLmdldFZhbHVlKCk7XHJcblxyXG4gICAgaWYgKGVudGl0aWVzW2lkXSkge1xyXG4gICAgICB0aGlzLnVwZGF0ZShpZCwgaXRlbSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGVudGl0aWVzW2lkXSA9IGl0ZW07XHJcbiAgICB0aGlzLmRhdGEkLm5leHQoZW50aXRpZXMpO1xyXG4gIH1cclxuICBwdWJsaWMgdXBkYXRlKGlkOiBzdHJpbmcsIGl0ZW06IFQsIG1lcmdlOiBib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLmRhdGEkLmdldFZhbHVlKCk7XHJcblxyXG4gICAgaWYgKCFlbnRpdGllc1tpZF0pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZW50aXRpZXNbaWRdID0gbWVyZ2UgPyB7IC4uLmVudGl0aWVzW2lkXSwgLi4uaXRlbSB9IDogaXRlbTtcclxuICAgIHRoaXMuZGF0YSQubmV4dChlbnRpdGllcyk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXQoa2V5OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGEkLmdldFZhbHVlKClba2V5XSA/PyBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCQoa2V5OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGEkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YSkgPT4gZGF0YVtrZXldKSxcclxuICAgICAgZmlsdGVyKChkYXRhKSA9PiAhIWRhdGEpXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEhhbmRsZVNpbXBsZVJlcXVlc3Q8VD4ge1xyXG4gIHB1YmxpYyBkYXRhJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VCB8IG51bGw+KG51bGwpO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHt9XHJcblxyXG4gIHB1YmxpYyBmZXRjaChzdWJzY3JpYmVyOiBPYnNlcnZhYmxlPFQgfCB1bmRlZmluZWQgfCBudWxsPikge1xyXG4gICAgcmV0dXJuIHN1YnNjcmliZXIucGlwZShcclxuICAgICAgZmlsdGVyKGlzTm9uTnVsbGFibGUpLFxyXG4gICAgICB0YXAoKGVudGl0eSkgPT4ge1xyXG4gICAgICAgIHRoaXMuZGF0YSQubmV4dChlbnRpdHkpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgcHVibGljIGdldCgpIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGEkLmdldFZhbHVlKCkgPz8gbnVsbDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YSQucGlwZShmaWx0ZXIoKGRhdGEpID0+ICEhZGF0YSkpO1xyXG4gIH1cclxufVxyXG4iXX0=