<div class="flex-column fade-in">
  @let document = this.document() | async;
  
  <!-- Header amélioré avec navigation -->
  <div class="document-header">
    @if (document) {
      <div class="header-content">
        <button 
          class="back-button" 
          (click)="this.selected(document.category?.documentId ?? null)"
          aria-label="Retour à la catégorie">
          <mat-icon>arrow_back_ios_new</mat-icon>
        </button>
        
        <h1 class="document-title">{{ document.title }}</h1>

        <div class="document-actions">
          <ta-button 
            [type]="'secondary'" 
            (action)="this.edit(document.documentId ?? '')"
            aria-label="Modifier le document">
            <mat-icon>edit</mat-icon>
            Modifier
          </ta-button>

          <ta-button 
            [type]="'danger'" 
            (action)="this.delete(document)"
            aria-label="Supprimer le document">
            <mat-icon>delete</mat-icon>
            Supprimer
          </ta-button>
        </div>
      </div>
    }
  </div>

  <!-- Grille principale -->
  <div class="document-grid">
    <!-- Panneau de formulaire -->
    <div class="form-panel">
      <ta-form 
        [inputs]="this.form()" 
        [onLive]="true" 
        (valid)="this.update($event)"
        aria-label="Formulaire d'édition des variables">
      </ta-form>
    </div>

    <!-- Panneau de prévisualisation -->
    <div class="preview-panel">
      @let content = this.content();
      
      @if (content) {
        <!-- Header de prévisualisation -->
        <div class="preview-header">
          <h2 class="preview-title">
            <mat-icon>visibility</mat-icon>
            Prévisualisation
          </h2>
          <button 
            class="convert-button" 
            (click)="this.convertToDoc(content)"
            aria-label="Convertir en document Word">
            <mat-icon>download</mat-icon>
            Convertir en DOCX
          </button>
        </div>

        <!-- Métadonnées du document -->
        <div class="document-meta">
          <h3 class="document-title-preview">{{ document?.title }}</h3>
          <hr />
        </div>

        <!-- Contenu du document -->
        <div class="document-content" [innerHTML]="content">
        </div>
      } @else {
        <!-- État de chargement -->
        <div class="loading-state">
          <span>Chargement du contenu...</span>
        </div>
      }
    </div>
  </div>
</div>
